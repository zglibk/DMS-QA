# 电子签章功能开发计划 (最终版)

## 1. 数据库设计
创建 `ElectronicSeals` 表，包含完整的审计字段。

```sql
CREATE TABLE [dbo].[ElectronicSeals] (
    [ID] INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [SealName] NVARCHAR(100) NOT NULL,
    [SealType] NVARCHAR(50) NOT NULL,
    [DepartmentID] INT NULL,
    [DepartmentName] NVARCHAR(100) NULL,
    [ImageUrl] NVARCHAR(500) NOT NULL,
    [Description] NVARCHAR(500) NULL,
    [CreatedBy] INT NULL,                   -- 创建人
    [CreatedAt] DATETIME DEFAULT GETDATE(), -- 创建时间
    [UpdatedBy] INT NULL,                   -- 修改人 (新增)
    [UpdatedAt] DATETIME DEFAULT GETDATE(), -- 修改时间
    [IsActive] BIT DEFAULT 1
);
```

## 2. 后端开发 (`server/`)
### 2.1 菜单与权限脚本 (`scripts/add-seal-menu.js`)
- 在 "系统管理" 下添加 "电子签章" 菜单。
- 路径: `/admin/system/seals`。
- 权限: `system:seal:list`, `system:seal:add`, `system:seal:edit`, `system:seal:delete`。
- 自动授权给 `admin`。

### 2.2 API 路由 (`routes/electronicSeals.js`)
- **CRUD 接口**: 实现标准的增删改查。
- **审计日志**:
  - 在 **删除印章** (`DELETE`) 接口中，手动写入 `SystemLogs` 表，记录操作人、操作时间、删除的印章名称等信息。
  - 在 **修改印章** (`PUT`) 接口中，更新 `UpdatedBy` 和 `UpdatedAt` 字段。

## 3. 前端开发 (`frontend/`)
### 3.1 页面组件 (`src/views/admin/system/ElectronicSeal.vue`)
- **Tabs**: 部门章 / 专用章。
- **列表**: 展示印章图片、名称、部门、修改人/时间。
- **表单**: 支持图片上传预览。

## 4. 执行顺序
1. **SQL**: 创建数据库表。
2. **Backend**: 编写路由和日志逻辑。
3. **Script**: 运行菜单脚本同步数据库。
4. **Frontend**: 实现页面。
