# 性能实验报告模块开发计划 (最终版)

根据您的“左右布局”和“多项目/全流程”需求，我重新制定了系统架构。此方案将实现一个集记录、管理、审核于一体的高效工作台。

## 1. 数据库设计 (Database Schema)

### 1.1 `PerformanceReports` (报告主表)
存储报告单层面的通用信息。
- **字段**:
    - `ID`, `ReportNo` (报告编号)
    - `TestDate` (测试日期), `CustomerCode`, `SampleName`, `SampleModel`, `BatchNo`, `Supplier`
    - `Status` (状态: `Draft`草稿, `Submitted`已提交, `Audited`已审核)
    - `CreatedBy` (创建人), `AuditedBy` (审核人), `AuditDate`
    - `ReportFile` (生成的PDF报告路径, 可选)

### 1.2 `PerformanceReportItems` (实验项目子表)
核心表，用于存储单份报告下的多个不同类型的实验项目。
- **字段**:
    - `ID`, `ReportID` (关联主表)
    - `TestType` (实验类型: `Adhesion`初粘/持粘, `Peel`剥离力, `Abrasion`耐磨, `Alcohol`耐醇)
    - `InstrumentID` (关联仪器台账)
    - `Standard` (试验标准), `Method` (测试方法)
    - `Conditions` (JSON字段: 存储特有的实验条件，如温湿度、荷重、速度、溶剂、酒精度等)
    - `ResultData` (JSON字段: 存储结构化测试数据，如剥离力的5组数值、10个样品的判定结果)
    - `Conclusion` (单项结论/描述)
    - `Images` (JSON字段: 图片路径数组)

## 2. 后端开发 (Backend API)
路由：`server/routes/performanceInspection.js`

- **主表操作**: 
    - `GET /list`: 获取左侧报告列表。
    - `POST /create`: 创建新报告单。
    - `PUT /:id/status`: 变更状态（提交/审核）。
- **项目操作**:
    - `POST /item`: 向报告添加实验项目。
    - `PUT /item/:id`: 保存/更新实验数据（自动处理JSON序列化）。
    - `DELETE /item/:id`: 移除实验项目。
- **辅助接口**:
    - `GET /instruments`: 获取仪器列表。
    - `POST /upload`: 图片上传。

## 3. 前端开发 (Frontend UI - 左右布局)
路径：`frontend/src/views/quality/inspection/performance/`

### 3.1 布局容器 (`Index.vue`)
- **左侧 (300px)**: `ReportList.vue`
    - 搜索框、新建按钮。
    - 列表项显示：报告号、样品名、状态标签（不同颜色）。
    - 点击列表项，右侧加载详情。
- **右侧 (Flex-1)**: `ReportDetail.vue`
    - **顶部**: `BasicInfoForm` (基础信息，支持编辑保存)。
    - **中部**: `TestItemsManager` (实验项目管理区)。
        - 包含“添加实验”按钮（下拉选择类型：耐磨、耐醇等）。
        - 列表显示已添加的实验卡片。
        - **动态表单组件**: 根据 `TestType` 加载对应的录入组件 (`AdhesionForm.vue`, `PeelForm.vue` 等)，精准还原每种实验的录入格式（如剥离力的5组数据表）。
        - **图片上传**: 每个实验卡片内独立的上传区域。
    - **底部**: `WorkflowBar` (工作流操作栏)。
        - 按钮：预览报告、提交审核、审核通过/驳回。

### 3.2 报告预览与打印 (`ReportPreview.vue`)
- 将主表信息和所有子实验项目按顺序拼接。
- 根据不同的实验类型，渲染对应的HTML表格结构（如剥离力渲染明细表，耐磨渲染描述段落）。
- 支持一键打印或导出PDF。

## 4. 执行步骤
1.  **数据库**: 创建表结构。
2.  **后端**: 开发API。
3.  **前端框架**: 搭建左右布局结构。
4.  **前端组件**: 开发4种特定实验的录入表单组件。
5.  **联调**: 实现从创建到审核的完整流程。

确认后，我将从数据库脚本开始执行。