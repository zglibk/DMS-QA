# 人员资质管理系统 v2.0 部署说明

## 一、系统概述

本系统是一个完整的人员资质管理解决方案，支持多种专业能力资质的管理：

| 类别 | 资质类型 |
|------|----------|
| 生产技能 | 印刷工、模切工、装订工、调墨员 |
| 质量检验 | 全检员(FQC)、过程检验员(IPQC)、来料检验员(IQC)、出货检验员(OQC) |
| 质量管理 | 质量保证(QA)、质量工程师(QE)、ISO内审员 |
| 专项能力 | 辨色能力(FM100)、色彩管理 |
| 实验检测 | 实验员、仪器操作员 |

---

## 二、数据库部署

执行 `database/qualification_tables_v2.sql` 脚本。

### 表结构说明

```
QualificationType          资质类型表（预置15种资质）
PersonnelQualification     人员资质基础信息表
PersonnelCertification     人员资质认证记录表
QualificationTest          考核测试记录表（含FM100扩展数据）
PositionQualificationRequirement  岗位资质要求表
```

---

## 三、后端部署

### 3.1 文件部署位置

```
server/routes/qualification.js       资质类型+人员+认证管理API
server/routes/qualification-tests.js 考核测试+FM100+统计API
```

### 3.2 路由注册 (app.js)

```javascript
const qualificationRouter = require('./routes/qualification');
const qualificationTestsRouter = require('./routes/qualification-tests');

app.use('/api/qualification', qualificationRouter);
app.use('/api/qualification', qualificationTestsRouter);
```

### 3.3 上传目录

确保存在目录：`server/uploads/qualification/`

---

## 四、前端部署

### 4.1 文件部署位置

```
frontend/src/views/admin/qualification/PersonnelList.vue      人员资质管理
frontend/src/views/admin/qualification/FM100TestPage.vue      FM100色觉测试
frontend/src/views/admin/qualification/QualificationTypes.vue 资质类型配置
```

### 4.2 路由配置

```javascript
{
  path: 'qualification',
  redirect: '/admin/quality/qualification/personnel',
  meta: { title: '人员资质' },
  children: [
    { path: 'personnel', component: () => import('@/views/admin/qualification/PersonnelList.vue'), meta: { title: '资质人员' } },
    { path: 'fm100', component: () => import('@/views/admin/qualification/FM100TestPage.vue'), meta: { title: 'FM100色觉测试' } },
    { path: 'types', component: () => import('@/views/admin/qualification/QualificationTypes.vue'), meta: { title: '资质类型配置' } }
  ]
}
```

### 4.3 菜单配置SQL

```sql
-- 假设质量管理菜单ID为3
-- 人员资质二级菜单
INSERT INTO Menus (ParentID, MenuCode, MenuName, MenuType, Path, Icon, SortOrder, Status, Visible)
VALUES (3, 'qualification', '人员资质', 1, '/admin/quality/qualification', 'User', 50, 1, 1);

-- 获取刚插入的ID (假设为 @parentId)
DECLARE @parentId INT = SCOPE_IDENTITY();

-- 三级菜单
INSERT INTO Menus (ParentID, MenuCode, MenuName, MenuType, Path, Icon, SortOrder, Status, Visible) VALUES
(@parentId, 'qualification-personnel', '资质人员', 2, '/admin/quality/qualification/personnel', 'UserFilled', 1, 1, 1),
(@parentId, 'qualification-fm100', 'FM100色觉测试', 2, '/admin/quality/qualification/fm100', 'View', 2, 1, 1),
(@parentId, 'qualification-types', '资质类型配置', 2, '/admin/quality/qualification/types', 'Setting', 3, 1, 1);

-- 角色权限分配（假设管理员角色ID为1）
INSERT INTO RoleMenus (RoleID, MenuID) 
SELECT 1, ID FROM Menus WHERE MenuCode LIKE 'qualification%';
```

---

## 五、API接口清单

### 资质类型
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/types | 获取类型列表 |
| GET | /api/qualification/types/grouped | 按类别分组获取 |
| POST | /api/qualification/types | 新增/更新类型 |

### 人员资质
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/personnel | 人员列表(带概览) |
| GET | /api/qualification/personnel/all | 下拉选择用 |
| GET | /api/qualification/personnel/:id | 人员详情 |
| POST | /api/qualification/personnel | 新增人员 |
| PUT | /api/qualification/personnel/:id | 更新人员 |
| DELETE | /api/qualification/personnel/:id | 删除人员 |

### 资质认证
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/certifications | 认证列表 |
| POST | /api/qualification/certifications | 新增认证 |
| PUT | /api/qualification/certifications/:id/status | 更新状态 |
| DELETE | /api/qualification/certifications/:id | 删除认证 |

### 考核测试
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/tests | 考核记录列表 |
| GET | /api/qualification/tests/:id | 考核详情 |
| POST | /api/qualification/tests | 新增考核 |
| DELETE | /api/qualification/tests/:id | 删除考核 |

### FM100色觉测试
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/fm100 | FM100记录列表 |
| GET | /api/qualification/fm100/:id | FM100详情 |
| POST | /api/qualification/fm100 | 新增FM100测试 |
| DELETE | /api/qualification/fm100/:id | 删除FM100测试 |

### 统计分析
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/qualification/statistics/overview | 统计概览 |
| GET | /api/qualification/statistics/by-type | 按类型统计 |
| GET | /api/qualification/expiring | 即将到期列表 |

---

## 六、功能特性

### 6.1 人员资质管理
- 统计卡片：人员总数、有效认证、即将到期、已过期
- 人员列表：资质概览（有效/到期/过期数量）、FM100等级
- 人员详情：所有认证记录、考核历史
- 从系统人员库选择或自由输入新增

### 6.2 资质认证
- 支持多种认证等级（初级/中级/高级/合格）
- 自动到期提醒（30天/90天）
- 认证附件上传

### 6.3 FM100色觉测试
- 完整的测试数据录入（TES、√TES、百分位、Vingrys分析）
- 实时等级预览和岗位匹配建议
- 测试报告生成和下载
- 测试通过自动创建/更新资质认证

### 6.4 等级判定标准
| √TES | 等级 | 岗位建议 |
|------|------|----------|
| ≤4.0 | 优异 | 调墨员、色彩管理、终检员 |
| ≤6.0 | 良好 | 印刷机长、首检员、IQC |
| ≤8.0 | 需关注 | 过程检验员、机台操作员 |
| >8.0 | 不达标 | 不建议安排色彩关键岗位 |

---

## 七、依赖说明

### 后端
- express, mssql, multer, path, fs

### 前端
- vue3, element-plus, html2canvas (报告下载)

确保已安装 html2canvas：
```bash
npm install html2canvas
```
