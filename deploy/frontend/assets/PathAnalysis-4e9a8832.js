import{_ as R,r as f,i as S,a as o,k as j,o as i,l as m,d as a,w as t,m as q,c as v,j as K,E as k,b as r,u as x,e as _,F as Q,n as U,q as w,t as p,C as G,K as H,Q as J}from"./index-f6c7c3e7.js";const O={class:"path-analysis-container"},W={class:"card-header"},X={class:"type-distribution"},Y={class:"path-text"},Z={class:"path-text"},ee={key:0},te={key:0},ae={key:1},le={__name:"PathAnalysis",setup(se){const h=f(!1),A=f([]),y=f(null),g=f(!1),n=f(null),P=async()=>{var s,e;h.value=!0;try{const u=localStorage.getItem("token"),d=await K.get("/api/import/analyze-paths",{headers:{Authorization:`Bearer ${u}`}});d.data.success?(A.value=d.data.data.records,y.value=d.data.data.statistics,k.success("路径分析完成")):k.error("分析失败: "+d.data.message)}catch(u){console.error("获取路径分析失败:",u),k.error("获取数据失败: "+(((e=(s=u.response)==null?void 0:s.data)==null?void 0:e.message)||u.message))}finally{h.value=!1}},C=s=>({network_path:"success",relative_path:"warning",other:"danger"})[s]||"info",V=s=>({network_path:"网络路径",relative_path:"相对路径",other:"其他格式"})[s]||s,N=async s=>{n.value=null,g.value=!0;try{n.value={success:s.isAccessible,path:s.normalizedPath,info:s.isAccessible?"路径格式正确，可以访问":null,error:s.isAccessible?null:"路径格式不支持或无法访问"}}catch(e){n.value={success:!1,path:s.normalizedPath,error:e.message}}};return S(()=>{P()}),(s,e)=>{const u=o("el-icon"),d=o("el-button"),T=o("el-statistic"),z=o("el-col"),D=o("el-tag"),E=o("el-row"),M=o("el-card"),c=o("el-table-column"),B=o("el-tooltip"),I=o("el-table"),$=o("el-alert"),F=o("el-dialog"),L=j("loading");return i(),m("div",O,[a(M,{class:"header-card"},{header:t(()=>[r("div",W,[e[3]||(e[3]=r("span",null,"数据库路径格式分析",-1)),a(d,{type:"primary",onClick:P,loading:h.value},{default:t(()=>[a(u,null,{default:t(()=>[a(x(G))]),_:1}),e[2]||(e[2]=_(" 刷新分析 "))]),_:1,__:[2]},8,["loading"])])]),default:t(()=>[y.value?(i(),v(E,{key:0,gutter:20},{default:t(()=>[a(z,{span:8},{default:t(()=>[a(T,{title:"总记录数",value:y.value.total},null,8,["value"])]),_:1}),a(z,{span:16},{default:t(()=>[r("div",X,[e[4]||(e[4]=r("h4",null,"路径类型分布：",-1)),(i(!0),m(Q,null,U(y.value.typeDistribution,(l,b)=>(i(),v(D,{key:b,type:C(b),style:{margin:"4px"}},{default:t(()=>[_(p(V(b))+": "+p(l),1)]),_:2},1032,["type"]))),128))])]),_:1})]),_:1})):w("",!0)]),_:1}),q((i(),v(M,{class:"table-card"},{header:t(()=>e[5]||(e[5]=[r("span",null,"路径详细分析",-1)])),default:t(()=>[a(I,{data:A.value,style:{width:"100%"},"max-height":"600"},{default:t(()=>[a(c,{prop:"id",label:"ID",width:"60"}),a(c,{prop:"customer",label:"客户",width:"100"}),a(c,{prop:"orderNo",label:"工单号",width:"120"}),a(c,{label:"路径类型",width:"120"},{default:t(l=>[a(D,{type:C(l.row.pathType),size:"small"},{default:t(()=>[_(p(V(l.row.pathType)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"原始路径","min-width":"200"},{default:t(l=>[a(B,{content:l.row.originalPath,placement:"top"},{default:t(()=>[r("div",Y,p(l.row.originalPath),1)]),_:2},1032,["content"])]),_:1}),a(c,{label:"标准化路径","min-width":"200"},{default:t(l=>[a(B,{content:l.row.normalizedPath,placement:"top"},{default:t(()=>[r("div",Z,p(l.row.displayPath),1)]),_:2},1032,["content"])]),_:1}),a(c,{label:"可访问性",width:"100"},{default:t(l=>[l.row.isAccessible?(i(),v(u,{key:0,color:"green"},{default:t(()=>[a(x(H))]),_:1})):(i(),v(u,{key:1,color:"red"},{default:t(()=>[a(x(J))]),_:1}))]),_:1}),a(c,{label:"操作",width:"120"},{default:t(l=>[a(d,{type:"text",size:"small",onClick:b=>N(l.row),disabled:!l.row.isAccessible},{default:t(()=>e[6]||(e[6]=[_(" 测试访问 ")])),_:2,__:[6]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})),[[L,h.value]]),a(F,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),title:"路径访问测试",width:"600px"},{footer:t(()=>[a(d,{onClick:e[0]||(e[0]=l=>g.value=!1)},{default:t(()=>e[10]||(e[10]=[_("关闭")])),_:1,__:[10]})]),default:t(()=>[n.value?(i(),m("div",ee,[a($,{title:n.value.success?"访问成功":"访问失败",type:n.value.success?"success":"error",closable:!1,"show-icon":""},{default:t(()=>[r("p",null,[e[7]||(e[7]=r("strong",null,"测试路径:",-1)),_(" "+p(n.value.path),1)]),n.value.success?(i(),m("p",te,[e[8]||(e[8]=r("strong",null,"文件信息:",-1)),_(" "+p(n.value.info),1)])):w("",!0),n.value.success?w("",!0):(i(),m("p",ae,[e[9]||(e[9]=r("strong",null,"错误信息:",-1)),_(" "+p(n.value.error),1)]))]),_:1},8,["title","type"])])):w("",!0)]),_:1},8,["modelValue"])])}}},ne=R(le,[["__scopeId","data-v-eaaec24b"]]);export{ne as default};
