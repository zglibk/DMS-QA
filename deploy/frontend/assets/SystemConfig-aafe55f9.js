import{_ as B,r as y,S as G,i as z,a as m,k as J,o as h,l as k,b as o,d as e,w as a,e as b,u as F,p as Q,m as W,F as X,n as Y,G as le,t as U,c as A,q as T,g as Z,T as te,R as ae,j as N,E as u,y as oe,U as se,V as H,K as ne,W as ie,C as re,x as K}from"./index-5f3a692b.js";const de={class:"connection-config"},ue={class:"config-layout"},ce={class:"config-list-panel"},pe={class:"panel-header"},fe={class:"config-list"},me=["onClick"],ge={class:"config-item-header"},_e={class:"config-name"},ve={class:"config-badges"},be={class:"config-item-info"},ye={class:"config-host"},Ce={class:"config-db"},Ve={class:"config-item-time"},Pe={key:0,class:"empty-list"},he={class:"config-form-panel"},we={class:"form-section"},xe={class:"form-section-header"},Ue={key:0,class:"form-actions-inline"},De={class:"form-section"},ke={class:"form-actions"},Se={__name:"ConnectionConfig",setup(L){const x=y(),f=y(null),_=y(!1),C=y(!1),V=y(!1),r=y([]),i=G({ConfigName:"",Host:"",Port:"1433",DatabaseName:"",DbUser:"",DbPassword:"",Remark:""}),I={ConfigName:[{required:!0,message:"请输入配置名称",trigger:"blur"}],Host:[{required:!0,message:"请输入服务器地址",trigger:"blur"}],DatabaseName:[{required:!0,message:"请输入数据库名",trigger:"blur"}],DbUser:[{required:!0,message:"请输入用户名",trigger:"blur"}],DbPassword:[{required:!0,message:"请输入密码",trigger:"blur"}]},$=async()=>{V.value=!0;try{const l=await N.get("/api/config/db-list");l.data.success&&(r.value=l.data.data)}catch(l){console.error("加载配置失败:",l),u.error("加载配置失败")}finally{V.value=!1}},M=l=>{if(l){const t=r.value.find(c=>c.ID===l);t&&Object.assign(i,{ConfigName:t.ConfigName,Host:t.Host,Port:t.Port||"1433",DatabaseName:t.DatabaseName,DbUser:t.DbUser,DbPassword:t.DbPassword||"",Remark:t.Remark||""})}else Object.assign(i,{ConfigName:"",Host:"",Port:"1433",DatabaseName:"",DbUser:"",DbPassword:"",Remark:""})},E=l=>{f.value=l,M(l)},O=()=>{f.value=null,M(null)},D=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",s=async()=>{_.value||await x.value.validate(async l=>{var t;if(l){_.value=!0;try{const c=f.value?`/api/config/db-config/${f.value}`:"/api/config/db-config",w=f.value?"put":"post",p=await N[w](c,i);p.data.success?(u.success(f.value?"配置更新成功":"配置保存成功"),await $(),!f.value&&((t=p.data.data)!=null&&t.ID)&&(f.value=p.data.data.ID)):u.error(p.data.message||"保存失败")}catch(c){console.error("保存配置失败:",c),u.error("保存配置失败")}finally{_.value=!1}}})},n=async()=>{await x.value.validate(async l=>{if(l){C.value=!0;try{const t=await N.post("/api/config/test-connection",i);t.data.success?u.success("连接测试成功"):u.error(t.data.message||"连接测试失败")}catch(t){console.error("连接测试失败:",t),u.error("连接测试失败")}finally{C.value=!1}}})},d=async()=>{if(f.value)try{await oe.confirm("确定要删除这个配置吗？","确认删除",{type:"warning"});const l=await N.delete(`/api/config/db/${f.value}`);l.data.success?(u.success("配置删除成功"),f.value=null,M(null),await $()):u.error(l.data.message||"删除失败")}catch(l){l!=="cancel"&&(console.error("删除配置失败:",l),u.error("删除配置失败"))}};return z(()=>{$()}),(l,t)=>{const c=m("el-button"),w=m("el-tag"),p=m("el-empty"),g=m("el-input"),P=m("el-form-item"),R=m("el-form"),j=J("loading");return h(),k("div",de,[t[14]||(t[14]=o("div",{class:"config-header"},[o("h3",null,"数据库连接配置"),o("p",null,"配置数据库连接参数和相关设置")],-1)),o("div",ue,[o("div",ce,[o("div",pe,[t[8]||(t[8]=o("h4",null,"配置列表",-1)),e(c,{type:"primary",size:"small",onClick:O,icon:F(Q)},{default:a(()=>t[7]||(t[7]=[b(" 新建配置 ")])),_:1,__:[7]},8,["icon"])]),W((h(),k("div",fe,[(h(!0),k(X,null,Y(r.value,v=>(h(),k("div",{key:v.ID,class:le(["config-item",{active:f.value===v.ID}]),onClick:q=>E(v.ID)},[o("div",ge,[o("span",_e,U(v.ConfigName),1),o("div",ve,[v.IsCurrent?(h(),A(w,{key:0,type:"success",size:"small"},{default:a(()=>t[9]||(t[9]=[b("当前")])),_:1,__:[9]})):T("",!0),v.IsValid?T("",!0):(h(),A(w,{key:1,type:"danger",size:"small"},{default:a(()=>t[10]||(t[10]=[b("无效")])),_:1,__:[10]}))])]),o("div",be,[o("span",ye,U(v.Host),1),o("span",Ce,U(v.DatabaseName),1)]),o("div",Ve,U(D(v.UpdatedAt)),1)],10,me))),128)),r.value.length===0?(h(),k("div",Pe,[e(p,{description:"暂无配置","image-size":80})])):T("",!0)])),[[j,V.value]])]),o("div",he,[e(R,{model:i,rules:I,ref_key:"dbFormRef",ref:x,"label-width":"120px",class:"config-form",onKeydown:te(ae(s,["prevent"]),["enter"])},{default:a(()=>[o("div",we,[o("div",xe,[o("h4",null,U(f.value?"编辑配置":"新建配置"),1),f.value?(h(),k("div",Ue,[e(c,{type:"danger",size:"small",onClick:d,icon:F(Z)},{default:a(()=>t[11]||(t[11]=[b(" 删除配置 ")])),_:1,__:[11]},8,["icon"])])):T("",!0)]),e(P,{label:"配置名称",prop:"ConfigName"},{default:a(()=>[e(g,{modelValue:i.ConfigName,"onUpdate:modelValue":t[0]||(t[0]=v=>i.ConfigName=v),placeholder:"输入配置名称"},null,8,["modelValue"])]),_:1}),e(P,{label:"备注"},{default:a(()=>[e(g,{modelValue:i.Remark,"onUpdate:modelValue":t[1]||(t[1]=v=>i.Remark=v),placeholder:"配置备注（可选）"},null,8,["modelValue"])]),_:1})]),o("div",De,[t[12]||(t[12]=o("h4",null,"数据库配置",-1)),e(P,{label:"服务器地址",prop:"Host"},{default:a(()=>[e(g,{modelValue:i.Host,"onUpdate:modelValue":t[2]||(t[2]=v=>i.Host=v),placeholder:"如：192.168.1.57"},null,8,["modelValue"])]),_:1}),e(P,{label:"端口",prop:"Port"},{default:a(()=>[e(g,{modelValue:i.Port,"onUpdate:modelValue":t[3]||(t[3]=v=>i.Port=v),placeholder:"默认：1433"},null,8,["modelValue"])]),_:1}),e(P,{label:"数据库名",prop:"DatabaseName"},{default:a(()=>[e(g,{modelValue:i.DatabaseName,"onUpdate:modelValue":t[4]||(t[4]=v=>i.DatabaseName=v),placeholder:"如：DMS-QA"},null,8,["modelValue"])]),_:1}),e(P,{label:"用户名",prop:"DbUser"},{default:a(()=>[e(g,{modelValue:i.DbUser,"onUpdate:modelValue":t[5]||(t[5]=v=>i.DbUser=v),placeholder:"数据库用户名"},null,8,["modelValue"])]),_:1}),e(P,{label:"密码",prop:"DbPassword"},{default:a(()=>[e(g,{modelValue:i.DbPassword,"onUpdate:modelValue":t[6]||(t[6]=v=>i.DbPassword=v),type:"password",placeholder:"数据库密码","show-password":""},null,8,["modelValue"])]),_:1})]),o("div",ke,[e(c,{type:"primary",onClick:s,loading:_.value,disabled:_.value},{default:a(()=>[b(U(_.value?f.value?"更新中...":"保存中...":f.value?"更新配置":"新增配置"),1)]),_:1},8,["loading","disabled"]),e(c,{onClick:n,loading:C.value},{default:a(()=>[b(U(C.value?"测试中...":"测试连接"),1)]),_:1},8,["loading"]),f.value?(h(),A(c,{key:0,type:"danger",onClick:d,disabled:_.value},{default:a(()=>t[13]||(t[13]=[b(" 删除配置 ")])),_:1,__:[13]},8,["disabled"])):T("",!0)])]),_:1},8,["model","onKeydown"])])])])}}},Ne=B(Se,[["__scopeId","data-v-92c5618f"]]);const $e={class:"storage-config"},Fe={class:"form-section"},Me={class:"form-section"},Ee={class:"form-section"},Ie={class:"form-actions"},Oe={__name:"StorageConfig",setup(L){const x=y(),f=y(!1),_=y(!1),C=y(!1),V=y(null),r=y(null),i=G({FileStoragePath:"D:\\DMSData\\IMG-VIDEO",ExcelTempPath:"file:///C:\\Users\\TJ\\AppData\\Roaming\\Microsoft\\Excel",NetworkSharePath:"\\\\tj_server\\工作\\品质部\\生产异常周报考核统计",FileServerPort:8080,FileUrlPrefix:"/files",MaxFileSize:50,AllowedExtensions:[".jpg",".jpeg",".png",".gif",".bmp",".webp",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".mp4",".avi",".mov"]}),I={FileStoragePath:[{required:!0,message:"请输入文件存储路径",trigger:"blur"}],FileServerPort:[{required:!0,message:"请输入文件服务端口",trigger:"blur"}],FileUrlPrefix:[{required:!0,message:"请输入URL前缀",trigger:"blur"}]},$=async(D=!1)=>{C.value=!0;try{const s=await N.get("/api/config/db-list");if(s.data.success&&s.data.data.length>0){const n=s.data.data[0];V.value=n.ID,r.value=n,n.FileStoragePath&&(i.FileStoragePath=n.FileStoragePath),n.ExcelTempPath&&(i.ExcelTempPath=n.ExcelTempPath),n.NetworkSharePath&&(i.NetworkSharePath=n.NetworkSharePath),n.FileServerPort&&(i.FileServerPort=n.FileServerPort),n.FileUrlPrefix&&(i.FileUrlPrefix=n.FileUrlPrefix),D&&u.success("配置刷新成功")}else D&&u.warning("未找到配置数据")}catch(s){console.error("加载存储配置失败:",s),u.error("加载存储配置失败")}finally{C.value=!1}},M=()=>{u.info("路径选择功能需要在服务器端实现")},E=async()=>{if(!V.value||!r.value){u.error("未找到配置信息，请先刷新配置");return}await x.value.validate(async D=>{if(D){f.value=!0;try{const s=await N.put(`/api/config/db/${V.value}`,{Host:r.value.Host,DatabaseName:r.value.DatabaseName,DbUser:r.value.DbUser,DbPassword:r.value.DbPassword,ConfigName:r.value.ConfigName,Remark:r.value.Remark||"存储配置已更新",FileStoragePath:i.FileStoragePath,FileServerPort:i.FileServerPort,FileUrlPrefix:i.FileUrlPrefix,ExcelTempPath:i.ExcelTempPath,NetworkSharePath:i.NetworkSharePath});s.data.success?(u.success("存储配置保存成功"),await $()):u.error(s.data.message||"保存失败")}catch(s){console.error("保存存储配置失败:",s),u.error("保存存储配置失败")}finally{f.value=!1}}})},O=async()=>{_.value=!0;try{const D=await N.post("/api/config/test-storage",{path:i.FileStoragePath});D.data.success?u.success("存储路径测试成功"):u.error(D.data.message||"存储路径测试失败")}catch(D){console.error("测试存储失败:",D),u.error("测试存储失败")}finally{_.value=!1}};return z(()=>{$()}),(D,s)=>{const n=m("el-button"),d=m("el-input"),l=m("el-form-item"),t=m("el-input-number"),c=m("el-option"),w=m("el-select"),p=m("el-form");return h(),k("div",$e,[s[20]||(s[20]=o("div",{class:"config-header"},[o("h3",null,"文件存储配置"),o("p",null,"配置文件存储路径和访问方式")],-1)),e(p,{model:i,rules:I,ref_key:"storageFormRef",ref:x,"label-width":"140px",class:"config-form"},{default:a(()=>[o("div",Fe,[s[12]||(s[12]=o("h4",null,"存储路径配置",-1)),e(l,{label:"文件存储路径",prop:"FileStoragePath"},{default:a(()=>[e(d,{modelValue:i.FileStoragePath,"onUpdate:modelValue":s[0]||(s[0]=g=>i.FileStoragePath=g),placeholder:"如：D:\\DMSData\\IMG-VIDEO"},{append:a(()=>[e(n,{onClick:M,icon:"Folder"},{default:a(()=>s[8]||(s[8]=[b("选择")])),_:1,__:[8]})]),_:1},8,["modelValue"]),s[9]||(s[9]=o("div",{class:"form-item-tip"}," 服务器上用于存储上传文件的目录路径 ",-1))]),_:1,__:[9]}),e(l,{label:"临时文件路径",prop:"ExcelTempPath"},{default:a(()=>[e(d,{modelValue:i.ExcelTempPath,"onUpdate:modelValue":s[1]||(s[1]=g=>i.ExcelTempPath=g),placeholder:"如：file:///C:\\Users\\TJ\\AppData\\Roaming\\Microsoft\\Excel"},null,8,["modelValue"]),s[10]||(s[10]=o("div",{class:"form-item-tip"}," Excel临时文件的本地路径前缀 ",-1))]),_:1,__:[10]}),e(l,{label:"网络共享路径",prop:"NetworkSharePath"},{default:a(()=>[e(d,{modelValue:i.NetworkSharePath,"onUpdate:modelValue":s[2]||(s[2]=g=>i.NetworkSharePath=g),placeholder:"如：\\\\tj_server\\工作\\品质部\\生产异常周报考核统计"},null,8,["modelValue"]),s[11]||(s[11]=o("div",{class:"form-item-tip"}," 网络共享目录的UNC路径 ",-1))]),_:1,__:[11]})]),o("div",Me,[s[15]||(s[15]=o("h4",null,"文件服务配置",-1)),e(l,{label:"文件服务端口",prop:"FileServerPort"},{default:a(()=>[e(t,{modelValue:i.FileServerPort,"onUpdate:modelValue":s[3]||(s[3]=g=>i.FileServerPort=g),min:1,max:65535,placeholder:"8080",style:{width:"200px"}},null,8,["modelValue"]),s[13]||(s[13]=o("div",{class:"form-item-tip"}," 文件访问服务的端口号 ",-1))]),_:1,__:[13]}),e(l,{label:"URL前缀",prop:"FileUrlPrefix"},{default:a(()=>[e(d,{modelValue:i.FileUrlPrefix,"onUpdate:modelValue":s[4]||(s[4]=g=>i.FileUrlPrefix=g),placeholder:"/files",style:{width:"200px"}},null,8,["modelValue"]),s[14]||(s[14]=o("div",{class:"form-item-tip"}," 文件访问URL的前缀路径 ",-1))]),_:1,__:[14]})]),o("div",Ee,[s[19]||(s[19]=o("h4",null,"存储限制配置",-1)),e(l,{label:"最大文件大小"},{default:a(()=>[e(t,{modelValue:i.MaxFileSize,"onUpdate:modelValue":s[5]||(s[5]=g=>i.MaxFileSize=g),min:1,max:1024,placeholder:"50",style:{width:"150px"}},null,8,["modelValue"]),s[16]||(s[16]=o("span",{style:{"margin-left":"8px"}},"MB",-1)),s[17]||(s[17]=o("div",{class:"form-item-tip"}," 单个文件的最大允许大小 ",-1))]),_:1,__:[16,17]}),e(l,{label:"允许的文件类型"},{default:a(()=>[e(w,{modelValue:i.AllowedExtensions,"onUpdate:modelValue":s[6]||(s[6]=g=>i.AllowedExtensions=g),multiple:"",placeholder:"选择允许的文件扩展名",style:{width:"100%"}},{default:a(()=>[e(c,{label:".jpg",value:".jpg"}),e(c,{label:".jpeg",value:".jpeg"}),e(c,{label:".png",value:".png"}),e(c,{label:".gif",value:".gif"}),e(c,{label:".bmp",value:".bmp"}),e(c,{label:".webp",value:".webp"}),e(c,{label:".pdf",value:".pdf"}),e(c,{label:".doc",value:".doc"}),e(c,{label:".docx",value:".docx"}),e(c,{label:".xls",value:".xls"}),e(c,{label:".xlsx",value:".xlsx"}),e(c,{label:".ppt",value:".ppt"}),e(c,{label:".pptx",value:".pptx"}),e(c,{label:".mp4",value:".mp4"}),e(c,{label:".avi",value:".avi"}),e(c,{label:".mov",value:".mov"})]),_:1},8,["modelValue"]),s[18]||(s[18]=o("div",{class:"form-item-tip"}," 允许上传的文件类型扩展名 ",-1))]),_:1,__:[18]})]),o("div",Ie,[e(n,{type:"primary",onClick:E,loading:f.value},{default:a(()=>[b(U(f.value?"保存中...":"保存配置"),1)]),_:1},8,["loading"]),e(n,{onClick:O,loading:_.value},{default:a(()=>[b(U(_.value?"测试中...":"测试存储"),1)]),_:1},8,["loading"]),e(n,{onClick:s[7]||(s[7]=()=>$(!0)),loading:C.value},{default:a(()=>[b(U(C.value?"刷新中...":"刷新配置"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])])}}},Te=B(Oe,[["__scopeId","data-v-1f280a32"]]);const Be={class:"path-mapping-config"},Le={class:"mapping-sections"},Re={class:"form-section"},je={class:"mapping-list"},Ae={class:"mapping-header"},Ge={class:"mapping-name"},ze={class:"form-section"},qe={class:"form-section"},He={class:"form-actions"},Ke={__name:"PathMappingConfig",setup(L){const x=y(!1),f=y(!1),_=y(!1),C=y(""),V=y(""),r=y([{name:"Excel临时文件映射",localPattern:"C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\*",targetPattern:"\\\\tj_server\\工作\\品质部\\生产异常周报考核统计\\*",description:"Excel临时文件映射到tj_server共享盘"},{name:"2025年异常汇总映射",localPattern:"*2025年异常汇总\\*",targetPattern:"\\\\tj_server\\工作\\品质部\\生产异常周报考核统计\\2025年异常汇总\\不良图片&资料\\*",description:"2025年异常汇总文件映射"}]),i=G({autoConvert:!0,keepOriginal:!1,fileCopyMode:!0,validatePaths:!1}),I=()=>{r.value.push({id:null,name:"新映射规则",localPattern:"",targetPattern:"",description:"",isActive:!0})},$=s=>{r.value.splice(s,1)},M=async()=>{if(!C.value.trim()){u.warning("请输入要测试的路径");return}f.value=!0;try{const s=await N.post("/api/import/test-path-conversion",{path:C.value,mappings:r.value,config:i});s.data.success?(V.value=s.data.data.convertedPath||"无匹配的映射规则",u.success("路径转换测试完成")):(V.value=s.data.message||"转换失败",u.error("路径转换测试失败"))}catch(s){console.error("测试路径转换失败:",s),V.value="测试失败: "+s.message,u.error("测试路径转换失败")}finally{f.value=!1}},E=async(s=!1)=>{_.value=!0;try{const n=await N.get("/api/import/path-mapping-config");if(n.data.success){const d=n.data.data;if(d.pathMappings){const l=d.pathMappings.filter(t=>t.id!=="server-storage");r.value=l.map(t=>({id:t.id,name:t.name,localPattern:t.localPattern,targetPattern:t.targetPattern,description:t.description,isActive:t.isActive!==!1}))}s&&u.success("配置刷新成功")}else u.error(n.data.message||"加载配置失败")}catch(n){console.error("加载路径映射配置失败:",n),u.error("加载路径映射配置失败")}finally{_.value=!1}},O=async()=>{var s,n;if(!r.value||r.value.length===0){u.warning("请至少添加一个路径映射规则");return}for(let d=0;d<r.value.length;d++){const l=r.value[d];if(!l.name||!l.localPattern||!l.targetPattern){u.error(`第 ${d+1} 个映射规则信息不完整`);return}}x.value=!0;try{const d=await N.put("/api/import/path-mapping-config",{pathMappings:r.value.map(l=>({id:l.id,name:l.name,localPattern:l.localPattern,targetPattern:l.targetPattern,description:l.description||"",isActive:l.isActive!==!1})),conversionConfig:i});d.data.success?(u.success("路径映射配置保存成功"),await E()):u.error(d.data.message||"保存失败")}catch(d){console.error("保存路径映射配置失败:",d),u.error("保存路径映射配置失败: "+(((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)||d.message))}finally{x.value=!1}},D=()=>{r.value=[{name:"Excel临时文件映射",localPattern:"C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\*",targetPattern:"\\\\tj_server\\工作\\品质部\\生产异常周报考核统计\\*",description:"Excel临时文件映射到tj_server共享盘"},{name:"2025年异常汇总映射",localPattern:"*2025年异常汇总\\*",targetPattern:"\\\\tj_server\\工作\\品质部\\生产异常周报考核统计\\2025年异常汇总\\不良图片&资料\\*",description:"2025年异常汇总文件映射"}],Object.assign(i,{autoConvert:!0,keepOriginal:!1,fileCopyMode:!0,validatePaths:!1}),u.success("配置已重置为默认值")};return z(()=>{E()}),(s,n)=>{const d=m("el-button"),l=m("el-input"),t=m("el-form-item"),c=m("el-form"),w=m("el-switch");return h(),k("div",Be,[n[17]||(n[17]=o("div",{class:"config-header"},[o("h3",null,"路径映射配置"),o("p",null,"配置文件路径映射规则和转换方式")],-1)),o("div",Le,[o("div",Re,[n[9]||(n[9]=o("h4",null,"路径映射规则",-1)),o("div",je,[(h(!0),k(X,null,Y(r.value,(p,g)=>(h(),k("div",{key:g,class:"mapping-item"},[o("div",Ae,[o("span",Ge,U(p.name),1),e(d,{type:"danger",size:"small",onClick:P=>$(g),icon:F(Z)},{default:a(()=>n[7]||(n[7]=[b(" 删除 ")])),_:2,__:[7]},1032,["onClick","icon"])]),e(c,{model:p,"label-width":"100px",class:"mapping-form"},{default:a(()=>[e(t,{label:"规则名称"},{default:a(()=>[e(l,{modelValue:p.name,"onUpdate:modelValue":P=>p.name=P,placeholder:"输入规则名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{label:"本地路径"},{default:a(()=>[e(l,{modelValue:p.localPattern,"onUpdate:modelValue":P=>p.localPattern=P,placeholder:"如：C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\*"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{label:"目标路径"},{default:a(()=>[e(l,{modelValue:p.targetPattern,"onUpdate:modelValue":P=>p.targetPattern=P,placeholder:"如：\\\\tj_server\\工作\\品质部\\生产异常周报考核统计\\*"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{label:"描述"},{default:a(()=>[e(l,{modelValue:p.description,"onUpdate:modelValue":P=>p.description=P,placeholder:"规则描述",type:"textarea",rows:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"])]))),128))]),e(d,{type:"primary",onClick:I,icon:F(Q),style:{"margin-top":"16px"}},{default:a(()=>n[8]||(n[8]=[b(" 添加映射规则 ")])),_:1,__:[8]},8,["icon"])]),o("div",ze,[n[14]||(n[14]=o("h4",null,"转换设置",-1)),e(c,{model:i,"label-width":"140px"},{default:a(()=>[e(t,{label:"启用自动转换"},{default:a(()=>[e(w,{modelValue:i.autoConvert,"onUpdate:modelValue":n[0]||(n[0]=p=>i.autoConvert=p)},null,8,["modelValue"]),n[10]||(n[10]=o("div",{class:"form-item-tip"}," 自动将Excel临时路径转换为网络路径 ",-1))]),_:1,__:[10]}),e(t,{label:"保留原始路径"},{default:a(()=>[e(w,{modelValue:i.keepOriginal,"onUpdate:modelValue":n[1]||(n[1]=p=>i.keepOriginal=p)},null,8,["modelValue"]),n[11]||(n[11]=o("div",{class:"form-item-tip"}," 在转换后保留原始路径信息 ",-1))]),_:1,__:[11]}),e(t,{label:"文件拷贝模式"},{default:a(()=>[e(w,{modelValue:i.fileCopyMode,"onUpdate:modelValue":n[2]||(n[2]=p=>i.fileCopyMode=p)},null,8,["modelValue"]),n[12]||(n[12]=o("div",{class:"form-item-tip"}," 启用文件拷贝到服务器存储路径 ",-1))]),_:1,__:[12]}),e(t,{label:"路径验证"},{default:a(()=>[e(w,{modelValue:i.validatePaths,"onUpdate:modelValue":n[3]||(n[3]=p=>i.validatePaths=p)},null,8,["modelValue"]),n[13]||(n[13]=o("div",{class:"form-item-tip"}," 在转换前验证路径是否存在 ",-1))]),_:1,__:[13]})]),_:1},8,["model"])]),o("div",qe,[n[15]||(n[15]=o("h4",null,"路径转换测试",-1)),e(c,{"label-width":"100px"},{default:a(()=>[e(t,{label:"测试路径"},{default:a(()=>[e(l,{modelValue:C.value,"onUpdate:modelValue":n[4]||(n[4]=p=>C.value=p),placeholder:"输入要测试的路径",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(t,null,{default:a(()=>[e(d,{type:"primary",onClick:M,loading:f.value},{default:a(()=>[b(U(f.value?"测试中...":"测试转换"),1)]),_:1},8,["loading"])]),_:1}),V.value?(h(),A(t,{key:0,label:"转换结果"},{default:a(()=>[e(l,{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=p=>V.value=p),type:"textarea",rows:3,readonly:""},null,8,["modelValue"])]),_:1})):T("",!0)]),_:1})])]),o("div",He,[e(d,{type:"primary",onClick:O,loading:x.value},{default:a(()=>[b(U(x.value?"保存中...":"保存配置"),1)]),_:1},8,["loading"]),e(d,{onClick:n[6]||(n[6]=()=>E(!0)),loading:_.value},{default:a(()=>[b(U(_.value?"刷新中...":"刷新配置"),1)]),_:1},8,["loading"]),e(d,{onClick:D},{default:a(()=>n[16]||(n[16]=[b(" 重置为默认 ")])),_:1,__:[16]})])])}}},Je=B(Ke,[["__scopeId","data-v-e508b381"]]);const Qe={class:"site-config"},We={class:"config-header"},Xe={class:"config-title"},Ye={class:"config-content"},Ze={class:"config-section"},el={class:"config-section"},ll={class:"logo-upload-section"},tl={class:"logo-preview"},al=["src"],ol={class:"logo-controls"},sl={class:"logo-tips"},nl={class:"favicon-upload-section"},il={class:"favicon-preview"},rl=["src"],dl={class:"favicon-controls"},ul={class:"favicon-tips"},cl={class:"config-section"},pl={class:"preview-section"},fl={class:"preview-header"},ml={class:"preview-logo-area"},gl=["src"],_l={class:"preview-title"},vl={class:"preview-company"},bl={class:"preview-footer"},yl={class:"config-actions"},Cl={__name:"SiteConfig",setup(L){const x=y(!1),f=y(!1),_=y(!1),C=y(!1),V=y(0),r=G({siteName:"质量数据管理系统",companyName:"DMS质量管理系统",logoBase64Img:"/logo.png",faviconBase64Img:"/logo.png",headerTitle:"质量数据系统",loginTitle:"DMS-QA 质量管理系统",footerCopyright:"© 2025 DMS质量管理系统. All rights reserved."}),i=async(d=!1)=>{x.value=!0;try{const l=await N.get("/api/config/site-config");if(l.data.success){const t=l.data.data;Object.assign(r,t),d&&u.success("配置刷新成功")}}catch(l){console.error("加载网站配置失败:",l),d&&u.error("加载配置失败")}finally{x.value=!1}},I=async()=>{f.value=!0;try{const d=await N.put("/api/config/site-config",r);d.data.success?(u.success("网站配置保存成功"),M(),V.value++,window.dispatchEvent(new CustomEvent("siteConfigUpdated",{detail:r}))):u.error(d.data.message||"保存失败")}catch(d){console.error("保存网站配置失败:",d),u.error("保存配置失败")}finally{f.value=!1}},$=()=>{Object.assign(r,{siteName:"质量数据管理系统",companyName:"DMS质量管理系统",logoBase64Img:"/logo.png",faviconBase64Img:"/logo.png",headerTitle:"质量数据系统",loginTitle:"DMS-QA 质量管理系统",footerCopyright:"© 2025 DMS质量管理系统. All rights reserved."}),u.success("配置已重置为默认值")},M=()=>{document.title=r.siteName;let d=document.querySelector('link[rel="icon"]');d||(d=document.createElement("link"),d.rel="icon",document.head.appendChild(d)),d.href=r.faviconBase64Img},E=d=>{const l=d.type.startsWith("image/"),t=d.size/1024/1024<2;return l?t?!0:(u.error("图片大小不能超过 2MB!"),!1):(u.error("只能上传图片文件!"),!1)},O=d=>{const l=d.type.startsWith("image/"),t=d.size/1024/1024<1;return l?t?!0:(u.error("图片大小不能超过 1MB!"),!1):(u.error("只能上传图片文件!"),!1)},D=async d=>{_.value=!0;try{const l=new FormData;l.append("file",d.file),l.append("type","logo");const t=await N.post("/api/upload/site-image",l,{headers:{"Content-Type":"multipart/form-data"}});t.data.success?(r.logoBase64Img=t.data.data.url,V.value++,u.success("LOGO上传成功"),await K()):u.error(t.data.message||"LOGO上传失败")}catch(l){console.error("LOGO上传失败:",l),u.error("LOGO上传失败")}finally{_.value=!1}},s=async d=>{C.value=!0;try{const l=new FormData;l.append("file",d.file),l.append("type","favicon");const t=await N.post("/api/upload/site-image",l,{headers:{"Content-Type":"multipart/form-data"}});t.data.success?(r.faviconBase64Img=t.data.data.url,V.value++,u.success("网站图标上传成功"),await K()):u.error(t.data.message||"网站图标上传失败")}catch(l){console.error("网站图标上传失败:",l),u.error("网站图标上传失败")}finally{C.value=!1}},n=d=>{d.target.src="/logo.png"};return z(()=>{i()}),(d,l)=>{const t=m("el-icon"),c=m("el-input"),w=m("el-form-item"),p=m("el-col"),g=m("el-row"),P=m("el-button"),R=m("el-upload"),j=m("el-text"),v=m("el-form"),q=m("el-card"),ee=J("loading");return h(),k("div",Qe,[e(q,null,{header:a(()=>[o("div",We,[o("div",Xe,[e(t,null,{default:a(()=>[e(F(se))]),_:1}),l[8]||(l[8]=o("span",null,"网站LOGO配置",-1))]),l[9]||(l[9]=o("div",{class:"config-description"}," 配置网站LOGO、图标和基本信息，支持动态更换 ",-1))])]),default:a(()=>[W((h(),k("div",Ye,[e(v,{model:r,"label-width":"120px",class:"config-form"},{default:a(()=>[o("div",Ze,[l[10]||(l[10]=o("h4",null,"基本信息",-1)),e(g,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[e(w,{label:"网站名称"},{default:a(()=>[e(c,{modelValue:r.siteName,"onUpdate:modelValue":l[0]||(l[0]=S=>r.siteName=S),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(w,{label:"公司名称"},{default:a(()=>[e(c,{modelValue:r.companyName,"onUpdate:modelValue":l[1]||(l[1]=S=>r.companyName=S),placeholder:"请输入公司名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[e(w,{label:"页面头部标题"},{default:a(()=>[e(c,{modelValue:r.headerTitle,"onUpdate:modelValue":l[2]||(l[2]=S=>r.headerTitle=S),placeholder:"请输入页面头部标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(w,{label:"登录页标题"},{default:a(()=>[e(c,{modelValue:r.loginTitle,"onUpdate:modelValue":l[3]||(l[3]=S=>r.loginTitle=S),placeholder:"请输入登录页面标题"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{label:"版权信息"},{default:a(()=>[e(c,{modelValue:r.footerCopyright,"onUpdate:modelValue":l[4]||(l[4]=S=>r.footerCopyright=S),placeholder:"请输入页脚版权信息"},null,8,["modelValue"])]),_:1})]),o("div",el,[l[15]||(l[15]=o("h4",null,"LOGO配置",-1)),e(g,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[e(w,{label:"网站LOGO"},{default:a(()=>[o("div",ll,[o("div",tl,[(h(),k("img",{src:r.logoBase64Img,alt:"LOGO预览",class:"logo-img",key:"logo-"+V.value,onError:n},null,40,al))]),o("div",ol,[e(c,{modelValue:r.logoBase64Img,"onUpdate:modelValue":l[5]||(l[5]=S=>r.logoBase64Img=S),placeholder:"LOGO图片BASE64数据",class:"logo-input"},{append:a(()=>[e(R,{"show-file-list":!1,"before-upload":E,"http-request":D,accept:"image/*"},{default:a(()=>[e(P,{type:"primary",loading:_.value},{default:a(()=>[e(t,null,{default:a(()=>[e(F(H))]),_:1}),l[11]||(l[11]=b(" 上传 "))]),_:1,__:[11]},8,["loading"])]),_:1})]),_:1},8,["modelValue"]),o("div",sl,[e(j,{size:"small",type:"info"},{default:a(()=>l[12]||(l[12]=[b(" 建议尺寸：120x40px，支持PNG、JPG格式，文件大小不超过2MB ")])),_:1,__:[12]})])])])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(w,{label:"网站图标"},{default:a(()=>[o("div",nl,[o("div",il,[(h(),k("img",{src:r.faviconBase64Img,alt:"图标预览",class:"favicon-img",key:"favicon-"+V.value,onError:n},null,40,rl))]),o("div",dl,[e(c,{modelValue:r.faviconBase64Img,"onUpdate:modelValue":l[6]||(l[6]=S=>r.faviconBase64Img=S),placeholder:"网站图标BASE64数据",class:"favicon-input"},{append:a(()=>[e(R,{"show-file-list":!1,"before-upload":O,"http-request":s,accept:"image/*"},{default:a(()=>[e(P,{type:"primary",loading:C.value},{default:a(()=>[e(t,null,{default:a(()=>[e(F(H))]),_:1}),l[13]||(l[13]=b(" 上传 "))]),_:1,__:[13]},8,["loading"])]),_:1})]),_:1},8,["modelValue"]),o("div",ul,[e(j,{size:"small",type:"info"},{default:a(()=>l[14]||(l[14]=[b(" 建议尺寸：32x32px或16x16px，支持PNG、ICO格式，文件大小不超过1MB ")])),_:1,__:[14]})])])])]),_:1})]),_:1})]),_:1})]),o("div",cl,[l[16]||(l[16]=o("h4",null,"预览效果",-1)),o("div",pl,[o("div",fl,[o("div",ml,[(h(),k("img",{src:r.logoBase64Img,alt:"LOGO",class:"preview-logo",key:"preview-logo-"+V.value,onError:n},null,40,gl)),o("span",_l,U(r.headerTitle),1)]),o("div",vl,U(r.companyName),1)]),o("div",bl,U(r.footerCopyright),1)])]),o("div",yl,[e(P,{type:"primary",onClick:I,loading:f.value},{default:a(()=>[e(t,null,{default:a(()=>[e(F(ne))]),_:1}),l[17]||(l[17]=b(" 保存配置 "))]),_:1,__:[17]},8,["loading"]),e(P,{onClick:$},{default:a(()=>[e(t,null,{default:a(()=>[e(F(ie))]),_:1}),l[18]||(l[18]=b(" 重置为默认 "))]),_:1,__:[18]}),e(P,{onClick:l[7]||(l[7]=S=>i(!0))},{default:a(()=>[e(t,null,{default:a(()=>[e(F(re))]),_:1}),l[19]||(l[19]=b(" 刷新配置 "))]),_:1,__:[19]})])]),_:1},8,["model"])])),[[ee,x.value]])]),_:1})])}}},Vl=B(Cl,[["__scopeId","data-v-baa09c2d"]]);const Pl={class:"system-config"},hl={class:"tab-content"},wl={class:"tab-content"},xl={class:"tab-content"},Ul={class:"tab-content"},Dl={__name:"SystemConfig",setup(L){const x=y("connection");return(f,_)=>{const C=m("el-tab-pane"),V=m("el-tabs");return h(),k("div",Pl,[_[1]||(_[1]=o("div",{class:"page-header"},[o("h2",null,"系统配置"),o("p",null,"管理数据库连接、文件存储和路径映射等系统配置")],-1)),e(V,{modelValue:x.value,"onUpdate:modelValue":_[0]||(_[0]=r=>x.value=r),class:"config-tabs"},{default:a(()=>[e(C,{label:"连接配置",name:"connection"},{default:a(()=>[o("div",hl,[e(Ne)])]),_:1}),e(C,{label:"文件存储配置",name:"storage"},{default:a(()=>[o("div",wl,[e(Te)])]),_:1}),e(C,{label:"路径映射配置",name:"mapping"},{default:a(()=>[o("div",xl,[e(Je)])]),_:1}),e(C,{label:"网站LOGO配置",name:"site"},{default:a(()=>[o("div",Ul,[e(Vl)])]),_:1})]),_:1},8,["modelValue"])])}}},Sl=B(Dl,[["__scopeId","data-v-8bec9493"]]);export{Sl as default};
