import{_ as ut,r as v,h as ue,i as it,j as N,a as b,k as dt,o as d,l as m,d as l,w as a,E as c,b as t,m as W,u as w,e as u,c as y,F as ie,n as de,q as _,t as p,v as rt,x as fl,y as oe,z as ml,A as pt,B as ct,C as ke,D as _l,G as Ul,H as vt,s as gl,g as zl,I as ft,J as bl,f as mt,K as _t,L as gt,M as bt,N as yt,O as kt,P as Wl}from"./index-5f3a692b.js";const wt={class:"data-management"},ht={class:"import-section"},xt=["element-loading-text"],Ct={class:"upload-header"},Vt={class:"required-fields-list"},Bt={key:0,class:"file-info"},Tt={class:"sheet-buttons"},St={class:"step-actions"},Dt=["element-loading-text"],Nt={class:"field-selection"},Lt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ut={class:"column-mapping"},zt={class:"mapping-label"},It={class:"step-actions"},Et=["element-loading-text"],Ft={style:{"margin-bottom":"20px"}},Pt={class:"step-actions"},$t={key:3,class:"step-content"},Mt={class:"success-header"},Rt={class:"success-content"},At={class:"success-actions"},Ot={class:"initialize-section"},jt={class:"card-header"},qt={class:"table-categories"},Ht={class:"table-category"},Jt={class:"category-title"},Gt={class:"table-grid"},Qt=["onClick"],Kt={class:"table-info"},Wt={class:"table-name"},Xt={class:"table-details"},Yt={class:"table-code"},Zt={key:0,class:"record-count"},es={class:"table-actions"},ls={class:"table-category"},as={class:"category-title"},ts={class:"table-grid"},ss=["onClick"],os={class:"table-info"},ns={class:"table-name"},us={class:"table-details"},is={class:"table-code"},ds={key:0,class:"record-count"},rs={class:"table-actions"},ps={class:"table-category"},cs={class:"category-title"},vs={class:"table-grid"},fs=["onClick"],ms={class:"table-info"},_s={class:"table-name"},gs={class:"table-details"},bs={class:"table-code"},ys={key:0,class:"record-count"},ks={class:"table-actions"},ws={key:0,class:"operation-area"},hs={class:"operation-header"},xs={class:"operation-content"},Cs={class:"operation-info"},Vs={class:"record-count-large"},Bs={class:"operation-buttons"},Ts={key:0,class:"protected-notice"},Ss={class:"export-section"},Ds={class:"backup-section"},Ns={class:"backup-top-container"},Ls={class:"card-header"},Us={key:0,class:"database-info"},zs={class:"backup-path-config"},Is={class:"backup-path-input"},Es={key:1,class:"no-data"},Fs={class:"card-header"},Ps={class:"tab-description"},$s={class:"backup-path-config",style:{"margin-bottom":"15px"}},Ms={class:"tab-description"},Rs={class:"backup-path-config",style:{"margin-bottom":"15px"}},As={class:"backup-bottom-container"},Os={class:"card-header"},js={key:0},qs={class:"backup-path"},Hs={class:"backup-actions"},Js={key:1,class:"no-data"},Gs={class:"auto-backup-section"},Qs={class:"card-header"},Ks={class:"card-header"},Ws={key:0},Xs={key:1},Ys={class:"manual-trigger",style:{"margin-bottom":"20px"}},Zs={class:"backup-logs"},eo={key:1,class:"no-data"},lo={key:0,class:"backup-detail-content"},ao={class:"card-header"},to={class:"detail-grid"},so={class:"detail-item"},oo={class:"detail-value"},no={class:"detail-item"},uo={class:"detail-value"},io={class:"detail-item"},ro={class:"detail-item"},po={class:"card-header"},co={class:"detail-grid"},vo={class:"detail-item full-width"},fo={class:"path-container"},mo={class:"detail-value path-text"},_o={class:"detail-item"},go={class:"detail-value size-text"},bo={class:"detail-item"},yo={class:"detail-value"},ko={class:"detail-item"},wo={class:"detail-value"},ho={class:"detail-item"},xo={class:"detail-value"},Co={class:"card-header"},Vo={class:"description-content"},Bo={class:"dialog-footer"},To=["element-loading-text"],So={key:0},Do={class:"validation-summary",style:{"margin-bottom":"20px"}},No={key:0,style:{"margin-bottom":"15px"}},Lo={style:{"margin-left":"8px",color:"#F56C6C","font-weight":"bold"}},Uo={key:1,style:{"margin-bottom":"15px"}},zo={style:{"margin-left":"8px",color:"#E6A23C","font-weight":"bold"}},Io={style:{"margin-bottom":"10px"}},Eo={key:2},Fo={style:{"margin-left":"8px",color:"#E6A23C","font-weight":"bold"}},Po={style:{display:"flex","justify-content":"space-between","align-items":"center"}},$o={key:0},Mo={style:{"text-align":"center",padding:"20px"}},Ro={style:{"margin-top":"20px"}},Ao={key:0},Oo={class:"import-result"},jo={key:0,class:"result-details"},qo={key:0,class:"error-list"},Ho={key:0},Jo={key:1},Go={key:0},Qo={key:0},Ko={key:1},Wo={class:"initialize-confirm-content"},Xo={class:"confirm-steps"},Yo={class:"password-confirm"},Zo={class:"dialog-footer"},en={class:"initialize-result-content"},ln={class:"dialog-footer"},an={__name:"DataManagement",setup(tn){const Fe=v("import"),j=v(0),$=v(null),le=v(!1),me=v(!1),U=v(""),M=v({}),V=v([]),B=v({}),X=v([]),Pe=v([]),$e=v(0),Me=v(!1),Re=v(null),Xl=v(!0),_e=v(!1),we=v([]),ae=v(""),yl=v(0),kl=v(0),he=v(!1),q=v({}),re=v(!1),Ae=v(!1),ge=v(!1),L=v({}),z=v([]),xe=v(!0),Ce=v(!1),A=v({current:0,total:0,percentage:0,status:"not_started",message:"准备中..."}),pe=v([]),te=v({}),D=v(null),Oe=v(!1),je=v(!1),Ve=v(!1),qe=v(!1),H=v({}),He=v(!1),Je=v(!1),Ge=v(!1),Be=v(""),wl=v(""),Il=v(),J=v(null),Qe=v(!1),Ke=v([]),We=v(!1),ce=v(!1),Te=v("\\\\tj_server\\工作\\DMS备份"),Xe=v(!1),El=v("manual"),hl=v("default"),Ye=v({serverPath:""}),xl=v(!1),Se=v({networkPath:"\\\\tj_server\\公共\\杂七杂八\\品质部临时文件"}),Cl=v(!1),O=v({backupName:"",backupType:"FULL",description:""}),x=v({enabled:!1,frequency:"daily",backupTime:"02:00",weekDay:0,monthDay:1,retentionCount:7,backupType:"FULL",backupScheme:"default"}),Ze=v(!1),De=v(!1),se=v(null),el=v(!1),Fl=v([]),Vl=v(!1),Pl=ue({get(){return V.value.length===Object.keys(M.value).length},set(o){o?V.value=Object.keys(M.value):V.value=[]}}),Yl=ue(()=>J.value?[{label:"数据库名称",value:J.value.databaseName},{label:"服务器名称",value:J.value.serverName},{label:"表数量",value:`${J.value.tableCount} 个`},{label:"总记录数",value:`${Fa(J.value.totalRecords)} 条`},{label:"已用空间",value:`${J.value.usedSizeMB} MB`},{label:"总空间",value:`${J.value.totalSizeMB} MB`},{label:"可用空间",value:`${J.value.freeSpaceMB} MB`}]:[]),Zl=ue(()=>{const o=Object.keys(M.value).length,e=V.value.length;return e>0&&e<o}),ea=ue(()=>pe.value.filter(o=>o.tableType==="business")),la=ue(()=>pe.value.filter(o=>o.tableType==="basic")),aa=ue(()=>pe.value.filter(o=>o.tableType==="system")),ta=ue(()=>He.value&&Je.value&&Ge.value&&Be.value==="RESET_TABLE_DATA"),sa=ue(()=>V.value.map(o=>{var e,n;return{field:(e=M.value[o])==null?void 0:e.label,excelColumn:X.value[B.value[o]]||"未选择",required:((n=M.value[o])==null?void 0:n.required)||!1}})),oa=async o=>{$.value&&$.value.name===o.name&&await da(),Ne(),await fl(),$.value=o.raw,j.value=0},na=()=>{$.value=null,Ne()},ua=()=>{_e.value=!1,we.value=[],ae.value="",yl.value++},ia=()=>{c.warning("只能选择一个文件")},da=async()=>{kl.value++,await fl(),await fl()},ra=o=>{const e=o.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||o.type==="application/vnd.ms-excel",n=o.size/1024/1024<20;return e?(n||c.error("文件大小不能超过20MB!"),!1):(c.error("只能上传Excel文件!"),!1)},$l=()=>{$.value=null,Il.value.clearFiles(),Ne()},Ne=()=>{V.value=[],B.value={},X.value=[],Pe.value=[],$e.value=0,_e.value=!1,we.value=[],ae.value="",j.value=0,yl.value++,kl.value++},pa=()=>{$.value=null,Ne(),le.value=!1,me.value=!1,re.value=!1,U.value="",A.value={current:0,total:0,percentage:0,status:"not_started",message:"准备中..."},Ce.value=!1,c.success("已重置导入流程，可以重新开始")},ca=async()=>{var o,e;if(!$.value){c.warning("请先选择文件");return}_e.value=!1,we.value=[],ae.value="",le.value=!0,U.value="正在读取Excel文件结构...";try{const n=new FormData;n.append("file",$.value),U.value="正在解析Excel工作表...";const r=await N.post("/api/import/preview",n,{headers:{"Content-Type":"multipart/form-data"}});if(r.data.success){const i=r.data.data;if(i.hasMultipleSheets){U.value="检测到多个工作表，准备选择界面...",_e.value=!0,we.value=i.sheetNames,c.info("检测到多个工作表，请选择要导入的工作表");return}U.value="正在加载预览数据...",Ml(i)}else c.error(r.data.message||"预览失败")}catch(n){console.error("预览文件失败:",n),c.error("预览文件失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{le.value=!1,U.value=""}},va=async o=>{var e,n;if(!$.value){c.warning("请先选择文件");return}le.value=!0,U.value=`正在读取工作表"${o}"...`;try{const r=new FormData;r.append("file",$.value),r.append("sheetName",o),U.value=`正在解析工作表"${o}"的数据...`;const i=await N.post("/api/import/preview-sheet",r,{headers:{"Content-Type":"multipart/form-data"}});i.data.success?(ae.value=o,U.value="正在生成预览数据...",Ml(i.data.data)):c.error(i.data.message||"预览失败")}catch(r){console.error("预览工作表失败:",r),c.error("预览工作表失败: "+(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||r.message))}finally{le.value=!1,U.value=""}},Ml=o=>{X.value=o.headers,Pe.value=o.previewData.map(n=>{const r={};return n.forEach((i,f)=>{r[f.toString()]=i}),r}),$e.value=o.totalRows,ae.value=o.selectedSheet,j.value=1;const e=Object.keys(M.value).filter(n=>M.value[n].required);V.value=[...e],c.success("文件预览成功")},fa=o=>{o?(V.value=Object.keys(M.value),ma()):(V.value=[],B.value={})},ma=()=>{const o=Object.keys(M.value),e=Object.keys(B.value);if(e.length>0){const n=e[0],r=B.value[n];if(r!=null){const i=o.indexOf(n);o.forEach((f,g)=>{const C=r+(g-i);C>=0&&C<X.value.length&&(B.value[f]=C)}),c.success(`已自动映射 ${o.length} 个字段到Excel列`)}}else c.info("请先为第一个字段选择Excel列，然后重新点击全选以启用自动映射")},_a=()=>{var e;if(V.value.length===0){c.warning("请先选择要导入的字段");return}const o=Object.keys(B.value).filter(n=>B.value[n]!==void 0&&B.value[n]!==null);if(o.length===0){let n=0;V.value.forEach((r,i)=>{var il;const f=((il=M.value[r])==null?void 0:il.label)||"";let g=-1,C=0;if(X.value.forEach((S,Y)=>{if(Object.values(B.value).includes(Y))return;const Ue=ga(f,S);Ue>C&&Ue>.3&&(C=Ue,g=Y)}),g>=0)B.value[r]=g,n++;else if(i<X.value.length){for(let S=0;S<X.value.length;S++)if(!Object.values(B.value).includes(S)){B.value[r]=S;break}}}),c.success(`智能映射完成：匹配到 ${n} 个相似字段名，其余按顺序分配`)}else{const n=o[0],r=B.value[n],i=V.value.indexOf(n);V.value.forEach((f,g)=>{const C=r+(g-i);C>=0&&C<X.value.length&&(B.value[f]=C)}),c.success(`已基于"${(e=M.value[n])==null?void 0:e.label}"的映射自动映射其他字段`)}},ga=(o,e)=>{if(!o||!e)return 0;const n=o.toLowerCase().replace(/\s+/g,""),r=e.toLowerCase().replace(/\s+/g,"");if(n===r)return 1;if(n.includes(r)||r.includes(n))return .8;const i={日期:["date","时间","日期"],客户:["customer","客户","用户"],工单:["order","wo","工单","订单"],产品:["product","产品","商品"],数量:["qty","quantity","数量"],金额:["amount","money","金额","价格"],备注:["remark","note","备注","说明"],附件:["attachment","file","附件","文件"]};for(const[f,g]of Object.entries(i))if(n.includes(f)&&g.some(C=>r.includes(C)))return .6;return 0},ba=()=>{B.value={},c.success("已清空所有字段映射")},ya=o=>{Object.keys(B.value).forEach(e=>{o.includes(e)||delete B.value[e]})},ka=async()=>{Ae.value=!0;try{await new Promise(o=>setTimeout(o,100)),z.value=[...L.value.conversions],c.success(`已选择 ${L.value.conversions.length} 个智能转换建议`)}finally{Ae.value=!1}},wa=()=>{z.value=[]},Rl=async(o=null)=>{var n,r;if(!$.value){c.warning("请先选择文件");return}if(V.value.length===0){c.warning("请至少选择一个字段");return}if(V.value.filter(i=>B.value[i]===void 0).length>0){c.warning("请为所有选择的字段配置Excel列映射");return}re.value=!0,U.value="正在准备数据校验...";try{const i=new FormData;i.append("file",$.value),i.append("selectedFields",JSON.stringify(V.value)),i.append("columnMapping",JSON.stringify(B.value)),i.append("strictValidation",xe.value.toString()),ae.value&&i.append("selectedSheet",ae.value),o&&i.append("applyConversions",JSON.stringify(o)),U.value="正在校验数据格式和完整性。。。";const f=await N.post("/api/import/validate",i,{headers:{"Content-Type":"multipart/form-data"}});f.data.success?(U.value="正在生成校验报告...",L.value=f.data.data,z.value=[],ge.value=!0):c.error(f.data.message||"数据校验失败")}catch(i){console.error("数据校验失败:",i),c.error("数据校验失败: "+(((r=(n=i.response)==null?void 0:n.data)==null?void 0:r.message)||i.message))}finally{re.value=!1,U.value=""}},ha=async()=>{if(z.value.length===0){c.warning("请先选择要应用的转换建议");return}try{await oe.confirm(`确定要应用 ${z.value.length} 个转换建议吗？应用后将重新校验数据。`,"确认应用转换",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}ge.value=!1;const o=[...z.value];z.value=[],await Rl(o)},Al=async()=>{var n,r;if(V.value.filter(i=>B.value[i]===void 0).length>0){c.warning("请为所有选择的字段配置Excel列映射");return}try{await oe.confirm(`确定要导入 ${$e.value} 行数据吗？

Excel中的本地文件将自动拷贝到服务器指定目录。

此操作不可撤销。`,"确认导入",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}wl.value="import_"+Date.now(),Ce.value=!0,A.value={current:0,total:0,percentage:0,status:"starting",message:"准备导入..."};const e=setInterval(async()=>{try{const i=await N.get(`/api/import/progress/${wl.value}`);i.data.success&&(A.value=i.data.data,(A.value.status==="completed"||A.value.status==="error")&&(clearInterval(e),A.value.status==="completed"&&(j.value=3),setTimeout(()=>{Ce.value=!1},2e3)))}catch(i){console.error("获取进度失败:",i)}},500);me.value=!0,U.value="正在启动数据导入任务...";try{const i=new FormData;i.append("file",$.value),i.append("selectedFields",JSON.stringify(V.value)),i.append("columnMapping",JSON.stringify(B.value)),i.append("sessionId",wl.value),i.append("strictValidation",xe.value.toString()),i.append("enableFileCopy",Xl.value.toString()),ae.value&&i.append("selectedSheet",ae.value),z.value.length>0&&i.append("applyConversions",JSON.stringify(z.value));const f="/api/import/execute-with-copy";U.value="正在执行数据导入（文件拷贝模式），请查看进度对话框...";const g=await N.post(f,i,{headers:{"Content-Type":"multipart/form-data"}});q.value=g.data,he.value=!0,g.data.success&&c.success("数据导入成功")}catch(i){console.error("导入失败:",i),q.value={success:!1,message:((r=(n=i.response)==null?void 0:n.data)==null?void 0:r.message)||i.message},he.value=!0}finally{me.value=!1,U.value=""}},xa=()=>{he.value=!1,$l(),Ne()},Ca=o=>{Re.value=o,Me.value=!0},Va=o=>o?Object.keys(o).map(e=>{var n;return{field:((n=M.value[e])==null?void 0:n.label)||e,value:o[e]}}):[],Ba=async()=>{try{const o=await N.get("/api/import/field-mapping");o.data.success&&(M.value=o.data.data)}catch(o){console.error("获取字段映射失败:",o),c.error("获取字段映射失败")}},Ta=async()=>{var o,e;try{const n=await N.get("/api/import/template",{responseType:"blob"}),r=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(r),f=document.createElement("a");f.href=i,f.download="质量异常数据导入模板.xlsx",document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(i),c.success("模板下载成功")}catch(n){console.error("下载模板失败:",n),c.error("下载模板失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}},ll=async()=>{var o,e;Oe.value=!0;try{const n=await N.get("/api/config/table-list");n.data.success?(pe.value=n.data.data,await Sa()):c.error("获取表列表失败: "+n.data.message)}catch(n){console.error("获取表列表失败:",n),c.error("获取表列表失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{Oe.value=!1}},Sa=async()=>{const o=pe.value.map(e=>Ol(e.tableName));await Promise.all(o)},Ol=async o=>{try{const e=await N.get(`/api/config/table-stats/${o}`);e.data.success&&(te.value[o]=e.data.data)}catch(e){console.error(`获取表 ${o} 统计失败:`,e)}},Da=async()=>{await ll(),c.success("表列表已刷新")},Bl=o=>{D.value=o},Na=o=>{switch(o){case"business":return"primary";case"basic":return"success";case"system":return"warning";default:return"info"}},La=o=>{switch(o){case"business":return"业务数据表";case"basic":return"基础数据表";case"system":return"系统配置表";default:return"未知类型"}},Ua=()=>{He.value=!1,Je.value=!1,Ge.value=!1,Be.value="",Ve.value=!0},za=()=>{Ve.value=!1},Ia=async()=>{var o,e;if(!D.value){c.error("请选择要初始化的表");return}je.value=!0;try{const n=await N.post("/api/config/initialize-table",{tableName:D.value.tableName,confirmPassword:Be.value});n.data.success?(H.value={success:!0,message:n.data.message,data:n.data.data},await Ol(D.value.tableName),c.success("表初始化成功")):(H.value={success:!1,message:n.data.message},c.error("初始化失败: "+n.data.message))}catch(n){console.error("初始化表失败:",n);const r=((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message;H.value={success:!1,message:r},c.error("初始化失败: "+r)}finally{je.value=!1,Ve.value=!1,qe.value=!0}},Ea=()=>{qe.value=!1,D.value=null},Fa=o=>o==null?"0":o.toLocaleString(),al=o=>{if(o==null||o==="")return"-";const e=parseInt(o)||0;if(e===0)return"0 B";const n=1024,r=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(2))+" "+r[i]},tl=o=>o?new Date(o).toLocaleString("zh-CN"):"-";it(()=>{Ba(),Fe.value==="initialize"&&ll(),Fe.value==="backup"&&(sl(),ve(),pe.value.length===0&&ll())});const Pa=o=>{o==="initialize"&&pe.value.length===0&&ll(),o==="backup"&&fl(()=>{J.value||sl(),Ke.value.length===0&&ve()})},sl=async()=>{Qe.value=!0;try{const o=await N.get("/api/config/database-info");o.data.success?(J.value=o.data.data,o.data.data.backupPath&&(Te.value=o.data.data.backupPath)):console.warn("获取数据库信息失败:",o.data.message)}catch(o){console.error("获取数据库信息失败:",o)}finally{Qe.value=!1}},ve=async()=>{We.value=!0;try{const o=await N.get("/api/config/backup-list");o.data.success?Ke.value=o.data.data:console.warn("获取备份列表失败:",o.data.message)}catch(o){console.error("获取备份列表失败:",o)}finally{We.value=!1}},$a=async()=>{var o,e;if(!O.value.backupName.trim()){c.warning("请输入备份名称");return}try{await oe.confirm("确定要创建数据库备份吗？备份过程可能需要一些时间。","确认备份",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),ce.value=!0;const n=await N.post("/api/config/create-backup",{backupName:O.value.backupName.trim(),backupType:O.value.backupType,description:O.value.description.trim(),backupScheme:hl.value});if(n.data.success){const r=n.data.data;c.success("数据库备份创建成功"),oe.alert(`备份创建成功！

备份名称: ${r.backupName}
备份路径: ${r.backupPath}
文件大小: ${al(r.backupSize)}`,"备份成功",{confirmButtonText:"确定",type:"success"}),jl(),await ve()}else c.error("创建备份失败: "+n.data.message)}catch(n){n!=="cancel"&&(console.error("创建备份失败:",n),c.error("创建备份失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message)))}finally{ce.value=!1}},jl=()=>{O.value={backupName:"",backupType:"FULL",description:""}},ol=o=>{switch(o){case"SUCCESS":return"success";case"FAILED":return"danger";case"RUNNING":return"warning";case"PENDING":return"info";default:return"info"}},nl=o=>{switch(o){case"SUCCESS":return"成功";case"FAILED":return"失败";case"RUNNING":return"进行中";case"PENDING":return"等待中";default:return"未知"}},Le=v(!1),E=v(null),Ma=o=>{E.value=o,Le.value=!0},Ra=()=>{Le.value=!1,E.value=null},Aa=async o=>{try{await navigator.clipboard.writeText(o),c.success("备份路径已复制到剪贴板")}catch{const n=document.createElement("textarea");n.value=o,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),c.success("备份路径已复制到剪贴板")}},Oa=async()=>{var o,e;if(!Te.value.trim()){c.warning("请输入备份路径");return}Xe.value=!0;try{const n=await N.post("/api/config/backup-path",{backupPath:Te.value.trim()});n.data.success?(c.success("备份路径配置保存成功"),await sl()):c.error("保存备份路径失败: "+n.data.message)}catch(n){console.error("保存备份路径失败:",n),c.error("保存备份路径失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{Xe.value=!1}},ja=o=>{console.log("切换到备份子标签页:",o),o==="auto"&&(ql(),ul())},qa=o=>{console.log("切换到备份方案:",o)},Ha=async()=>{var o,e;xl.value=!0;try{const n=await N.post("/api/config/default-backup-path",{serverPath:Ye.value.serverPath.trim()});n.data.success?c.success("默认备份路径保存成功"):c.error("保存失败: "+n.data.message)}catch(n){console.error("保存默认备份路径失败:",n),c.error("保存失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{xl.value=!1}},Ja=async()=>{var o,e;if(!Se.value.networkPath.trim()){c.warning("请输入网络路径");return}Cl.value=!0;try{const n=await N.post("/api/config/alternative-backup-path",{networkPath:Se.value.networkPath.trim()});n.data.success?c.success("备选方案路径保存成功"):c.error("保存失败: "+n.data.message)}catch(n){console.error("保存备选方案路径失败:",n),c.error("保存失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{Cl.value=!1}},Ga=async o=>{var e,n;try{const{value:r}=await oe.prompt("请输入新的备份路径","更新备份路径",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:o.BackupPath,inputPlaceholder:"请输入完整的备份文件路径"});if(r&&r.trim()!==o.BackupPath){const i=await N.post("/api/config/update-backup-path",{backupId:o.ID,newPath:r.trim()});i.data.success?(c.success("备份路径更新成功"),await ve()):c.error("更新失败: "+i.data.message)}}catch(r){r!=="cancel"&&(console.error("更新备份路径失败:",r),c.error("更新失败: "+(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||r.message)))}},Qa=async o=>{var e,n;try{c.info("正在验证备份文件...");const r=await N.post("/api/config/verify-backup",{backupId:o.ID,backupPath:o.BackupPath});if(r.data.success){const i=r.data.data;oe.alert(`文件验证结果：

文件存在：${i.exists?"是":"否"}
文件大小：${al(i.size||0)}
最后修改：${i.lastModified||"未知"}`,"验证结果",{confirmButtonText:"确定",type:i.exists?"success":"error"})}else c.error("验证失败: "+r.data.message)}catch(r){console.error("验证备份文件失败:",r),c.error("验证失败: "+(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||r.message))}},Ka=o=>{c.info("备份文件位于网络路径，请通过文件管理器访问："+o.BackupPath)},Wa=async o=>{var e,n;try{await oe.confirm(`确定要删除备份记录"${o.BackupName}"吗？

注意：这只会删除数据库中的记录，不会删除实际的备份文件。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const r=await N.delete(`/api/config/backup-record/${o.ID}`);r.data.success?(c.success("备份记录删除成功"),await ve()):c.error("删除失败: "+r.data.message)}catch(r){r!=="cancel"&&(console.error("删除备份记录失败:",r),c.error("删除失败: "+(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||r.message)))}},ql=async()=>{var o,e;Ze.value=!0;try{const n=await N.get("/api/config/auto-backup-config");n.data.success?x.value={...x.value,...n.data.data}:console.warn("获取自动备份配置失败:",n.data.message)}catch(n){console.error("获取自动备份配置失败:",n),c.error("获取自动备份配置失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{Ze.value=!1}},Xa=async()=>{var o,e;De.value=!0;try{const n=await N.post("/api/config/auto-backup-config",x.value);n.data.success?(c.success("自动备份配置保存成功"),await ul()):c.error("保存失败: "+n.data.message)}catch(n){console.error("保存自动备份配置失败:",n),c.error("保存失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{De.value=!1}},Ya=()=>{x.value={enabled:!1,frequency:"daily",backupTime:"02:00",weekDay:0,monthDay:1,retentionCount:7,backupType:"FULL",backupScheme:"default"}},Za=async o=>{if(o)try{await oe.confirm(`启用自动备份后，系统将按照设定的时间自动创建数据库备份。

请确保已正确配置备份路径和相关权限。`,"确认启用自动备份",{confirmButtonText:"确定启用",cancelButtonText:"取消",type:"warning"})}catch(e){if(e==="cancel"){x.value.enabled=!1;return}}},ul=async()=>{var o,e;el.value=!0;try{const n=await N.get("/api/config/auto-backup-status");n.data.success?(se.value=n.data.data,Fl.value=n.data.data.recentLogs||[]):console.warn("获取自动备份状态失败:",n.data.message)}catch(n){console.error("获取自动备份状态失败:",n),c.error("获取自动备份状态失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message))}finally{el.value=!1}},et=async()=>{var o,e;try{await oe.confirm("确定要立即执行一次自动备份任务吗？","确认执行备份",{confirmButtonText:"确定执行",cancelButtonText:"取消",type:"warning"}),Vl.value=!0;const n=await N.post("/api/config/trigger-auto-backup");n.data.success?(c.success("备份任务已触发，请稍后查看备份状态"),setTimeout(()=>{ul(),ve()},2e3)):c.error("触发备份失败: "+n.data.message)}catch(n){n!=="cancel"&&(console.error("触发备份失败:",n),c.error("触发备份失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message)))}finally{Vl.value=!1}};return(o,e)=>{const n=b("el-step"),r=b("el-steps"),i=b("el-icon"),f=b("el-button"),g=b("el-tag"),C=b("el-alert"),il=b("el-upload"),S=b("el-card"),Y=b("el-checkbox"),dl=b("el-divider"),Ue=b("el-checkbox-group"),G=b("el-col"),F=b("el-option"),be=b("el-select"),ze=b("el-row"),h=b("el-table-column"),Z=b("el-table"),I=b("el-descriptions-item"),Ie=b("el-descriptions"),Hl=b("el-switch"),Tl=b("el-result"),ne=b("el-tab-pane"),rl=b("el-empty"),ye=b("el-input"),P=b("el-form-item"),ee=b("el-text"),pl=b("el-form"),Sl=b("el-tabs"),Jl=b("Clock"),lt=b("el-tooltip"),at=b("el-button-group"),cl=b("el-dropdown-item"),tt=b("el-dropdown-menu"),st=b("el-dropdown"),ot=b("el-time-picker"),Gl=b("el-input-number"),fe=b("el-dialog"),vl=b("el-statistic"),Dl=b("el-collapse-item"),Nl=b("el-collapse"),nt=b("el-progress"),Q=dt("loading");return d(),m("div",wt,[l(S,{class:"page-card"},{header:a(()=>e[43]||(e[43]=[t("div",{class:"card-header"},[t("h2",null,"数据管理"),t("p",null,"管理系统数据的导入导出功能")],-1)])),default:a(()=>[l(Sl,{modelValue:Fe.value,"onUpdate:modelValue":e[25]||(e[25]=s=>Fe.value=s),class:"data-tabs",onTabChange:Pa},{default:a(()=>[l(ne,{label:"质量异常数据导入",name:"import"},{default:a(()=>[t("div",ht,[l(r,{active:j.value,"finish-status":"success","align-center":""},{default:a(()=>[l(n,{title:"选择文件",description:"上传Excel文件"}),l(n,{title:"字段映射",description:"配置字段对应关系"}),l(n,{title:"导入数据",description:"执行数据导入"})]),_:1},8,["active"]),j.value===0?W((d(),m("div",{key:0,class:"step-content","element-loading-text":U.value||"正在处理Excel文件..."},[l(S,{class:"upload-card"},{header:a(()=>[t("div",Ct,[e[45]||(e[45]=t("h3",null,"上传Excel文件",-1)),l(f,{type:"primary",size:"small",onClick:Ta},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ml))]),_:1}),e[44]||(e[44]=u(" 下载模板 "))]),_:1,__:[44]})])]),default:a(()=>[l(C,{title:"必填字段说明",type:"info",closable:!1,"show-icon":"",class:"required-fields-alert"},{default:a(()=>[e[55]||(e[55]=t("p",null,[t("strong",null,"以下字段为必填项，请确保Excel文件中包含这些列：")],-1)),t("div",Vt,[l(g,{type:"danger",size:"small"},{default:a(()=>e[46]||(e[46]=[u("投诉日期")])),_:1,__:[46]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[47]||(e[47]=[u("客户编号")])),_:1,__:[47]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[48]||(e[48]=[u("工单号")])),_:1,__:[48]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[49]||(e[49]=[u("产品名称")])),_:1,__:[49]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[50]||(e[50]=[u("生产数量")])),_:1,__:[50]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[51]||(e[51]=[u("投诉类别")])),_:1,__:[51]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[52]||(e[52]=[u("不良类别")])),_:1,__:[52]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[53]||(e[53]=[u("不良项")])),_:1,__:[53]}),l(g,{type:"danger",size:"small"},{default:a(()=>e[54]||(e[54]=[u("不良描述")])),_:1,__:[54]})])]),_:1}),(d(),y(il,{ref_key:"uploadRef",ref:Il,key:kl.value,class:"upload-demo",drag:"","auto-upload":!1,"on-change":oa,"on-remove":na,"before-upload":ra,"on-exceed":ia,onClick:ua,accept:".xlsx,.xls",limit:1},{tip:a(()=>e[56]||(e[56]=[t("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过20MB ",-1)])),default:a(()=>[l(i,{class:"el-icon--upload"},{default:a(()=>[l(w(pt))]),_:1}),e[57]||(e[57]=t("div",{class:"el-upload__text"},[u(" 将Excel文件拖到此处，或"),t("em",null,"点击上传")],-1))]),_:1,__:[57]})),$.value?(d(),m("div",Bt,[l(C,{title:`已选择文件: ${$.value.name}`,type:"success",closable:!1,"show-icon":""},null,8,["title"]),_e.value?(d(),m("div",{key:yl.value,class:"sheet-selection",style:{"margin-top":"15px"}},[l(C,{title:"检测到多个工作表",description:"请选择要导入数据的工作表",type:"info",closable:!1,style:{"margin-bottom":"15px"}}),t("div",Tt,[(d(!0),m(ie,null,de(we.value,s=>(d(),y(f,{key:s,type:"primary",plain:"",onClick:k=>va(s),loading:le.value,style:{"margin-right":"10px","margin-bottom":"10px"}},{default:a(()=>[u(p(s),1)]),_:2},1032,["onClick","loading"]))),128))])])):_("",!0),t("div",St,[l(f,{onClick:$l},{default:a(()=>e[58]||(e[58]=[u("重新选择")])),_:1,__:[58]}),_e.value?_("",!0):(d(),y(f,{key:0,type:"primary",onClick:ca,loading:le.value},{default:a(()=>e[59]||(e[59]=[u(" 预览文件 ")])),_:1,__:[59]},8,["loading"]))])])):_("",!0)]),_:1})],8,xt)),[[Q,le.value]]):_("",!0),j.value===1?W((d(),m("div",{key:1,class:"step-content","element-loading-text":U.value||"正在准备字段映射..."},[l(ze,{gutter:20},{default:a(()=>[l(G,{span:12},{default:a(()=>[l(S,{class:"field-selection-card"},{header:a(()=>e[60]||(e[60]=[t("h3",null,"选择要导入的字段",-1)])),default:a(()=>[t("div",Nt,[l(Y,{modelValue:Pl.value,"onUpdate:modelValue":e[0]||(e[0]=s=>Pl.value=s),indeterminate:Zl.value,onChange:fa},{default:a(()=>e[61]||(e[61]=[u(" 全选 ")])),_:1,__:[61]},8,["modelValue","indeterminate"]),l(dl),l(Ue,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),onChange:ya},{default:a(()=>[(d(!0),m(ie,null,de(M.value,(s,k)=>(d(),m("div",{key:k,class:"field-item"},[l(Y,{label:k},{default:a(()=>[u(p(s.label)+" ",1),s.required?(d(),y(g,{key:0,type:"danger",size:"small"},{default:a(()=>e[62]||(e[62]=[u("必填")])),_:1,__:[62]})):_("",!0)]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(G,{span:12},{default:a(()=>[l(S,{class:"column-mapping-card"},{header:a(()=>[t("div",Lt,[e[65]||(e[65]=t("h3",null,"字段与Excel列的对应关系",-1)),t("div",null,[Object.keys(B.value).length>0?(d(),y(f,{key:0,size:"small",onClick:ba},{default:a(()=>e[63]||(e[63]=[u(" 清空映射 ")])),_:1,__:[63]})):_("",!0),V.value.length>1?(d(),y(f,{key:1,type:"primary",size:"small",onClick:_a,disabled:V.value.length===0,style:{"margin-left":"8px"}},{default:a(()=>e[64]||(e[64]=[u(" 智能映射 ")])),_:1,__:[64]},8,["disabled"])):_("",!0)])])]),default:a(()=>[t("div",Ut,[V.value.length>1&&Object.keys(B.value).length===0?(d(),y(C,{key:0,title:"提示：点击【智能映射】按钮可根据字段名自动匹配Excel列，或手动为第一个字段选择列后点击【全选】触发顺序映射",type:"info",closable:!1,style:{"margin-bottom":"15px"}})):_("",!0),(d(!0),m(ie,null,de(V.value,s=>{var k;return d(),m("div",{key:s,class:"mapping-item"},[t("label",zt,p((k=M.value[s])==null?void 0:k.label)+":",1),l(be,{modelValue:B.value[s],"onUpdate:modelValue":R=>B.value[s]=R,placeholder:"选择Excel列",class:"mapping-select"},{default:a(()=>[(d(!0),m(ie,null,de(X.value,(R,K)=>(d(),y(F,{key:K,label:`${R} (列${K+1})`,value:K},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])}),128))])]),_:1})]),_:1})]),_:1}),Pe.value.length>0?(d(),y(S,{key:0,class:"preview-card"},{header:a(()=>e[66]||(e[66]=[t("h3",null,"数据预览 (前5行)",-1)])),default:a(()=>[l(Z,{data:Pe.value,border:"",style:{width:"100%"}},{default:a(()=>[(d(!0),m(ie,null,de(X.value,(s,k)=>(d(),y(h,{key:k,prop:k.toString(),label:`${s} (列${k+1})`,"min-width":"120"},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1})):_("",!0),t("div",It,[l(f,{onClick:e[2]||(e[2]=s=>j.value=0)},{default:a(()=>e[67]||(e[67]=[u("上一步")])),_:1,__:[67]}),l(f,{type:"primary",onClick:e[3]||(e[3]=s=>j.value=2),disabled:V.value.length===0},{default:a(()=>e[68]||(e[68]=[u(" 下一步 ")])),_:1,__:[68]},8,["disabled"])])],8,Dt)),[[Q,le.value]]):_("",!0),j.value===2?W((d(),m("div",{key:2,class:"step-content","element-loading-text":U.value||"正在处理数据...","element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-lock":"true"},[l(S,{class:"confirm-card"},{header:a(()=>e[69]||(e[69]=[t("h3",null,"确认导入信息",-1)])),default:a(()=>[l(Ie,{column:2,border:""},{default:a(()=>[l(I,{label:"文件名"},{default:a(()=>{var s;return[u(p((s=$.value)==null?void 0:s.name),1)]}),_:1}),l(I,{label:"数据行数"},{default:a(()=>[u(p($e.value),1)]),_:1}),l(I,{label:"选择字段数"},{default:a(()=>[u(p(V.value.length),1)]),_:1}),l(I,{label:"目标表"},{default:a(()=>e[70]||(e[70]=[u("ComplaintRegister")])),_:1,__:[70]})]),_:1}),l(dl),l(C,{title:"文件处理模式",type:"success",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:a(()=>e[71]||(e[71]=[t("p",null,"Excel中的本地文件将自动拷贝到服务器指定目录，生成HTTP访问链接，确保在任何设备上都能访问。",-1),t("p",null,[t("strong",null,"存储位置："),u("根据当前数据库配置中的文件存储路径设置")],-1)])),_:1}),t("div",Ft,[e[72]||(e[72]=t("h4",null,"校验设置:",-1)),l(ze,{gutter:20},{default:a(()=>[l(G,{span:24},{default:a(()=>[l(Hl,{modelValue:xe.value,"onUpdate:modelValue":e[4]||(e[4]=s=>xe.value=s),"active-text":"严格模式：按代码定义的必填字段校验","inactive-text":"宽松模式：仅校验数据库必填字段（日期+客户）",style:{"--el-switch-on-color":"#409eff","--el-switch-off-color":"#67c23a"}},null,8,["modelValue"])]),_:1})]),_:1}),xe.value?(d(),y(C,{key:0,title:"严格模式：将校验所有在代码中定义为必填的字段",type:"info",closable:!1,style:{"margin-top":"10px"}})):(d(),y(C,{key:1,title:"宽松模式：仅校验数据库中的必填字段（投诉日期、客户编号），提高导入成功率",type:"success",closable:!1,style:{"margin-top":"10px"}}))]),l(dl),e[76]||(e[76]=t("h4",null,"字段映射关系:",-1)),l(Z,{data:sa.value,border:"",style:{width:"100%"}},{default:a(()=>[l(h,{prop:"field",label:"数据库字段"}),l(h,{prop:"excelColumn",label:"Excel列"}),l(h,{prop:"required",label:"是否必填"},{default:a(s=>[l(g,{type:s.row.required?"danger":"info",size:"small"},{default:a(()=>[u(p(s.row.required?"是":"否"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),t("div",Pt,[l(f,{onClick:e[5]||(e[5]=s=>j.value=1)},{default:a(()=>e[73]||(e[73]=[u("上一步")])),_:1,__:[73]}),l(f,{type:"warning",onClick:e[6]||(e[6]=()=>Rl()),disabled:re.value||me.value},{default:a(()=>e[74]||(e[74]=[u(" 数据校验 ")])),_:1,__:[74]},8,["disabled"]),l(f,{type:"primary",onClick:Al,disabled:re.value||me.value},{default:a(()=>e[75]||(e[75]=[u(" 直接导入 ")])),_:1,__:[75]},8,["disabled"])])]),_:1,__:[76]})],8,Et)),[[Q,re.value||me.value]]):_("",!0),j.value===3?(d(),m("div",$t,[l(S,{class:"success-card"},{header:a(()=>[t("div",Mt,[l(i,{class:"success-icon"},{default:a(()=>[l(w(ct))]),_:1}),e[77]||(e[77]=t("h3",null,"导入完成",-1))])]),default:a(()=>[t("div",Rt,[l(Tl,{icon:"success",title:"数据导入成功！","sub-title":"Excel数据已成功导入到系统中"},{extra:a(()=>[t("div",At,[l(f,{type:"primary",onClick:pa},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[78]||(e[78]=u(" 重新导入 "))]),_:1,__:[78]}),l(f,{onClick:e[7]||(e[7]=s=>o.$router.push("/complaint/list"))},{default:a(()=>[l(i,null,{default:a(()=>[l(w(_l))]),_:1}),e[79]||(e[79]=u(" 查看数据 "))]),_:1,__:[79]})])]),_:1})])]),_:1})])):_("",!0)])]),_:1}),l(ne,{label:"数据表初始化",name:"initialize"},{default:a(()=>[t("div",Ot,[l(C,{title:"⚠️ 危险操作警告",type:"warning",closable:!1,"show-icon":"",class:"warning-alert"},{default:a(()=>e[80]||(e[80]=[t("p",null,[t("strong",null,"此功能将完全清空选定表的所有数据并重置自增ID！")],-1),t("p",null,"• 适用于开发环境或生产环境初次部署",-1),t("p",null,"• 操作不可撤销，请谨慎使用",-1),t("p",null,"• 系统关键表（User、DbConfig）受保护，不允许清空",-1)])),_:1}),W((d(),y(S,{class:"table-list-card"},{header:a(()=>[t("div",jt,[e[82]||(e[82]=t("h3",null,"数据表列表",-1)),l(f,{type:"primary",onClick:Da,loading:Oe.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[81]||(e[81]=u(" 刷新列表 "))]),_:1,__:[81]},8,["loading"])])]),default:a(()=>[t("div",qt,[t("div",Ht,[t("h4",Jt,[l(i,null,{default:a(()=>[l(w(_l))]),_:1}),e[83]||(e[83]=u(" 业务数据表 "))]),t("div",Gt,[(d(!0),m(ie,null,de(ea.value,s=>{var k;return d(),m("div",{key:s.tableName,class:Ul(["table-item",{selected:((k=D.value)==null?void 0:k.tableName)===s.tableName}]),onClick:R=>Bl(s)},[t("div",Kt,[t("div",Wt,p(s.displayName),1),t("div",Xt,[t("span",Yt,p(s.tableName),1),te.value[s.tableName]?(d(),m("span",Zt,p(te.value[s.tableName].recordCount)+" 条记录 ",1)):_("",!0)])]),t("div",es,[s.hasIdentity?(d(),y(g,{key:0,type:"info",size:"small"},{default:a(()=>e[84]||(e[84]=[u("自增ID")])),_:1,__:[84]})):_("",!0)])],10,Qt)}),128))])]),t("div",ls,[t("h4",as,[l(i,null,{default:a(()=>[l(w(vt))]),_:1}),e[85]||(e[85]=u(" 基础数据表 "))]),t("div",ts,[(d(!0),m(ie,null,de(la.value,s=>{var k;return d(),m("div",{key:s.tableName,class:Ul(["table-item",{selected:((k=D.value)==null?void 0:k.tableName)===s.tableName}]),onClick:R=>Bl(s)},[t("div",os,[t("div",ns,p(s.displayName),1),t("div",us,[t("span",is,p(s.tableName),1),te.value[s.tableName]?(d(),m("span",ds,p(te.value[s.tableName].recordCount)+" 条记录 ",1)):_("",!0)])]),t("div",rs,[s.hasIdentity?(d(),y(g,{key:0,type:"info",size:"small"},{default:a(()=>e[86]||(e[86]=[u("自增ID")])),_:1,__:[86]})):_("",!0)])],10,ss)}),128))])]),t("div",ps,[t("h4",cs,[l(i,null,{default:a(()=>[l(w(gl))]),_:1}),e[87]||(e[87]=u(" 系统配置表 "))]),t("div",vs,[(d(!0),m(ie,null,de(aa.value,s=>{var k;return d(),m("div",{key:s.tableName,class:Ul(["table-item",{selected:((k=D.value)==null?void 0:k.tableName)===s.tableName,protected:["User","DbConfig"].includes(s.tableName)}]),onClick:R=>Bl(s)},[t("div",ms,[t("div",_s,p(s.displayName),1),t("div",gs,[t("span",bs,p(s.tableName),1),te.value[s.tableName]?(d(),m("span",ys,p(te.value[s.tableName].recordCount)+" 条记录 ",1)):_("",!0)])]),t("div",ks,[s.hasIdentity?(d(),y(g,{key:0,type:"info",size:"small"},{default:a(()=>e[88]||(e[88]=[u("自增ID")])),_:1,__:[88]})):_("",!0),["User","DbConfig"].includes(s.tableName)?(d(),y(g,{key:1,type:"danger",size:"small"},{default:a(()=>e[89]||(e[89]=[u("受保护")])),_:1,__:[89]})):_("",!0)])],10,fs)}),128))])])]),D.value?(d(),m("div",ws,[l(S,{class:"operation-card"},{header:a(()=>[t("div",hs,[e[90]||(e[90]=t("h4",null,"初始化操作",-1)),l(g,{type:"warning"},{default:a(()=>[u("已选择: "+p(D.value.displayName),1)]),_:1})])]),default:a(()=>[t("div",xs,[t("div",Cs,[l(Ie,{column:2,border:""},{default:a(()=>[l(I,{label:"表名"},{default:a(()=>[u(p(D.value.tableName),1)]),_:1}),l(I,{label:"显示名"},{default:a(()=>[u(p(D.value.displayName),1)]),_:1}),l(I,{label:"表类型"},{default:a(()=>[l(g,{type:Na(D.value.tableType)},{default:a(()=>[u(p(La(D.value.tableType)),1)]),_:1},8,["type"])]),_:1}),l(I,{label:"当前记录数"},{default:a(()=>{var s;return[t("span",Vs,p(((s=te.value[D.value.tableName])==null?void 0:s.recordCount)||0)+" 条 ",1)]}),_:1}),l(I,{label:"自增ID"},{default:a(()=>[u(p(D.value.hasIdentity?"是":"否"),1)]),_:1}),l(I,{label:"操作结果"},{default:a(()=>[u(p(D.value.hasIdentity?"清空数据 + 重置自增ID为1":"清空所有数据"),1)]),_:1})]),_:1})]),t("div",Bs,[l(f,{type:"danger",size:"large",onClick:Ua,disabled:["User","DbConfig"].includes(D.value.tableName),loading:je.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(zl))]),_:1}),e[91]||(e[91]=u(" 初始化此表 "))]),_:1,__:[91]},8,["disabled","loading"]),l(f,{onClick:e[8]||(e[8]=s=>D.value=null)},{default:a(()=>e[92]||(e[92]=[u(" 取消选择 ")])),_:1,__:[92]})]),["User","DbConfig"].includes(D.value.tableName)?(d(),m("div",Ts,[l(C,{title:"此表受系统保护，不允许清空",type:"error",closable:!1,"show-icon":""})])):_("",!0)])]),_:1})])):_("",!0)]),_:1})),[[Q,Oe.value]])])]),_:1}),l(ne,{label:"数据导出",name:"export"},{default:a(()=>[t("div",Ss,[l(rl,{description:"数据导出功能开发中..."})])]),_:1}),l(ne,{label:"数据备份",name:"backup"},{default:a(()=>[t("div",Ds,[l(Sl,{modelValue:El.value,"onUpdate:modelValue":e[24]||(e[24]=s=>El.value=s),class:"backup-sub-tabs",onTabChange:ja},{default:a(()=>[l(ne,{label:"手动备份",name:"manual"},{default:a(()=>[t("div",Ns,[l(ze,{gutter:20},{default:a(()=>[l(G,{span:12},{default:a(()=>[W((d(),y(S,{class:"database-info-card"},{header:a(()=>[t("div",Ls,[t("h3",null,[l(i,null,{default:a(()=>[l(w(gl))]),_:1}),e[93]||(e[93]=u(" 数据库信息 "))]),l(f,{type:"primary",onClick:sl,loading:Qe.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[94]||(e[94]=u(" 刷新信息 "))]),_:1,__:[94]},8,["loading"])])]),default:a(()=>[J.value?(d(),m("div",Us,[l(Z,{data:Yl.value,border:"",style:{width:"100%","margin-bottom":"20px"}},{default:a(()=>[l(h,{prop:"label",label:"项目",width:"120"}),l(h,{prop:"value",label:"值"})]),_:1},8,["data"]),t("div",zs,[e[96]||(e[96]=t("div",{class:"info-label",style:{"margin-bottom":"8px"}},"备份路径配置",-1)),t("div",Is,[l(ye,{modelValue:Te.value,"onUpdate:modelValue":e[9]||(e[9]=s=>Te.value=s),placeholder:"\\\\tj_server\\工作\\DMS备份",disabled:Xe.value},null,8,["modelValue","disabled"]),l(f,{type:"primary",onClick:Oa,loading:Xe.value,style:{"margin-left":"8px"}},{default:a(()=>[l(i,null,{default:a(()=>[l(w(gl))]),_:1}),e[95]||(e[95]=u(" 保存配置 "))]),_:1,__:[95]},8,["loading"])]),e[97]||(e[97]=t("div",{class:"backup-path-tip",style:{"margin-top":"8px",color:"#909399","font-size":"12px"}}," 支持网络共享路径，SQL Server服务需要有访问权限 ",-1))])])):(d(),m("div",Es,[l(rl,{description:"点击刷新按钮获取数据库信息"})]))]),_:1})),[[Q,Qe.value]])]),_:1}),l(G,{span:12},{default:a(()=>[l(S,{class:"backup-operations-card"},{header:a(()=>[t("div",Fs,[t("h3",null,[l(i,null,{default:a(()=>[l(w(ft))]),_:1}),e[98]||(e[98]=u(" 创建备份 "))])])]),default:a(()=>[l(Sl,{modelValue:hl.value,"onUpdate:modelValue":e[12]||(e[12]=s=>hl.value=s),class:"backup-tabs",onTabChange:qa},{default:a(()=>[l(ne,{label:"默认方案",name:"default"},{default:a(()=>[t("div",Ps,[l(C,{title:"推荐方案",description:"备份到SQL Server默认路径，可靠性高",type:"success",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}})]),t("div",$s,[l(pl,{model:Ye.value,"label-width":"100px"},{default:a(()=>[l(P,{label:"服务器路径"},{default:a(()=>[l(ye,{modelValue:Ye.value.serverPath,"onUpdate:modelValue":e[10]||(e[10]=s=>Ye.value.serverPath=s),placeholder:"留空使用默认路径"},null,8,["modelValue"])]),_:1}),l(P,null,{default:a(()=>[l(f,{type:"primary",onClick:Ha,loading:xl.value},{default:a(()=>e[99]||(e[99]=[u(" 保存路径 ")])),_:1,__:[99]},8,["loading"]),l(ee,{type:"info",style:{"margin-left":"10px"}},{default:a(()=>e[100]||(e[100]=[u(" 默认：D:\\Program Files\\Microsoft SQL Server\\... ")])),_:1,__:[100]})]),_:1})]),_:1},8,["model"])])]),_:1}),l(ne,{label:"备选方案",name:"alternative"},{default:a(()=>[t("div",Ms,[l(C,{title:"备选方案",description:"适用于没有被Radmin控制的服务器",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}})]),t("div",Rs,[l(pl,{model:Se.value,"label-width":"100px"},{default:a(()=>[l(P,{label:"网络路径"},{default:a(()=>[l(ye,{modelValue:Se.value.networkPath,"onUpdate:modelValue":e[11]||(e[11]=s=>Se.value.networkPath=s),placeholder:"\\\\\\\\server\\\\backup"},null,8,["modelValue"])]),_:1}),l(P,null,{default:a(()=>[l(f,{type:"primary",onClick:Ja,loading:Cl.value},{default:a(()=>e[101]||(e[101]=[u(" 保存路径 ")])),_:1,__:[101]},8,["loading"]),l(ee,{type:"warning",style:{"margin-left":"10px"}},{default:a(()=>e[102]||(e[102]=[u(" 需要SQL Server服务账户权限 ")])),_:1,__:[102]})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"]),l(pl,{model:O.value,"label-width":"80px"},{default:a(()=>[l(P,{label:"备份名称",required:""},{default:a(()=>[l(ye,{modelValue:O.value.backupName,"onUpdate:modelValue":e[13]||(e[13]=s=>O.value.backupName=s),placeholder:"请输入备份名称",disabled:ce.value},null,8,["modelValue","disabled"])]),_:1}),l(P,{label:"备份类型"},{default:a(()=>[l(be,{modelValue:O.value.backupType,"onUpdate:modelValue":e[14]||(e[14]=s=>O.value.backupType=s),disabled:ce.value,style:{width:"100%"}},{default:a(()=>[l(F,{label:"完整备份",value:"FULL"}),l(F,{label:"差异备份",value:"DIFFERENTIAL"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(P,{label:"备份描述"},{default:a(()=>[l(ye,{modelValue:O.value.description,"onUpdate:modelValue":e[15]||(e[15]=s=>O.value.description=s),type:"textarea",rows:3,placeholder:"请输入备份描述（可选）",disabled:ce.value},null,8,["modelValue","disabled"])]),_:1}),l(P,null,{default:a(()=>[l(f,{type:"primary",onClick:$a,loading:ce.value,disabled:!O.value.backupName},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ml))]),_:1}),e[103]||(e[103]=u(" 创建备份 "))]),_:1,__:[103]},8,["loading","disabled"]),l(f,{onClick:jl,disabled:ce.value,style:{"margin-left":"8px"}},{default:a(()=>e[104]||(e[104]=[u(" 重置 ")])),_:1,__:[104]},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),t("div",As,[W((d(),y(S,{class:"backup-history-card"},{header:a(()=>[t("div",Os,[t("h3",null,[l(i,null,{default:a(()=>[l(Jl)]),_:1}),e[105]||(e[105]=u(" 备份历史 "))]),l(f,{type:"primary",onClick:ve,loading:We.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[106]||(e[106]=u(" 刷新列表 "))]),_:1,__:[106]},8,["loading"])])]),default:a(()=>[Ke.value.length>0?(d(),m("div",js,[l(Z,{data:Ke.value,stripe:""},{default:a(()=>[l(h,{prop:"BackupName",label:"备份名称","min-width":"180"}),l(h,{prop:"DatabaseName",label:"数据库",width:"100"}),l(h,{prop:"BackupType",label:"备份类型",width:"100"},{default:a(({row:s})=>[l(g,{type:s.BackupType==="FULL"?"success":"primary"},{default:a(()=>[u(p(s.BackupType==="FULL"?"完整备份":"差异备份"),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"BackupPath",label:"备份路径","min-width":"300"},{default:a(({row:s})=>[l(lt,{content:s.BackupPath,placement:"top"},{default:a(()=>[t("span",qs,p(s.BackupPath),1)]),_:2},1032,["content"])]),_:1}),l(h,{prop:"BackupStartTime",label:"备份时间",width:"160"},{default:a(({row:s})=>[u(p(tl(s.BackupStartTime)),1)]),_:1}),l(h,{prop:"BackupSize",label:"文件大小",width:"100"},{default:a(({row:s})=>[u(p(al(s.BackupSize||0)),1)]),_:1}),l(h,{prop:"BackupStatus",label:"状态",width:"80"},{default:a(({row:s})=>[l(g,{type:ol(s.BackupStatus)},{default:a(()=>[u(p(nl(s.BackupStatus)),1)]),_:2},1032,["type"])]),_:1}),l(h,{label:"操作",width:"200",fixed:"right"},{default:a(({row:s})=>[t("div",Hs,[l(at,null,{default:a(()=>[l(f,{type:"info",onClick:k=>Ma(s)},{default:a(()=>[l(i,null,{default:a(()=>[l(w(bl))]),_:1}),e[107]||(e[107]=u(" 详情 "))]),_:2,__:[107]},1032,["onClick"]),l(f,{type:"primary",onClick:k=>Aa(s.BackupPath)},{default:a(()=>[l(i,null,{default:a(()=>[l(w(_l))]),_:1}),e[108]||(e[108]=u(" 复制 "))]),_:2,__:[108]},1032,["onClick"])]),_:2},1024),l(st,{trigger:"click",style:{"margin-left":"8px"}},{dropdown:a(()=>[l(tt,null,{default:a(()=>[l(cl,{onClick:k=>Ga(s)},{default:a(()=>[l(i,null,{default:a(()=>[l(w(mt))]),_:1}),e[109]||(e[109]=u(" 更新路径 "))]),_:2,__:[109]},1032,["onClick"]),l(cl,{onClick:k=>Qa(s)},{default:a(()=>[l(i,null,{default:a(()=>[l(w(_t))]),_:1}),e[110]||(e[110]=u(" 验证文件 "))]),_:2,__:[110]},1032,["onClick"]),s.BackupPath.startsWith("\\\\")?(d(),y(cl,{key:0,onClick:k=>Ka(s)},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ml))]),_:1}),e[111]||(e[111]=u(" 下载备份 "))]),_:2,__:[111]},1032,["onClick"])):_("",!0),l(cl,{divided:"",onClick:k=>Wa(s),style:{color:"#f56c6c"}},{default:a(()=>[l(i,null,{default:a(()=>[l(w(zl))]),_:1}),e[112]||(e[112]=u(" 删除记录 "))]),_:2,__:[112]},1032,["onClick"])]),_:2},1024)]),default:a(()=>[l(f,{type:"warning",circle:""},{default:a(()=>[l(i,null,{default:a(()=>[l(w(gt))]),_:1})]),_:1})]),_:2},1024)])]),_:1})]),_:1},8,["data"])])):(d(),m("div",Js,[l(rl,{description:"暂无备份记录"})]))]),_:1})),[[Q,We.value]])])]),_:1}),l(ne,{label:"自动备份设置",name:"auto"},{default:a(()=>[t("div",Gs,[l(ze,{gutter:20},{default:a(()=>[l(G,{span:12},{default:a(()=>[W((d(),y(S,{class:"auto-backup-config-card"},{header:a(()=>[t("div",Qs,[t("h3",null,[l(i,null,{default:a(()=>[l(Jl)]),_:1}),e[113]||(e[113]=u(" 自动备份配置 "))]),l(f,{type:"primary",onClick:ql,loading:Ze.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[114]||(e[114]=u(" 刷新配置 "))]),_:1,__:[114]},8,["loading"])])]),default:a(()=>[W((d(),y(pl,{model:x.value,"label-width":"120px"},{default:a(()=>[l(P,{label:"启用自动备份"},{default:a(()=>[l(Hl,{modelValue:x.value.enabled,"onUpdate:modelValue":e[16]||(e[16]=s=>x.value.enabled=s),"active-text":"启用","inactive-text":"禁用",onChange:Za},null,8,["modelValue"]),e[115]||(e[115]=t("div",{class:"form-tip"}," 启用后系统将按照设定的时间自动创建数据库备份 ",-1))]),_:1,__:[115]}),x.value.enabled?(d(),y(P,{key:0,label:"备份频率"},{default:a(()=>[l(be,{modelValue:x.value.frequency,"onUpdate:modelValue":e[17]||(e[17]=s=>x.value.frequency=s),style:{width:"100%"}},{default:a(()=>[l(F,{label:"每日备份",value:"daily"}),l(F,{label:"每周备份",value:"weekly"}),l(F,{label:"每月备份",value:"monthly"})]),_:1},8,["modelValue"]),e[116]||(e[116]=t("div",{class:"form-tip"}," 选择自动备份的执行频率 ",-1))]),_:1,__:[116]})):_("",!0),x.value.enabled?(d(),y(P,{key:1,label:"备份时间"},{default:a(()=>[l(ot,{modelValue:x.value.backupTime,"onUpdate:modelValue":e[18]||(e[18]=s=>x.value.backupTime=s),format:"HH:mm","value-format":"HH:mm",placeholder:"选择备份时间",style:{width:"100%"}},null,8,["modelValue"]),e[117]||(e[117]=t("div",{class:"form-tip"}," 建议选择系统使用较少的时间段，如凌晨时间 ",-1))]),_:1,__:[117]})):_("",!0),x.value.enabled&&x.value.frequency==="weekly"?(d(),y(P,{key:2,label:"备份日期"},{default:a(()=>[l(be,{modelValue:x.value.weekDay,"onUpdate:modelValue":e[19]||(e[19]=s=>x.value.weekDay=s),style:{width:"100%"}},{default:a(()=>[l(F,{label:"周一",value:1}),l(F,{label:"周二",value:2}),l(F,{label:"周三",value:3}),l(F,{label:"周四",value:4}),l(F,{label:"周五",value:5}),l(F,{label:"周六",value:6}),l(F,{label:"周日",value:0})]),_:1},8,["modelValue"]),e[118]||(e[118]=t("div",{class:"form-tip"}," 选择每周执行备份的日期 ",-1))]),_:1,__:[118]})):_("",!0),x.value.enabled&&x.value.frequency==="monthly"?(d(),y(P,{key:3,label:"备份日期"},{default:a(()=>[l(Gl,{modelValue:x.value.monthDay,"onUpdate:modelValue":e[20]||(e[20]=s=>x.value.monthDay=s),min:1,max:28,style:{width:"100%"}},null,8,["modelValue"]),e[119]||(e[119]=t("div",{class:"form-tip"}," 选择每月执行备份的日期（1-28日） ",-1))]),_:1,__:[119]})):_("",!0),x.value.enabled?(d(),y(P,{key:4,label:"保留备份数量"},{default:a(()=>[l(Gl,{modelValue:x.value.retentionCount,"onUpdate:modelValue":e[21]||(e[21]=s=>x.value.retentionCount=s),min:1,max:30,style:{width:"100%"}},null,8,["modelValue"]),e[120]||(e[120]=t("div",{class:"form-tip"}," 自动清理超过指定数量的旧备份文件（1-30个） ",-1))]),_:1,__:[120]})):_("",!0),x.value.enabled?(d(),y(P,{key:5,label:"备份类型"},{default:a(()=>[l(be,{modelValue:x.value.backupType,"onUpdate:modelValue":e[22]||(e[22]=s=>x.value.backupType=s),style:{width:"100%"}},{default:a(()=>[l(F,{label:"完整备份",value:"FULL"}),l(F,{label:"差异备份",value:"DIFFERENTIAL"})]),_:1},8,["modelValue"]),e[121]||(e[121]=t("div",{class:"form-tip"}," 完整备份：备份整个数据库；差异备份：仅备份自上次完整备份后的更改 ",-1))]),_:1,__:[121]})):_("",!0),x.value.enabled?(d(),y(P,{key:6,label:"备份路径方案"},{default:a(()=>[l(be,{modelValue:x.value.backupScheme,"onUpdate:modelValue":e[23]||(e[23]=s=>x.value.backupScheme=s),style:{width:"100%"}},{default:a(()=>[l(F,{label:"默认方案（推荐）",value:"default"}),l(F,{label:"备选方案",value:"alternative"})]),_:1},8,["modelValue"]),e[122]||(e[122]=t("div",{class:"form-tip"}," 默认方案：备份到SQL Server默认路径；备选方案：直接备份到网络共享路径 ",-1))]),_:1,__:[122]})):_("",!0),l(P,null,{default:a(()=>[l(f,{type:"primary",onClick:Xa,loading:De.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(gl))]),_:1}),e[123]||(e[123]=u(" 保存配置 "))]),_:1,__:[123]},8,["loading"]),l(f,{onClick:Ya,disabled:De.value},{default:a(()=>e[124]||(e[124]=[u(" 重置 ")])),_:1,__:[124]},8,["disabled"])]),_:1})]),_:1},8,["model"])),[[Q,De.value]])]),_:1})),[[Q,Ze.value]])]),_:1}),l(G,{span:12},{default:a(()=>[W((d(),y(S,{class:"auto-backup-status-card"},{header:a(()=>[t("div",Ks,[t("h3",null,[l(i,null,{default:a(()=>[l(w(bl))]),_:1}),e[125]||(e[125]=u(" 自动备份状态 "))]),l(f,{type:"primary",onClick:ul,loading:el.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ke))]),_:1}),e[126]||(e[126]=u(" 刷新状态 "))]),_:1,__:[126]},8,["loading"])])]),default:a(()=>[se.value?(d(),m("div",Ws,[l(Ie,{column:1,border:"",style:{"margin-bottom":"20px"}},{default:a(()=>[l(I,{label:"服务状态"},{default:a(()=>[l(g,{type:se.value.serviceStatus==="running"?"success":"danger"},{default:a(()=>[u(p(se.value.serviceStatus==="running"?"运行中":"已停止"),1)]),_:1},8,["type"])]),_:1}),l(I,{label:"下次备份时间"},{default:a(()=>[u(p(se.value.nextBackupTime||"未设置"),1)]),_:1}),l(I,{label:"上次备份时间"},{default:a(()=>[u(p(se.value.lastBackupTime||"无记录"),1)]),_:1}),l(I,{label:"上次备份状态"},{default:a(()=>[se.value.lastBackupStatus?(d(),y(g,{key:0,type:ol(se.value.lastBackupStatus)},{default:a(()=>[u(p(nl(se.value.lastBackupStatus)),1)]),_:1},8,["type"])):(d(),m("span",Xs,"无记录"))]),_:1})]),_:1}),t("div",Ys,[l(f,{type:"warning",onClick:et,loading:Vl.value,disabled:!x.value.enabled},{default:a(()=>[l(i,null,{default:a(()=>[l(w(ml))]),_:1}),e[127]||(e[127]=u(" 立即执行备份 "))]),_:1,__:[127]},8,["loading","disabled"]),e[128]||(e[128]=t("div",{class:"form-tip"}," 手动触发一次自动备份任务 ",-1))]),t("div",Zs,[e[129]||(e[129]=t("h4",null,"最近备份日志",-1)),l(Z,{data:Fl.value,size:"small","max-height":"300",stripe:""},{default:a(()=>[l(h,{prop:"backupTime",label:"备份时间",width:"160"},{default:a(({row:s})=>[u(p(tl(s.backupTime)),1)]),_:1}),l(h,{prop:"backupType",label:"类型",width:"80"},{default:a(({row:s})=>[l(g,{size:"small",type:s.backupType==="FULL"?"success":"primary"},{default:a(()=>[u(p(s.backupType==="FULL"?"完整":"差异"),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"status",label:"状态",width:"80"},{default:a(({row:s})=>[l(g,{size:"small",type:ol(s.status)},{default:a(()=>[u(p(nl(s.status)),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"message",label:"备注","min-width":"150"})]),_:1},8,["data"])])])):(d(),m("div",eo,[l(rl,{description:"点击刷新按钮获取自动备份状态"})]))]),_:1})),[[Q,el.value]])]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(fe,{modelValue:Le.value,"onUpdate:modelValue":e[28]||(e[28]=s=>Le.value=s),title:"备份详情",width:"600px","before-close":Ra,class:"backup-detail-dialog"},{footer:a(()=>[t("div",Bo,[l(f,{onClick:e[27]||(e[27]=s=>Le.value=!1)},{default:a(()=>e[143]||(e[143]=[u("关闭")])),_:1,__:[143]})])]),default:a(()=>[E.value?(d(),m("div",lo,[l(S,{class:"detail-card",shadow:"never"},{header:a(()=>[t("div",ao,[l(i,{class:"header-icon"},{default:a(()=>[l(w(_l))]),_:1}),e[130]||(e[130]=t("span",{class:"header-title"},"基本信息",-1))])]),default:a(()=>[t("div",to,[t("div",so,[e[131]||(e[131]=t("span",{class:"detail-label"},"备份名称",-1)),t("span",oo,p(E.value.BackupName),1)]),t("div",no,[e[132]||(e[132]=t("span",{class:"detail-label"},"数据库",-1)),t("span",uo,p(E.value.DatabaseName),1)]),t("div",io,[e[133]||(e[133]=t("span",{class:"detail-label"},"备份类型",-1)),l(g,{type:E.value.BackupType==="FULL"?"primary":"warning",size:"small"},{default:a(()=>[u(p(E.value.BackupType==="FULL"?"完整备份":"差异备份"),1)]),_:1},8,["type"])]),t("div",ro,[e[134]||(e[134]=t("span",{class:"detail-label"},"状态",-1)),l(g,{type:ol(E.value.BackupStatus),size:"small"},{default:a(()=>[u(p(nl(E.value.BackupStatus)),1)]),_:1},8,["type"])])])]),_:1}),l(S,{class:"detail-card",shadow:"never"},{header:a(()=>[t("div",po,[l(i,{class:"header-icon"},{default:a(()=>[l(w(bt))]),_:1}),e[135]||(e[135]=t("span",{class:"header-title"},"文件信息",-1))])]),default:a(()=>[t("div",co,[t("div",vo,[e[137]||(e[137]=t("span",{class:"detail-label"},"备份路径",-1)),t("div",fo,[t("span",mo,p(E.value.BackupPath),1),l(f,{size:"small",type:"primary",link:"",onClick:e[26]||(e[26]=s=>o.copyToClipboard(E.value.BackupPath)),class:"copy-btn"},{default:a(()=>[l(i,null,{default:a(()=>[l(w(yt))]),_:1}),e[136]||(e[136]=u(" 复制 "))]),_:1,__:[136]})])]),t("div",_o,[e[138]||(e[138]=t("span",{class:"detail-label"},"文件大小",-1)),t("span",go,p(al(E.value.BackupSize)),1)]),t("div",bo,[e[139]||(e[139]=t("span",{class:"detail-label"},"创建者",-1)),t("span",yo,p(E.value.CreatedBy||"系统"),1)]),t("div",ko,[e[140]||(e[140]=t("span",{class:"detail-label"},"开始时间",-1)),t("span",wo,p(tl(E.value.BackupStartTime)),1)]),t("div",ho,[e[141]||(e[141]=t("span",{class:"detail-label"},"结束时间",-1)),t("span",xo,p(tl(E.value.BackupEndTime)),1)])])]),_:1}),E.value.Description?(d(),y(S,{key:0,class:"detail-card",shadow:"never"},{header:a(()=>[t("div",Co,[l(i,{class:"header-icon"},{default:a(()=>[l(w(kt))]),_:1}),e[142]||(e[142]=t("span",{class:"header-title"},"备份描述",-1))])]),default:a(()=>[t("div",Vo,p(E.value.Description),1)]),_:1})):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),l(fe,{modelValue:ge.value,"onUpdate:modelValue":e[32]||(e[32]=s=>ge.value=s),title:"数据校验结果",width:"900px","close-on-click-modal":!1},{footer:a(()=>{var s,k,R;return[t("div",Po,[t("div",null,[(s=L.value.summary)!=null&&s.canImport?(d(),y(ee,{key:0,type:"success"},{default:a(()=>e[146]||(e[146]=[u(" ✓ 数据校验通过，可以进行导入 ")])),_:1,__:[146]})):(d(),y(ee,{key:1,type:"danger"},{default:a(()=>[l(i,null,{default:a(()=>[l(w(bl))]),_:1}),e[147]||(e[147]=u(" 存在数据错误，请修正后重试 "))]),_:1,__:[147]}))]),t("div",null,[l(f,{onClick:e[30]||(e[30]=K=>ge.value=!1)},{default:a(()=>e[148]||(e[148]=[u("取消")])),_:1,__:[148]}),z.value.length>0?(d(),y(f,{key:0,type:"warning",onClick:ha,disabled:z.value.length===0},{default:a(()=>[u(" 应用转换 ("+p(z.value.length)+"个) ",1)]),_:1},8,["disabled"])):_("",!0),(k=L.value.summary)!=null&&k.canImport?(d(),y(f,{key:1,type:"primary",onClick:e[31]||(e[31]=K=>{ge.value=!1,Al()}),disabled:!((R=L.value.summary)!=null&&R.canImport)},{default:a(()=>[e[149]||(e[149]=u(" 确认导入 ")),z.value.length>0?(d(),m("span",$o," (含"+p(z.value.length)+"个转换) ",1)):_("",!0)]),_:1,__:[149]},8,["disabled"])):_("",!0)])])]}),default:a(()=>{var s,k,R,K,Ql;return[W((d(),m("div",{"element-loading-text":U.value||"正在校验数据，请稍候..."},[L.value.totalRows?(d(),m("div",So,[t("div",Do,[l(ze,{gutter:20},{default:a(()=>[l(G,{span:6},{default:a(()=>[l(vl,{title:"总行数",value:L.value.totalRows},null,8,["value"])]),_:1}),l(G,{span:6},{default:a(()=>[l(vl,{title:"有效行数",value:L.value.validRows},null,8,["value"])]),_:1}),l(G,{span:6},{default:a(()=>[l(vl,{title:"无效行数",value:L.value.invalidRows||0},null,8,["value"])]),_:1}),l(G,{span:6},{default:a(()=>{var T;return[l(vl,{title:"错误数量",value:((T=L.value.errors)==null?void 0:T.length)||0},null,8,["value"])]}),_:1})]),_:1})]),l(C,{title:(s=L.value.summary)!=null&&s.canImport?"数据校验通过，可以进行导入":"数据校验失败，请修正错误后重试",type:(k=L.value.summary)!=null&&k.canImport?"success":"error",closable:!1,style:{"margin-bottom":"15px"}},null,8,["title","type"]),((R=L.value.errors)==null?void 0:R.length)>0?(d(),m("div",No,[l(Nl,null,{default:a(()=>[l(Dl,null,{title:a(()=>[l(i,{color:"#F56C6C"},{default:a(()=>[l(w(Wl))]),_:1}),t("span",Lo," 数据错误 ("+p(L.value.errors.length)+" 个) ",1)]),default:a(()=>[l(Z,{data:L.value.errors,"max-height":"300",size:"small",stripe:"",border:""},{default:a(()=>[l(h,{prop:"row",label:"Excel行号",width:"100",align:"center"},{default:a(({row:T})=>[l(g,{type:"danger",size:"small"},{default:a(()=>[u("第"+p(T.row)+"行",1)]),_:2},1024)]),_:1}),l(h,{prop:"field",label:"字段名称",width:"150"}),l(h,{prop:"value",label:"错误值",width:"150"},{default:a(({row:T})=>[l(ee,{type:"danger",truncated:""},{default:a(()=>[u(p(T.value||"(空值)"),1)]),_:2},1024)]),_:1}),l(h,{prop:"message",label:"错误描述","min-width":"200"},{default:a(({row:T})=>[l(ee,{type:"danger"},{default:a(()=>[u(p(T.message),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})])):_("",!0),((K=L.value.conversions)==null?void 0:K.length)>0?(d(),m("div",Uo,[l(Nl,null,{default:a(()=>[l(Dl,null,{title:a(()=>[l(i,{color:"#E6A23C"},{default:a(()=>[l(w(bl))]),_:1}),t("span",zo," 智能转换建议 ("+p(L.value.conversions.length)+" 个) ",1)]),default:a(()=>[t("div",Io,[l(f,{size:"small",type:"primary",onClick:ka,loading:Ae.value},{default:a(()=>e[144]||(e[144]=[u(" 全选 ")])),_:1,__:[144]},8,["loading"]),l(f,{size:"small",onClick:wa},{default:a(()=>e[145]||(e[145]=[u(" 清空 ")])),_:1,__:[145]}),l(ee,{type:"info",style:{"margin-left":"10px"}},{default:a(()=>[u(" 已选择 "+p(z.value.length)+" 个转换 ",1)]),_:1})]),W((d(),y(Z,{data:L.value.conversions,"max-height":"300",size:"small",stripe:"",border:"","element-loading-text":"正在处理转换建议..."},{default:a(()=>[l(h,{width:"60",align:"center"},{default:a(({row:T})=>[l(Y,{modelValue:z.value,"onUpdate:modelValue":e[29]||(e[29]=Ll=>z.value=Ll),value:T,onChange:Ll=>{if(Ll)z.value.find(Ee=>Ee.row===T.row&&Ee.field===T.field)||z.value.push(T);else{const Ee=z.value.findIndex(Kl=>Kl.row===T.row&&Kl.field===T.field);Ee>-1&&z.value.splice(Ee,1)}}},null,8,["modelValue","value","onChange"])]),_:1}),l(h,{prop:"row",label:"Excel行号",width:"100",align:"center"},{default:a(({row:T})=>[l(g,{type:"warning",size:"small"},{default:a(()=>[u("第"+p(T.row)+"行",1)]),_:2},1024)]),_:1}),l(h,{prop:"field",label:"字段名称",width:"150"}),l(h,{prop:"originalValue",label:"原始值",width:"150"},{default:a(({row:T})=>[l(ee,{type:"warning"},{default:a(()=>[u(p(T.originalValue),1)]),_:2},1024)]),_:1}),l(h,{prop:"convertedValue",label:"转换后",width:"150"},{default:a(({row:T})=>[l(ee,{type:"success"},{default:a(()=>[u(p(T.convertedValue),1)]),_:2},1024)]),_:1}),l(h,{prop:"message",label:"转换说明","min-width":"200"})]),_:1},8,["data"])),[[Q,Ae.value]])]),_:1})]),_:1})])):_("",!0),((Ql=L.value.warnings)==null?void 0:Ql.length)>0?(d(),m("div",Eo,[l(Nl,null,{default:a(()=>[l(Dl,null,{title:a(()=>[l(i,{color:"#E6A23C"},{default:a(()=>[l(w(Wl))]),_:1}),t("span",Fo," 警告信息 ("+p(L.value.warnings.length)+" 个) ",1)]),default:a(()=>[l(Z,{data:L.value.warnings,"max-height":"200",size:"small",stripe:"",border:""},{default:a(()=>[l(h,{prop:"row",label:"Excel行号",width:"100",align:"center"},{default:a(({row:T})=>[l(g,{type:"warning",size:"small"},{default:a(()=>[u("第"+p(T.row)+"行",1)]),_:2},1024)]),_:1}),l(h,{prop:"field",label:"字段名称",width:"150"}),l(h,{prop:"message",label:"警告信息","min-width":"200"},{default:a(({row:T})=>[l(ee,{type:"warning"},{default:a(()=>[u(p(T.message),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})])):_("",!0)])):_("",!0)],8,To)),[[Q,re.value]])]}),_:1},8,["modelValue"]),l(fe,{modelValue:Ce.value,"onUpdate:modelValue":e[33]||(e[33]=s=>Ce.value=s),title:"数据导入进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:a(()=>[t("div",Mo,[l(nt,{type:"dashboard",percentage:A.value.percentage,status:A.value.status==="error"?"exception":A.value.status==="completed"?"success":"",width:150},null,8,["percentage","status"]),t("div",Ro,[t("p",null,[t("strong",null,p(A.value.message),1)]),A.value.total>0?(d(),m("p",Ao,p(A.value.current)+" / "+p(A.value.total),1)):_("",!0)])])]),_:1},8,["modelValue"]),l(fe,{modelValue:he.value,"onUpdate:modelValue":e[34]||(e[34]=s=>he.value=s),title:"导入结果",width:"600px"},{default:a(()=>[t("div",Oo,[l(Tl,{icon:q.value.success?"success":"error",title:q.value.success?"导入成功":"导入失败","sub-title":q.value.message},{extra:a(()=>[q.value.data?(d(),m("div",jo,[l(Ie,{column:2,border:""},{default:a(()=>[l(I,{label:"成功导入"},{default:a(()=>[u(p(q.value.data.successCount)+" 条 ",1)]),_:1}),l(I,{label:"失败记录"},{default:a(()=>[u(p(q.value.data.errorCount)+" 条 ",1)]),_:1})]),_:1}),q.value.data.errors&&q.value.data.errors.length>0?(d(),m("div",qo,[e[151]||(e[151]=t("h4",null,"错误详情:",-1)),l(Z,{data:q.value.data.failedRows||q.value.data.errors.map((s,k)=>({rowNumber:k+1,error:s})),style:{width:"100%","margin-top":"10px"},"max-height":"300",stripe:"",border:""},{default:a(()=>[l(h,{prop:"rowNumber",label:"行号",width:"80",align:"center"}),l(h,{prop:"error",label:"错误信息","min-width":"200"},{default:a(s=>[typeof s.row.error=="string"?(d(),m("span",Ho,p(s.row.error),1)):(d(),m("span",Jo,p(s.row.error),1))]),_:1}),l(h,{label:"操作",width:"100",align:"center"},{default:a(s=>[s.row.rowData?(d(),y(f,{key:0,type:"text",size:"small",onClick:k=>Ca(s.row)},{default:a(()=>e[150]||(e[150]=[u(" 查看数据 ")])),_:2,__:[150]},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])])):_("",!0)])):_("",!0),l(f,{type:"primary",onClick:xa},{default:a(()=>e[152]||(e[152]=[u("重新导入")])),_:1,__:[152]})]),_:1},8,["icon","title","sub-title"])])]),_:1},8,["modelValue"]),l(fe,{modelValue:Me.value,"onUpdate:modelValue":e[36]||(e[36]=s=>Me.value=s),title:"失败行详细数据",width:"80%","close-on-click-modal":!1},{footer:a(()=>[l(f,{onClick:e[35]||(e[35]=s=>Me.value=!1)},{default:a(()=>e[156]||(e[156]=[u("关闭")])),_:1,__:[156]})]),default:a(()=>[Re.value?(d(),m("div",Go,[e[154]||(e[154]=t("h4",null,"错误信息：",-1)),l(C,{title:Re.value.error,type:"error",closable:!1,style:{"margin-bottom":"20px"}},null,8,["title"]),e[155]||(e[155]=t("h4",null,"行数据：",-1)),l(Z,{data:Va(Re.value.rowData),style:{width:"100%"},stripe:"",border:"","max-height":"400"},{default:a(()=>[l(h,{prop:"field",label:"字段名",width:"200"}),l(h,{prop:"value",label:"值","min-width":"300"},{default:a(s=>[s.row.value===null||s.row.value===void 0?(d(),m("span",Qo,[l(g,{type:"info",size:"small"},{default:a(()=>e[153]||(e[153]=[u("空值")])),_:1,__:[153]})])):(d(),m("span",Ko,p(s.row.value),1))]),_:1})]),_:1},8,["data"])])):_("",!0)]),_:1},8,["modelValue"]),l(fe,{modelValue:Ve.value,"onUpdate:modelValue":e[41]||(e[41]=s=>Ve.value=s),title:"数据表初始化确认",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[t("div",Zo,[l(f,{onClick:za},{default:a(()=>e[166]||(e[166]=[u("取消")])),_:1,__:[166]}),l(f,{type:"danger",onClick:Ia,disabled:!ta.value,loading:je.value},{default:a(()=>[l(i,null,{default:a(()=>[l(w(zl))]),_:1}),e[167]||(e[167]=u(" 确认初始化 "))]),_:1,__:[167]},8,["disabled","loading"])])]),default:a(()=>[t("div",Wo,[l(C,{title:"⚠️ 最后确认",type:"error",closable:!1,"show-icon":"",class:"final-warning"},{default:a(()=>{var s,k,R,K;return[e[160]||(e[160]=t("p",null,[t("strong",null,"您即将执行不可逆的数据清空操作！")],-1)),t("p",null,[e[157]||(e[157]=u("表名: ")),t("code",null,p((s=D.value)==null?void 0:s.tableName),1)]),t("p",null,[e[158]||(e[158]=u("显示名: ")),t("strong",null,p((k=D.value)==null?void 0:k.displayName),1)]),t("p",null,[e[159]||(e[159]=u("当前记录数: ")),t("strong",null,p(((K=te.value[(R=D.value)==null?void 0:R.tableName])==null?void 0:K.recordCount)||0)+" 条",1)])]}),_:1}),t("div",Xo,[e[165]||(e[165]=t("h4",null,"请按以下步骤确认:",-1)),t("ol",null,[t("li",null,[l(Y,{modelValue:He.value,"onUpdate:modelValue":e[37]||(e[37]=s=>He.value=s)},{default:a(()=>e[161]||(e[161]=[u(" 我已确认这是开发环境或生产环境初次部署 ")])),_:1,__:[161]},8,["modelValue"])]),t("li",null,[l(Y,{modelValue:Je.value,"onUpdate:modelValue":e[38]||(e[38]=s=>Je.value=s)},{default:a(()=>e[162]||(e[162]=[u(" 我已备份重要数据（如有需要） ")])),_:1,__:[162]},8,["modelValue"])]),t("li",null,[l(Y,{modelValue:Ge.value,"onUpdate:modelValue":e[39]||(e[39]=s=>Ge.value=s)},{default:a(()=>e[163]||(e[163]=[u(" 我理解此操作将永久删除表中所有数据 ")])),_:1,__:[163]},8,["modelValue"])]),t("li",null,[t("div",Yo,[e[164]||(e[164]=t("span",null,"请输入确认密码: ",-1)),l(ye,{modelValue:Be.value,"onUpdate:modelValue":e[40]||(e[40]=s=>Be.value=s),type:"password",placeholder:"输入 RESET_TABLE_DATA",style:{width:"200px","margin-left":"10px"},"show-password":""},null,8,["modelValue"])])])])])])]),_:1},8,["modelValue"]),l(fe,{modelValue:qe.value,"onUpdate:modelValue":e[42]||(e[42]=s=>qe.value=s),title:"初始化结果",width:"500px"},{footer:a(()=>[t("div",ln,[l(f,{type:"primary",onClick:Ea},{default:a(()=>e[168]||(e[168]=[u("确定")])),_:1,__:[168]})])]),default:a(()=>[t("div",en,[l(Tl,{icon:H.value.success?"success":"error",title:H.value.success?"初始化成功":"初始化失败","sub-title":H.value.message},rt({_:2},[H.value.success&&H.value.data?{name:"extra",fn:a(()=>[l(Ie,{column:1,border:""},{default:a(()=>[l(I,{label:"表名"},{default:a(()=>[u(p(H.value.data.tableName),1)]),_:1}),l(I,{label:"原记录数"},{default:a(()=>[u(p(H.value.data.originalCount)+" 条",1)]),_:1}),l(I,{label:"操作结果"},{default:a(()=>[u(p(H.value.data.message),1)]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["icon","title","sub-title"])])]),_:1},8,["modelValue"])])}}},on=ut(an,[["__scopeId","data-v-43bc1069"]]);export{on as default};
