import{_ as O,r as y,i as Q,a as c,k as X,o as d,l as _,d as t,w as l,j as N,E as b,b as a,R,e as o,t as u,q as B,m as Y,c as T,F as I,n as q}from"./index-f6c7c3e7.js";const Z={class:"file-copy-test"},ee={key:0,class:"result-section"},le={key:0},te=["href"],se={key:1},ae={key:0,class:"result-section"},oe={key:0,style:{"margin-top":"15px"}},ne={key:0},re=["href"],ue={key:1,style:{color:"#F56C6C"}},ie={key:0},de={__name:"FileCopyTest",setup(pe){const k=y(""),V=y(!1),p=y(null),x=y(""),U=y(!1),m=y(null),h=y({}),z=y(!1),A=y(["C:\\Windows\\System32\\notepad.exe","C:\\Users\\Public\\Pictures\\Sample Pictures\\Chrysanthemum.jpg","D:\\测试文件\\图片.jpg","E:\\文档\\报告.pdf"]),G=r=>{if(r===0)return"0 Bytes";const e=1024,i=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,n)).toFixed(2))+" "+i[n]},j=async()=>{var r,e;if(!k.value.trim()){b.warning("请输入文件路径");return}V.value=!0,p.value=null;try{const i=await N.post("/api/import/test-file-copy",{filePath:k.value.trim()});p.value=i.data,i.data.success?b.success("文件拷贝测试成功"):b.error("文件拷贝测试失败")}catch(i){console.error("测试失败:",i),p.value={success:!1,data:{error:((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.message)||i.message}},b.error("测试请求失败: "+i.message)}finally{V.value=!1}},L=async()=>{var e,i;if(!x.value.trim()){b.warning("请输入文件路径列表");return}const r=x.value.split(`
`).filter(n=>n.trim());if(r.length===0){b.warning("请输入有效的文件路径");return}U.value=!0,m.value=null;try{const n=[];for(const f of r)try{const w=await N.post("/api/import/test-file-copy",{filePath:f.trim()});n.push(w.data.data)}catch(w){n.push({success:!1,originalPath:f.trim(),error:((i=(e=w.response)==null?void 0:e.data)==null?void 0:i.message)||w.message})}m.value={total:n.length,successful:n.filter(f=>f.success).length,failed:n.filter(f=>!f.success).length,results:n},b.success(`批量测试完成：成功 ${m.value.successful} 个，失败 ${m.value.failed} 个`)}catch(n){console.error("批量测试失败:",n),b.error("批量测试失败: "+n.message)}finally{U.value=!1}},K=async()=>{z.value=!0;try{const r=await N.get("/api/import/path-mapping-config");r.data.success&&(h.value=r.data.data)}catch(r){console.error("加载配置失败:",r),b.error("加载配置失败: "+r.message)}finally{z.value=!1}};return Q(()=>{K()}),(r,e)=>{const i=c("el-input"),n=c("el-form-item"),f=c("el-button"),w=c("el-form"),W=c("el-alert"),P=c("el-card"),C=c("el-col"),v=c("el-descriptions-item"),M=c("el-descriptions"),D=c("el-table-column"),S=c("el-tag"),H=c("el-table"),E=c("el-row"),J=X("loading");return d(),_("div",Z,[t(P,{class:"page-card"},{header:l(()=>e[4]||(e[4]=[a("div",{class:"card-header"},[a("h2",null,"文件拷贝功能测试"),a("p",null,"测试Excel超链接文件自动拷贝到服务器功能")],-1)])),default:l(()=>[t(E,{gutter:20},{default:l(()=>[t(C,{span:12},{default:l(()=>[t(P,null,{header:l(()=>e[5]||(e[5]=[a("h3",null,"单文件拷贝测试",-1)])),default:l(()=>[t(w,{onSubmit:R(j,["prevent"])},{default:l(()=>[t(n,{label:"文件路径"},{default:l(()=>[t(i,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),placeholder:"例如: C:\\Users\\Documents\\图片.jpg",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(n,null,{default:l(()=>[t(f,{type:"primary",onClick:j,loading:V.value},{default:l(()=>e[6]||(e[6]=[o(" 测试拷贝 ")])),_:1,__:[6]},8,["loading"]),t(f,{onClick:e[1]||(e[1]=s=>k.value="")},{default:l(()=>e[7]||(e[7]=[o("清空")])),_:1,__:[7]})]),_:1})]),_:1}),p.value?(d(),_("div",ee,[e[13]||(e[13]=a("h4",null,"测试结果:",-1)),t(W,{title:p.value.success?"拷贝成功":"拷贝失败",type:p.value.success?"success":"error",closable:!1,"show-icon":""},{default:l(()=>[p.value.success?(d(),_("div",le,[a("p",null,[e[8]||(e[8]=a("strong",null,"原始路径:",-1)),o(" "+u(p.value.data.originalPath),1)]),a("p",null,[e[9]||(e[9]=a("strong",null,"文件名:",-1)),o(" "+u(p.value.data.fileName),1)]),a("p",null,[e[10]||(e[10]=a("strong",null,"访问URL:",-1)),a("a",{href:p.value.data.accessUrl,target:"_blank"},u(p.value.data.accessUrl),9,te)]),a("p",null,[e[11]||(e[11]=a("strong",null,"文件大小:",-1)),o(" "+u(G(p.value.data.fileSize)),1)])])):(d(),_("div",se,[a("p",null,[e[12]||(e[12]=a("strong",null,"错误信息:",-1)),o(" "+u(p.value.data.error),1)])]))]),_:1},8,["title","type"])])):B("",!0)]),_:1})]),_:1}),t(C,{span:12},{default:l(()=>[t(P,null,{header:l(()=>e[14]||(e[14]=[a("h3",null,"批量文件拷贝测试",-1)])),default:l(()=>[t(w,{onSubmit:R(L,["prevent"])},{default:l(()=>[t(n,{label:"文件路径列表"},{default:l(()=>[t(i,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),type:"textarea",rows:4,placeholder:`每行一个文件路径，例如:
C:\\Users\\Documents\\图片1.jpg
D:\\文档\\报告.pdf
E:\\视频\\演示.mp4`},null,8,["modelValue"])]),_:1}),t(n,null,{default:l(()=>[t(f,{type:"primary",onClick:L,loading:U.value},{default:l(()=>e[15]||(e[15]=[o(" 批量测试 ")])),_:1,__:[15]},8,["loading"]),t(f,{onClick:e[3]||(e[3]=s=>x.value="")},{default:l(()=>e[16]||(e[16]=[o("清空")])),_:1,__:[16]})]),_:1})]),_:1}),m.value?(d(),_("div",ae,[e[17]||(e[17]=a("h4",null,"批量测试结果:",-1)),t(M,{column:3,border:""},{default:l(()=>[t(v,{label:"总数"},{default:l(()=>[o(u(m.value.total),1)]),_:1}),t(v,{label:"成功"},{default:l(()=>[o(u(m.value.successful),1)]),_:1}),t(v,{label:"失败"},{default:l(()=>[o(u(m.value.failed),1)]),_:1})]),_:1}),m.value.results.length>0?(d(),_("div",oe,[t(H,{data:m.value.results,border:"",size:"small"},{default:l(()=>[t(D,{prop:"originalPath",label:"原始路径","min-width":"200"}),t(D,{label:"状态",width:"100",align:"center"},{default:l(s=>[t(S,{type:s.row.success?"success":"danger",size:"small"},{default:l(()=>[o(u(s.row.success?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),t(D,{label:"结果","min-width":"200"},{default:l(s=>[s.row.success?(d(),_("div",ne,[a("a",{href:s.row.accessUrl,target:"_blank",style:{color:"#409EFF"}},u(s.row.fileName),9,re)])):(d(),_("div",ue,u(s.row.error),1))]),_:1})]),_:1},8,["data"])])):B("",!0)])):B("",!0)]),_:1})]),_:1})]),_:1}),t(P,{style:{"margin-top":"20px"}},{header:l(()=>e[18]||(e[18]=[a("h3",null,"当前配置信息",-1)])),default:l(()=>[Y((d(),T(E,{gutter:20},{default:l(()=>[t(C,{span:8},{default:l(()=>[t(M,{title:"服务器配置",column:1,border:""},{default:l(()=>[t(v,{label:"服务器IP"},{default:l(()=>[o(u(h.value.serverIP||"加载中..."),1)]),_:1}),t(v,{label:"文件服务端口"},{default:l(()=>e[19]||(e[19]=[o("8080")])),_:1,__:[19]}),t(v,{label:"访问前缀"},{default:l(()=>e[20]||(e[20]=[o("/files/attachments")])),_:1,__:[20]})]),_:1})]),_:1}),t(C,{span:8},{default:l(()=>[t(M,{title:"文件限制",column:1,border:""},{default:l(()=>[t(v,{label:"最大文件大小"},{default:l(()=>e[21]||(e[21]=[o("50 MB")])),_:1,__:[21]}),t(v,{label:"允许的文件类型"},{default:l(()=>{var s,g;return[(d(!0),_(I,null,q((s=h.value.supportedFileTypes)==null?void 0:s.slice(0,5),F=>(d(),T(S,{key:F,size:"small",style:{margin:"2px"}},{default:l(()=>[o(u(F),1)]),_:2},1024))),128)),((g=h.value.supportedFileTypes)==null?void 0:g.length)>5?(d(),_("span",ie,"...")):B("",!0)]}),_:1})]),_:1})]),_:1}),t(C,{span:8},{default:l(()=>[t(M,{title:"拷贝模式",column:1,border:""},{default:l(()=>[t(v,{label:"状态"},{default:l(()=>{var s,g;return[t(S,{type:(g=(s=h.value.accessMethods)==null?void 0:s.fileCopy)!=null&&g.enabled?"success":"danger",size:"small"},{default:l(()=>{var F,$;return[o(u(($=(F=h.value.accessMethods)==null?void 0:F.fileCopy)!=null&&$.enabled?"已启用":"已禁用"),1)]}),_:1},8,["type"])]}),_:1}),t(v,{label:"目标目录"},{default:l(()=>{var s,g;return[o(u(((g=(s=h.value.accessMethods)==null?void 0:s.fileCopy)==null?void 0:g.targetDirectory)||"N/A"),1)]}),_:1})]),_:1})]),_:1})]),_:1})),[[J,z.value]])]),_:1}),t(P,{style:{"margin-top":"20px"}},{header:l(()=>e[22]||(e[22]=[a("h3",null,"常用测试路径",-1)])),default:l(()=>[t(E,{gutter:10},{default:l(()=>[(d(!0),_(I,null,q(A.value,(s,g)=>(d(),T(C,{span:6,key:g},{default:l(()=>[t(f,{size:"small",style:{width:"100%","margin-bottom":"5px"},onClick:F=>k.value=s},{default:l(()=>[o(u(s.split("\\").pop()),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})])}}},fe=O(de,[["__scopeId","data-v-451e024b"]]);export{fe as default};
