# 工作台时间范围功能测试说明

## 功能概述

本次更新为工作台页面添加了时间范围筛选功能，支持按以下时间范围查看数据：
- 今日
- 本周
- 本月
- 本季度
- 本年
- 全部（默认）

## 测试方法

### 1. 前端测试

1. 启动前后端服务器：
   ```bash
   # 后端服务器
   cd server
   npm start
   
   # 前端服务器
   cd frontend
   npm run dev
   ```

2. 访问工作台页面：
   - 打开浏览器访问 `http://localhost:5173`
   - 登录系统后进入工作台
   - 在页面右上角找到时间范围选择器
   - 选择不同的时间范围，观察数据变化

### 2. API测试

使用提供的测试页面 `test-time-range.html`：

1. 双击打开 `test-time-range.html` 文件
2. 点击不同的测试按钮验证各个API
3. 观察返回的数据是否符合时间范围要求

### 3. 测试要点

#### 工作台数据API (`/api/work-plan/dashboard`)
- 验证统计数据是否按时间范围正确筛选
- 检查返回的 `timeRange` 字段是否正确

#### 待办事项API (`/api/work-plan/dashboard/todos`)
- 验证待办事项列表是否按创建时间筛选
- 检查分页功能是否正常

#### 工作日志API (`/api/work-plan/dashboard/recent-logs`)
- 验证工作日志是否按记录时间筛选
- 检查日志内容和时间显示

#### 通知公告API (`/api/notice`)
- 验证通知公告是否按发布时间筛选
- 检查通知内容和发布时间

## 数据库要求

确保数据库中有足够的测试数据：
- 工作计划表 (`work_plans`) 中有不同时间的记录
- 工作日志表 (`work_logs`) 中有不同时间的日志
- 通知公告表 (`notices`) 中有不同时间的公告

## 预期结果

1. **时间范围选择器**：能够正确切换不同时间范围
2. **数据筛选**：各模块数据能够根据选择的时间范围正确筛选
3. **实时更新**：切换时间范围后，所有相关数据立即更新
4. **API响应**：所有API都能正确处理 `timeRange` 参数

## 故障排除

### 常见问题

1. **数据不变化**
   - 检查数据库中是否有对应时间范围的数据
   - 确认API是否正确接收和处理 `timeRange` 参数

2. **API错误**
   - 检查后端服务器是否正常运行（端口3001）
   - 查看浏览器控制台是否有错误信息
   - 检查数据库连接是否正常

3. **前端显示问题**
   - 确认前端服务器正常运行（端口5173）
   - 检查浏览器控制台是否有JavaScript错误
   - 清除浏览器缓存后重试

### 调试工具

- 使用 `test-time-range.html` 进行API测试
- 查看浏览器开发者工具的网络面板
- 检查后端服务器的控制台日志

## 技术实现

### 前端修改
- 修改了 `WorkDashboard.vue` 中的数据获取函数
- 添加了时间范围参数传递逻辑
- 更新了 `refreshDataByTimeRange` 函数

### 后端修改
- 更新了 `workPlanController.js` 中的相关函数
- 添加了时间范围SQL条件构建逻辑
- 修改了 `noticeController.js` 支持时间筛选

### 支持的时间范围
- `today`: 今日（当天0点到23:59:59）
- `week`: 本周（周一到周日）
- `month`: 本月（月初到月末）
- `quarter`: 本季度（季度开始到结束）
- `year`: 本年（年初到年末）
- `null`或未传递: 全部数据