<template>
  <div class="modern-dashboard">
    <!-- é¡µé¢æ ‡é¢˜å’Œæ—¶é—´èŒƒå›´é€‰æ‹© -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="page-title">
            <el-icon class="title-icon"><DataBoard /></el-icon>
            å·¥ä½œå°
          </h1>
          <div class="welcome-message">
            <p class="welcome-line">
              <span class="greeting-section">
                <span class="greeting-emoji">{{ getGreeting().split(' ')[1] || 'ğŸ‘‹' }}</span>
                <span class="greeting-words">{{ getGreeting().split(' ')[0] }}ï¼Œ</span>
                <span class="user-name">{{ getCurrentUser() }}</span>
                <span class="exclamation">ï¼</span>
              </span>
              <span class="date-section">
                <el-icon class="calendar-icon"><Calendar /></el-icon>
                ä»Šå¤©æ˜¯ {{ getCurrentDate() }}
                <el-tag size="small" type="primary" class="weekday-tag">
                  {{ getCurrentWeekday() }}
                </el-tag>
              </span>
            </p>
          </div>
        </div>
        <div class="header-right">
          <div class="time-filter">
            <span class="filter-label">æ—¶é—´èŒƒå›´ï¼š</span>
            <el-select v-model="selectedTimeRange" @change="handleTimeRangeChange" class="time-select">
              <el-option label="ä»Šå¤©" value="today" />
              <el-option label="æœ¬å‘¨" value="week" />
              <el-option label="æœ¬æœˆ" value="month" />
              <el-option label="æœ¬å­£åº¦" value="quarter" />
              <el-option label="æœ¬å¹´" value="year" />
            </el-select>
          </div>
          <div class="quick-actions">
            <el-button type="primary" @click="createNewPlan" class="action-btn">
              <el-icon><Plus /></el-icon>
              æ–°å»ºè®¡åˆ’
            </el-button>
            <el-button @click="refreshData" class="action-btn">
              <el-icon><Refresh /></el-icon>
              åˆ·æ–°
            </el-button>
          </div>
        </div>
      </div>
    </div>

    <!-- é¡¶éƒ¨ç»Ÿè®¡æ•°æ®å±•ç¤ºè¡Œ -->
    <div class="stats-row">
      <el-row :gutter="20">
        <!-- ç¬¬ä¸€åˆ—ï¼šåŒ…å«åŸæ¥çš„1ã€2ã€3åˆ—å’Œæ–°å¢çš„é€šçŸ¥å…¬å‘Šæ¨¡å— -->
        <el-col :span="18">
          <!-- ä¸Šéƒ¨åˆ†ï¼šåŸæ¥çš„1ã€2ã€3åˆ— -->
          <div class="upper-section">
            <el-row :gutter="20">
              <!-- åŸç¬¬ä¸€åˆ—ï¼šå®Œæˆæƒ…å†µ -->
              <el-col :span="8">
                <div class="stat-card left-card">
                  <div class="completion-grid">
                    <div class="completion-item">
                      <span class="completion-label">æ€»ä½“å®Œæˆç‡</span>
                      <div class="completion-progress">
                        <el-progress :percentage="overallProgress" :stroke-width="12" :show-text="false" color="#409eff" />
                        <span class="progress-text progress-text-blue">{{ overallProgress }}%</span>
                      </div>
                    </div>
                    <div class="completion-item">
                      <span class="completion-label">å¹³å‡è¿›åº¦</span>
                      <div class="completion-progress">
                        <el-progress :percentage="dashboardData.planStats?.avgProgress || 0" :stroke-width="12" :show-text="false" color="#67c23a" />
                        <span class="progress-text progress-text-green">{{ (dashboardData.planStats?.avgProgress || 0).toFixed(1) }}%</span>
                      </div>
                    </div>
                    <div class="completion-item">
                      <span class="completion-label">æœ¬å‘¨å®Œæˆç‡</span>
                      <div class="completion-progress">
                        <el-progress :percentage="weeklyTargetRate" :stroke-width="12" :show-text="false" color="#e6a23c" />
                        <span class="progress-text progress-text-orange">{{ weeklyTargetRate }}%</span>
                      </div>
                    </div>
                    <div class="completion-item">
                      <span class="completion-label">ä»»åŠ¡æ•ˆç‡</span>
                      <div class="completion-progress">
                        <el-progress :percentage="85" :stroke-width="12" :show-text="false" color="#f56c6c" />
                        <span class="progress-text progress-text-red">85%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </el-col>

              <!-- åŸç¬¬äºŒåˆ—ï¼šè®¡åˆ’ç»Ÿè®¡å’ŒæŸ±å½¢å›¾ -->
              <el-col :span="8">
                <div class="stat-card middle-card">
                  <div class="middle-content">
                    <!-- ä¸Šéƒ¨ï¼šç»Ÿè®¡æ ‡ç­¾ -->
                    <el-row :gutter="32" justify="center" align="middle" class="stats-tags">
                      <el-col :span="12" class="text-center">
                        <span class="stat-tag stat-tag-total">æ€»è®¡åˆ’</span>
                        <span class="stat-tag-value">{{ dashboardData.planStats?.totalPlans || 0 }}é¡¹</span>
                      </el-col>
                      <el-col :span="12" class="text-center">
                        <span class="stat-tag stat-tag-completed">å·²å®Œæˆ</span>
                        <span class="stat-tag-value">{{ dashboardData.planStats?.completedPlans || 0 }}é¡¹</span>
                      </el-col>
                    </el-row>
                    <!-- ä¸‹éƒ¨ï¼šEChartsæŸ±å½¢å›¾ -->
                    <div class="bar-chart">
                      <div ref="barChartRef" class="echarts-container"></div>
                    </div>
                  </div>
                </div>
              </el-col>

              <!-- åŸç¬¬ä¸‰åˆ—ï¼šåœ†ç¯å›¾ -->
              <el-col :span="8">
                <div class="stat-card right-card">
                  <div class="pie-charts">
                    <div class="pie-item">
                      <el-progress
                        type="circle"
                        :percentage="getPercentage('inProgress')"
                        :width="80"
                        :stroke-width="12"
                        color="#409eff"
                      >
                        <template #default="{ percentage }">
                          <div class="pie-center">
                            <div class="pie-value">{{ percentage }}%</div>
                          </div>
                        </template>
                      </el-progress>
                      <div class="pie-label">è¿›è¡Œä¸­</div>
                    </div>
                    <div class="pie-item">
                      <el-progress
                        type="circle"
                        :percentage="getPercentage('completed')"
                        :width="80"
                        :stroke-width="12"
                        color="#67c23a"
                      >
                        <template #default="{ percentage }">
                          <div class="pie-center">
                            <div class="pie-value">{{ percentage }}%</div>
                          </div>
                        </template>
                      </el-progress>
                      <div class="pie-label">å·²å®Œæˆ</div>
                    </div>
                    <div class="pie-item">
                      <el-progress
                        type="circle"
                        :percentage="getPercentage('overdue')"
                        :width="80"
                        :stroke-width="12"
                        color="#f56c6c"
                      >
                        <template #default="{ percentage }">
                          <div class="pie-center">
                            <div class="pie-value">{{ percentage }}%</div>
                          </div>
                        </template>
                      </el-progress>
                      <div class="pie-label">å·²é€¾æœŸ</div>
                    </div>
                  </div>
                </div>
              </el-col>
            </el-row>
          </div>

          <!-- ä¸‹éƒ¨åˆ†ï¼šæ–°å¢çš„é€šçŸ¥å…¬å‘Šæ¨¡å— -->
          <div class="lower-section">
            <div class="stat-card notice-card">
              <el-row :gutter="8">
                <!-- å·¦ä¾§æ ‡é¢˜åŒºåŸŸ -->
                <el-col :span="6">
                  <div class="notice-header">
                    <h3 class="notice-title">
                      <el-icon><Bell /></el-icon>
                      <span>é€šçŸ¥å…¬å‘Š</span>
                    </h3>
                  </div>
                </el-col>
                <!-- å³ä¾§æ»šåŠ¨æ˜¾ç¤ºåŒºåŸŸ -->
                <el-col :span="18">
                  <div class="notice-content">
                    <div class="notice-scroll" ref="noticeScrollRef">
                      <div class="notice-item" v-for="(notice, index) in noticeList" :key="index">
                        <div class="notice-dot"></div>
                        <div class="notice-text">{{ notice.content }}</div>
                        <div class="notice-time">{{ notice.time }}</div>
                      </div>
                    </div>
                  </div>
                </el-col>
              </el-row>
            </div>
          </div>
        </el-col>

        <!-- ç¬¬äºŒåˆ—ï¼šæ—¥å†ç»„ä»¶ï¼ˆåŸç¬¬å››åˆ—ï¼‰ -->
        <el-col :span="6">
          <div class="stat-card calendar-card">
            <div class="calendar-content">
              <el-calendar v-model="currentDate" class="dashboard-calendar">
                <template #date-cell="{ data }">
                  <div class="calendar-day" :class="{ 'is-today': isToday(data.day) }">
                    {{ data.day.split('-').pop() }}
                  </div>
                </template>
              </el-calendar>
            </div>
          </div>
        </el-col>
      </el-row>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
      <div class="content-grid">
        <!-- å¾…åŠäº‹é¡¹ -->
        <div class="content-section todo-section">
          <div class="section-header">
            <h3 class="section-title">
              <el-icon><Clock /></el-icon>
              å¾…åŠäº‹é¡¹
              <el-badge :value="todoList.length" class="todo-badge" />
            </h3>
            <div class="section-actions">
              <el-button text @click="viewAllTodos" class="view-all-btn">
                æŸ¥çœ‹å…¨éƒ¨
                <el-icon class="el-icon--right"><ArrowRight /></el-icon>
              </el-button>
            </div>
          </div>
          <div class="todo-container">
            <div v-if="loading.todos" class="loading-state">
              <el-skeleton :rows="3" animated />
            </div>
            <div v-else-if="todoList.length === 0" class="empty-state">
              <el-empty description="æš‚æ— å¾…åŠäº‹é¡¹">
                <el-button type="primary" @click="createNewPlan">åˆ›å»ºæ–°è®¡åˆ’</el-button>
              </el-empty>
            </div>
            <div v-else class="todo-list">
              <div
                v-for="todo in todoList.slice(0, 6)"
                :key="todo.ID"
                class="todo-item"
                @click="viewPlanDetail(todo.ID)"
              >
                <div class="todo-priority" :class="`priority-${todo.Priority}`"></div>
                <div class="todo-main">
                  <div class="todo-header">
                    <h4 class="todo-title">{{ todo.Title }}</h4>
                    <el-tag :type="getUrgencyType(todo.DaysRemaining)" size="small" class="urgency-tag">
                      {{ formatUrgency(todo.DaysRemaining) }}
                    </el-tag>
                  </div>
                  <div class="todo-meta">
                    <span class="todo-type">
                      <el-icon><Folder /></el-icon>
                      {{ todo.WorkTypeName }}
                    </span>
                    <span class="todo-deadline">
                      <el-icon><Calendar /></el-icon>
                      {{ formatDate(todo.EndDate) }}
                    </span>
                  </div>
                  <div class="todo-progress">
                    <el-progress
                      :percentage="todo.Progress"
                      :stroke-width="4"
                      :show-text="false"
                      :color="getProgressColorGradient(todo.Progress)"
                    />
                    <span class="progress-text">{{ todo.Progress }}%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æœ€è¿‘åŠ¨æ€ -->
        <div class="content-section activity-section">
          <div class="section-header">
            <h3 class="section-title">
              <el-icon><Bell /></el-icon>
              æœ€è¿‘åŠ¨æ€
            </h3>
            <div class="section-actions">
              <el-button text @click="viewAllLogs" class="view-all-btn">
                æŸ¥çœ‹å…¨éƒ¨
                <el-icon class="el-icon--right"><ArrowRight /></el-icon>
              </el-button>
            </div>
          </div>
          <div class="activity-container">
            <div v-if="loading.logs" class="loading-state">
              <el-skeleton :rows="3" animated />
            </div>
            <div v-else-if="recentLogs.length === 0" class="empty-state">
              <el-empty description="æš‚æ— å·¥ä½œè®°å½•">
                <el-button type="primary" @click="addWorkLog">æ·»åŠ å·¥ä½œè®°å½•</el-button>
              </el-empty>
            </div>
            <div v-else class="activity-timeline">
              <div
                v-for="log in recentLogs.slice(0, 5)"
                :key="log.ID"
                class="activity-item"
                @click="viewLogDetail(log.ID)"
              >
                <div class="activity-time">
                  <div class="time-dot" :class="getActivityType(log)"></div>
                  <div class="time-text">{{ formatTimeAgo(log.LogDate) }}</div>
                </div>
                <div class="activity-content">
                  <div class="activity-header">
                    <h4 class="activity-title">{{ log.PlanTitle || 'ç‹¬ç«‹å·¥ä½œè®°å½•' }}</h4>
                    <div class="activity-meta">
                      <el-tag size="small" type="info">
                        <el-icon><Clock /></el-icon>
                        {{ log.WorkHours }}h
                      </el-tag>
                    </div>
                  </div>
                  <p class="activity-description">{{ truncateText(log.Content, 80) }}</p>
                  <div v-if="log.Progress !== null" class="activity-progress">
                    <el-progress
                      :percentage="log.Progress"
                      :stroke-width="3"
                      :show-text="false"
                      :color="getProgressColorGradient(log.Progress)"
                    />
                    <span class="progress-text">{{ log.Progress }}%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å¿«é€Ÿç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon completed">
            <el-icon><Check /></el-icon>
          </div>
          <div class="stat-info">
            <div class="stat-number">{{ dashboardData.planStats?.completedPlans || 0 }}</div>
            <div class="stat-label">æœ¬æœˆå®Œæˆ</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon in-progress">
            <el-icon><Loading /></el-icon>
          </div>
          <div class="stat-info">
            <div class="stat-number">{{ dashboardData.planStats?.inProgressPlans || 0 }}</div>
            <div class="stat-label">è¿›è¡Œä¸­</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon warning">
            <el-icon><Warning /></el-icon>
          </div>
          <div class="stat-info">
            <div class="stat-number">{{ dashboardData.planStats?.overduePlans || 0 }}</div>
            <div class="stat-label">éœ€å…³æ³¨</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon total">
            <el-icon><DataBoard /></el-icon>
          </div>
          <div class="stat-info">
            <div class="stat-number">{{ totalWorkHours }}</div>
            <div class="stat-label">æœ¬æœˆå·¥æ—¶</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, onUnmounted, computed, nextTick } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/store/user'
import {
  Sunny,
  Plus,
  EditPen,
  Refresh,
  DataBoard,
  ArrowDown,
  TrendCharts,
  Timer,
  Clock,
  ArrowRight,
  Folder,
  Calendar,
  Bell,
  Check,
  Loading,
  Warning
} from '@element-plus/icons-vue'
import * as echarts from 'echarts'
import api from '@/services/api'

// è·¯ç”±å®ä¾‹
const router = useRouter()

// ç”¨æˆ·çŠ¶æ€ç®¡ç†
const userStore = useUserStore()

// å“åº”å¼æ•°æ®
const dashboardData = ref({})
const todoList = ref([])
const recentLogs = ref([])
const selectedTimeRange = ref('month') // é»˜è®¤é€‰æ‹©æœ¬æœˆ
const todayWorkHours = ref(8.5)
const weeklyTargetRate = ref(85)
const totalWorkHours = ref(168)

// é€šçŸ¥å…¬å‘Šæ•°æ®
const noticeList = ref([
  {
    content: 'ç³»ç»Ÿå°†äºæœ¬å‘¨å…­è¿›è¡Œç»´æŠ¤å‡çº§ï¼Œè¯·æå‰ä¿å­˜å·¥ä½œè¿›åº¦',
    time: '2024-01-20 09:00'
  },
  {
    content: 'æ–°ç‰ˆæœ¬å·¥ä½œè®¡åˆ’ç®¡ç†ç³»ç»Ÿå·²ä¸Šçº¿ï¼Œæ¬¢è¿ä½“éªŒæ–°åŠŸèƒ½',
    time: '2024-01-19 14:30'
  },
  {
    content: 'è¯·å„éƒ¨é—¨åŠæ—¶æäº¤æœ¬æœˆå·¥ä½œæ€»ç»“æŠ¥å‘Š',
    time: '2024-01-18 16:45'
  },
  {
    content: 'è´¨é‡ç®¡ç†åŸ¹è®­å°†äºä¸‹å‘¨ä¸‰ä¸¾è¡Œï¼Œè¯·ç›¸å…³äººå‘˜å‡†æ—¶å‚åŠ ',
    time: '2024-01-17 10:20'
  },
  {
    content: 'å¹´åº¦å·¥ä½œè®¡åˆ’åˆ¶å®šä¼šè®®å®šäºä¸‹å‘¨äº”å¬å¼€',
    time: '2024-01-16 11:15'
  }
])

// EChartsç›¸å…³å¼•ç”¨
const barChartRef = ref(null)
let barChart = null

// é€šçŸ¥æ»šåŠ¨ç›¸å…³å¼•ç”¨
const noticeScrollRef = ref(null)
let noticeScrollTimer = null

// æ—¥å†ç›¸å…³æ•°æ®
const currentDate = ref(new Date())

// åŠ è½½çŠ¶æ€
const loading = reactive({
  dashboard: false,
  todos: false,
  logs: false
})

// æ¨¡æ‹Ÿä¸€å‘¨æ•ˆç‡æ•°æ®
const weeklyEfficiency = ref([
  { day: 'å‘¨ä¸€', percentage: 85 },
  { day: 'å‘¨äºŒ', percentage: 92 },
  { day: 'å‘¨ä¸‰', percentage: 78 },
  { day: 'å‘¨å››', percentage: 95 },
  { day: 'å‘¨äº”', percentage: 88 },
  { day: 'å‘¨å…­', percentage: 60 },
  { day: 'å‘¨æ—¥', percentage: 45 }
])

// è®¡ç®—å±æ€§ï¼šæ•´ä½“è¿›åº¦
const overallProgress = computed(() => {
  const stats = dashboardData.value.planStats
  if (!stats || !stats.totalPlans) return 0
  return Math.round((stats.completedPlans / stats.totalPlans) * 100)
})

/**
 * è·å–é—®å€™è¯­
 */
const getGreeting = () => {
  const hour = new Date().getHours()
  const greetings = {
    morning: ['æ—©ä¸Šå¥½ ğŸŒ…', 'æ–°çš„ä¸€å¤©å¼€å§‹äº† ğŸŒ'],
    afternoon: ['ä¸‹åˆå¥½ ğŸŒ¤ï¸', 'ä¸‹åˆæ—¶å…‰ ğŸŒ»'],
    evening: ['æ™šä¸Šå¥½ ğŸŒ™', 'å¤œå¹•é™ä¸´ ğŸŒƒ']
  }
  
  let timeOfDay, messages
  if (hour >= 5 && hour < 12) {
    timeOfDay = 'morning'
    messages = greetings.morning
  } else if (hour >= 12 && hour < 18) {
    timeOfDay = 'afternoon' 
    messages = greetings.afternoon
  } else {
    timeOfDay = 'evening'
    messages = greetings.evening
  }
  
  // æ ¹æ®æ—¥æœŸé€‰æ‹©ä¸åŒçš„é—®å€™è¯­ï¼Œè®©æ¯å¤©éƒ½æœ‰æ–°é²œæ„Ÿ
  const dayIndex = new Date().getDate() % messages.length
  return messages[dayIndex]
}

/**
 * è·å–å½“å‰ç”¨æˆ·å
 */
const getCurrentUser = () => {
  // ä»ç”¨æˆ·çŠ¶æ€ç®¡ç†ä¸­è·å–çœŸå®ç”¨æˆ·ä¿¡æ¯
  const user = userStore.user
  if (user && (user.realName || user.RealName)) {
    return user.realName || user.RealName
  }
  if (user && (user.username || user.Username)) {
    return user.username || user.Username
  }
  return 'ç”¨æˆ·'
}

/**
 * è·å–å½“å‰æ—¥æœŸï¼ˆä¸åŒ…å«æ˜ŸæœŸå‡ ï¼‰
 */
const getCurrentDate = () => {
  const today = new Date()
  const options = { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric'
  }
  return today.toLocaleDateString('zh-CN', options)
}

/**
 * è·å–å½“å‰æ˜ŸæœŸå‡ 
 */
const getCurrentWeekday = () => {
  const today = new Date()
  const options = { 
    weekday: 'long'
  }
  return today.toLocaleDateString('zh-CN', options)
}

/**
 * è·å–å·¥ä½œå°æ•°æ®
 */
const getDashboardData = async () => {
  try {
    loading.dashboard = true
    const response = await api.get('/work-plan/dashboard')
    if (response.data.success) {
      dashboardData.value = response.data.data
    }
  } catch (error) {
    console.error('è·å–å·¥ä½œå°æ•°æ®å¤±è´¥:', error)
    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    dashboardData.value = {
      planStats: {
        totalPlans: 15,
        inProgressPlans: 6,
        completedPlans: 8,
        overduePlans: 1,
        avgProgress: 78.5,
        weeklyNew: 3,
        upcomingDeadlines: 2
      }
    }
  } finally {
    loading.dashboard = false
  }
}

/**
 * è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨
 */
const getTodoList = async () => {
  try {
    loading.todos = true
    const response = await api.get('/work-plan/dashboard/todos', {
      params: { limit: 10 }
    })
    if (response.data.success) {
      todoList.value = response.data.data
    }
  } catch (error) {
    console.error('è·å–å¾…åŠäº‹é¡¹å¤±è´¥:', error)
    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    todoList.value = [
      {
        ID: 1,
        Title: 'å®Œæˆç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£',
        Priority: 'high',
        WorkTypeName: 'ç³»ç»Ÿè®¾è®¡',
        EndDate: '2024-01-25',
        DaysRemaining: 2,
        Progress: 75
      },
      {
        ID: 2,
        Title: 'ç”¨æˆ·ç•Œé¢åŸå‹è®¾è®¡',
        Priority: 'medium',
        WorkTypeName: 'UIè®¾è®¡',
        EndDate: '2024-01-28',
        DaysRemaining: 5,
        Progress: 45
      },
      {
        ID: 3,
        Title: 'æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–',
        Priority: 'high',
        WorkTypeName: 'æ•°æ®åº“',
        EndDate: '2024-01-22',
        DaysRemaining: -1,
        Progress: 90
      }
    ]
  } finally {
    loading.todos = false
  }
}

/**
 * è·å–æœ€è¿‘å·¥ä½œæ—¥å¿—
 */
const getRecentLogs = async () => {
  try {
    loading.logs = true
    const response = await api.get('/work-plan/dashboard/recent-logs', {
      params: { limit: 8 }
    })
    if (response.data.success) {
      recentLogs.value = response.data.data
    }
  } catch (error) {
    console.error('è·å–æœ€è¿‘å·¥ä½œæ—¥å¿—å¤±è´¥:', error)
    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    recentLogs.value = [
      {
        ID: 1,
        PlanTitle: 'ç³»ç»Ÿæ¶æ„è®¾è®¡',
        Content: 'å®Œæˆäº†æ ¸å¿ƒæ¨¡å—çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶å’Œæ•°æ®æµè®¾è®¡',
        LogDate: '2024-01-20 14:30:00',
        WorkHours: 4,
        Progress: 75
      },
      {
        ID: 2,
        PlanTitle: 'UIç•Œé¢è®¾è®¡',
        Content: 'è®¾è®¡äº†ä¸»è¦é¡µé¢çš„äº¤äº’åŸå‹ï¼ŒåŒ…æ‹¬ç™»å½•é¡µé¢ã€ä»ªè¡¨ç›˜å’Œç”¨æˆ·ç®¡ç†é¡µé¢',
        LogDate: '2024-01-20 10:15:00',
        WorkHours: 3,
        Progress: 45
      }
    ]
  } finally {
    loading.logs = false
  }
}

/**
 * åˆå§‹åŒ–EChartsæŸ±çŠ¶å›¾
 */
const initBarChart = () => {
  if (!barChartRef.value) return
  
  // é”€æ¯å·²å­˜åœ¨çš„å›¾è¡¨å®ä¾‹
  if (barChart) {
    barChart.dispose()
  }
  
  // åˆ›å»ºæ–°çš„å›¾è¡¨å®ä¾‹
  barChart = echarts.init(barChartRef.value)
  
  // æ›´æ–°å›¾è¡¨æ•°æ®
  updateBarChart()
}

/**
 * æ›´æ–°EChartsæŸ±çŠ¶å›¾æ•°æ®
 */
const updateBarChart = () => {
  if (!barChart || !dashboardData.value.planStats) return
  
  const stats = dashboardData.value.planStats
  const data = [
    {
      name: 'è¿›è¡Œä¸­',
      value: stats.inProgressPlans || 0,
      itemStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: '#4A90E2' },
          { offset: 1, color: '#8EC1F7' }
        ])
      }
    },
    {
       name: 'å·²å®Œæˆ',
       value: stats.completedPlans || 0,
       itemStyle: {
         color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
           { offset: 0, color: '#67C23A' },
           { offset: 1, color: '#95D475' }
         ])
       }
     },
    {
      name: 'å·²é€¾æœŸ',
      value: stats.overduePlans || 0,
      itemStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: '#D0021B' },
          { offset: 1, color: '#F78B9B' }
        ])
      }
    }
  ]
  
  const option = {
    grid: {
      left: '10%',
      right: '10%',
      top: '20%',
      bottom: '25%'
    },
    xAxis: {
      type: 'category',
      data: data.map(item => item.name),
      axisLine: {
        show: true,
        lineStyle: {
          color: '#e0e0e0'
        }
      },
      axisTick: {
        show: false
      },
      axisLabel: {
        color: '#666',
        fontSize: 12
      }
    },
    yAxis: {
      type: 'value',
      show: false
    },
    series: [{
      type: 'bar',
      data: data,
      barWidth: '40%',
      label: {
        show: true,
        position: 'top',
        formatter: '{c}é¡¹',
        color: '#333',
        fontFamily: 'Microsoft YaHei, Arial, sans-serif',
        fontSize: 12,
        fontWeight: 'normal'
      },
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.3)'
        }
      }
    }]
  }
  
  barChart.setOption(option)
}

/**
 * åˆ·æ–°æ‰€æœ‰æ•°æ®
 */
const refreshData = async () => {
  await Promise.all([
    getDashboardData(),
    getTodoList(),
    getRecentLogs()
  ])
  
  // æ•°æ®æ›´æ–°ååˆ·æ–°å›¾è¡¨
  await nextTick()
  updateBarChart()
  
  ElMessage.success('æ•°æ®åˆ·æ–°æˆåŠŸ')
}

/**
 * å¤„ç†æ—¶é—´èŒƒå›´å˜åŒ–
 */
const handleTimeRangeChange = (value) => {
  selectedTimeRange.value = value
  // æ ¹æ®æ—¶é—´èŒƒå›´é‡æ–°è·å–æ•°æ®
  refreshDataByTimeRange()
}

/**
 * æ ¹æ®æ—¶é—´èŒƒå›´åˆ·æ–°æ•°æ®
 */
const refreshDataByTimeRange = async () => {
  try {
    loading.dashboard = true
    // è¿™é‡Œå¯ä»¥æ ¹æ®selectedTimeRange.valueè°ƒç”¨ä¸åŒçš„API
    await Promise.all([
      getDashboardData(),
      getTodoList(),
      getRecentLogs()
    ])
  } catch (error) {
    console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error)
  } finally {
    loading.dashboard = false
  }
}



/**
 * è®¡ç®—åœ†ç¯å›¾ç™¾åˆ†æ¯”
 */
const getPercentage = (type) => {
  const stats = dashboardData.value.planStats
  if (!stats || !stats.totalPlans) return 0
  
  let value = 0
  switch (type) {
    case 'inProgress':
      value = stats.inProgressPlans || 0
      break
    case 'completed':
      value = stats.completedPlans || 0
      break
    case 'overdue':
      value = stats.overduePlans || 0
      break
  }
  
  return Math.round((value / stats.totalPlans) * 100)
}

/**
 * è·å–è¿›åº¦æ¡æ¸å˜è‰²
 */
const getProgressColorGradient = (percentage) => {
  if (percentage >= 80) {
    return [{ color: '#67c23a', percentage: 100 }]
  } else if (percentage >= 60) {
    return [{ color: '#e6a23c', percentage: 100 }]
  } else if (percentage >= 40) {
    return [{ color: '#f56c6c', percentage: 100 }]
  } else {
    return [{ color: '#909399', percentage: 100 }]
  }
}

/**
 * æ ¼å¼åŒ–ç´§æ€¥ç¨‹åº¦
 */
const formatUrgency = (daysRemaining) => {
  if (daysRemaining < 0) return 'å·²é€¾æœŸ'
  if (daysRemaining === 0) return 'ä»Šå¤©åˆ°æœŸ'
  if (daysRemaining <= 3) return 'ç´§æ€¥'
  if (daysRemaining <= 7) return 'å³å°†åˆ°æœŸ'
  return 'æ­£å¸¸'
}

/**
 * è·å–ç´§æ€¥ç¨‹åº¦ç±»å‹
 */
const getUrgencyType = (daysRemaining) => {
  if (daysRemaining < 0) return 'danger'
  if (daysRemaining <= 3) return 'warning'
  return 'info'
}

/**
 * æ ¼å¼åŒ–æ—¥æœŸ
 */
const formatDate = (dateStr) => {
  const date = new Date(dateStr)
  return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })
}

/**
 * æ ¼å¼åŒ–æ—¶é—´è·ç¦»
 */
const formatTimeAgo = (dateStr) => {
  const date = new Date(dateStr)
  const now = new Date()
  const diff = now - date
  const hours = Math.floor(diff / (1000 * 60 * 60))
  const days = Math.floor(hours / 24)
  
  if (days > 0) return `${days}å¤©å‰`
  if (hours > 0) return `${hours}å°æ—¶å‰`
  return 'åˆšåˆš'
}

/**
 * åˆ¤æ–­æ˜¯å¦ä¸ºä»Šå¤©
 */
const isToday = (dateStr) => {
  const today = new Date()
  const date = new Date(dateStr)
  return today.toDateString() === date.toDateString()
}

/**
 * è·å–æ´»åŠ¨ç±»å‹
 */
const getActivityType = (log) => {
  if (log.Progress >= 100) return 'completed'
  if (log.Issues) return 'warning'
  return 'normal'
}

/**
 * æˆªæ–­æ–‡æœ¬
 */
const truncateText = (text, maxLength) => {
  if (!text) return ''
  return text.length > maxLength ? text.substring(0, maxLength) + '...' : text
}

/**
 * åˆ›å»ºæ–°è®¡åˆ’
 */
const createNewPlan = () => {
  router.push('/admin/work-plan/plans/create')
}

/**
 * æ·»åŠ å·¥ä½œè®°å½•
 */
const addWorkLog = () => {
  router.push('/admin/work-plan/logs/create')
}

/**
 * æŸ¥çœ‹è®¡åˆ’è¯¦æƒ…
 */
const viewPlanDetail = (planId) => {
  router.push(`/admin/work-plan/plans/${planId}`)
}

/**
 * æŸ¥çœ‹æ—¥å¿—è¯¦æƒ…
 */
const viewLogDetail = (logId) => {
  router.push(`/admin/work-plan/logs/${logId}`)
}

/**
 * æŸ¥çœ‹æ‰€æœ‰å¾…åŠäº‹é¡¹
 */
const viewAllTodos = () => {
  router.push('/admin/work-plan/plans?status=pending,in_progress')
}

/**
 * æŸ¥çœ‹æ‰€æœ‰å·¥ä½œæ—¥å¿—
 */
const viewAllLogs = () => {
  router.push('/admin/work-plan/logs')
}

/**
 * åˆå§‹åŒ–é€šçŸ¥è‡ªåŠ¨æ»šåŠ¨ï¼ˆæ°´å¹³å‘å·¦æ»šåŠ¨ï¼‰
 */
const initNoticeAutoScroll = () => {
  if (!noticeScrollRef.value) return
  
  const scrollContainer = noticeScrollRef.value
  let scrollLeft = 0
  const scrollStep = 1 // æ¯æ¬¡æ»šåŠ¨çš„åƒç´ 
  const scrollDelay = 30 // æ»šåŠ¨é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  const pauseTime = 1000 // æ»šåŠ¨åˆ°å³ç«¯åçš„æš‚åœæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  
  const autoScroll = () => {
    if (!scrollContainer) return
    
    const maxScrollLeft = scrollContainer.scrollWidth - scrollContainer.clientWidth
    
    if (maxScrollLeft <= 0) {
      // å†…å®¹ä¸è¶³ä»¥æ»šåŠ¨
      return
    }
    
    if (scrollLeft >= maxScrollLeft) {
      // æ»šåŠ¨åˆ°å³ç«¯ï¼ŒçŸ­æš‚æš‚åœåå¹³æ»‘é‡ç½®åˆ°å·¦ç«¯
      setTimeout(() => {
        scrollLeft = 0
        scrollContainer.scrollLeft = 0
      }, pauseTime)
    } else {
      scrollLeft += scrollStep
      scrollContainer.scrollLeft = scrollLeft
    }
  }
  
  // å¯åŠ¨è‡ªåŠ¨æ»šåŠ¨
  noticeScrollTimer = setInterval(autoScroll, scrollDelay)
  
  // é¼ æ ‡æ‚¬åœæ—¶æš‚åœæ»šåŠ¨
  scrollContainer.addEventListener('mouseenter', () => {
    if (noticeScrollTimer) {
      clearInterval(noticeScrollTimer)
      noticeScrollTimer = null
    }
  })
  
  // é¼ æ ‡ç¦»å¼€æ—¶æ¢å¤æ»šåŠ¨
  scrollContainer.addEventListener('mouseleave', () => {
    if (!noticeScrollTimer) {
      noticeScrollTimer = setInterval(autoScroll, scrollDelay)
    }
  })
}

/**
 * æ¸…ç†è‡ªåŠ¨æ»šåŠ¨å®šæ—¶å™¨
 */
const clearNoticeAutoScroll = () => {
  if (noticeScrollTimer) {
    clearInterval(noticeScrollTimer)
    noticeScrollTimer = null
  }
}

// ç»„ä»¶æŒ‚è½½æ—¶è·å–æ•°æ®
onMounted(async () => {
  // è·å–ç”¨æˆ·ä¿¡æ¯
  try {
    await userStore.fetchProfile()
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
  }
  
  await refreshData()
  // ç¡®ä¿DOMæ¸²æŸ“å®Œæˆååˆå§‹åŒ–å›¾è¡¨å’Œè‡ªåŠ¨æ»šåŠ¨
  await nextTick()
  initBarChart()
  initNoticeAutoScroll()
})

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
onUnmounted(() => {
  clearNoticeAutoScroll()
})
</script>

<style scoped>
.modern-dashboard {
  min-height: 100vh;
  background: #fff;
  padding: 20px;
  font-family: 'Tahoma', Arial, sans-serif;
}

/* é¡µé¢å¤´éƒ¨ */
.page-header {
  background: #f5f5f5;
  border-radius: 20px;
  padding: 16px 24px;
  margin-bottom: 24px;
  color: #333;
  position: relative;
  overflow: hidden;
  border: 1px solid #e0e0e0;
}

.page-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
  pointer-events: none;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  z-index: 1;
}

.header-left {
  flex: 1;
}

.page-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0 0 6px 0;
  font-size: 24px;
  font-weight: 700;
  color: #333;
}

.title-icon {
  font-size: 28px;
  color: #f39c12;
}

/* ç¾åŒ–çš„æ¬¢è¿è¯æ ·å¼ */
.welcome-message {
  margin: 0;
  animation: fadeInUp 0.8s ease-out;
}
 
.welcome-line {
  margin: 0;
  display: flex;
  align-items: center;
  gap: 24px;
  font-size: 16px;
  font-weight: 500;
}

.greeting-section {
  display: flex;
  align-items: center;
  gap: 4px;
}

.greeting-emoji {
  font-size: 20px;
  animation: bounce 2s infinite;
  display: inline-block;
}

.greeting-words {
  color: #409eff;
  font-weight: normal;
  text-shadow: 0 1px 2px rgba(64, 158, 255, 0.1);
}

.user-name {
  color: #e6a23c;
  font-weight: normal;
  background: linear-gradient(45deg, #e6a23c, #f39c12);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.exclamation {
  color: #f56c6c;
  font-weight: normal;
  animation: pulse 1.5s ease-in-out infinite;
}

.date-section {
  color: #666;
  font-size: 13px;
  font-weight: 400;
  display: flex;
  align-items: center;
  gap: 6px;
  opacity: 0.9;
}

.calendar-icon {
  color: #909399;
  font-size: 14px;
}

.weekday-tag {
  margin-left: 8px;
  font-weight: 500;
  border-radius: 12px;
  animation: fadeInUp 0.6s ease-out;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-3px);
  }
  60% {
    transform: translateY(-2px);
  }
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

.header-right {
  display: flex;
  align-items: center;
  gap: 24px;
}

.time-filter {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-label {
  color: #666;
  font-size: 14px;
  font-weight: 500;
}

.time-select {
  width: 120px;
}

.quick-actions {
  display: flex;
  gap: 12px;
}

.action-btn {
  border-radius: 12px;
  padding: 10px 16px;
  font-weight: 500;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

/* é¡¶éƒ¨ç»Ÿè®¡æ•°æ®å±•ç¤ºè¡Œ */
.stats-row {
  margin-bottom: 30px;
  max-height: 300px; /* ä»¥æ—¥å†æ¨¡å—é«˜åº¦ä¸ºåŸºå‡†è®¾ç½®ç¬¬äºŒè¡Œæœ€å¤§é«˜åº¦ */
  overflow: hidden; /* é˜²æ­¢å†…å®¹è¶…å‡ºå®¹å™¨åº•éƒ¨ */
}

.stat-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  height: 180px;
  display: flex;
  flex-direction: column;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.card-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 18px;
  font-weight: 600;
  color: #2c3e50;
}

.card-icon {
  font-size: 20px;
  color: #667eea;
}

.filter-btn {
  color: #667eea;
  font-weight: 500;
}

/* å·¦å¡ç‰‡ï¼šå®Œæˆæƒ…å†µ */
.left-card {
  width: 100%;
  overflow: hidden;
}

.left-card .completion-grid {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  padding: 0 0 10px 0;
}

.left-card .completion-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
  flex: 1;
  justify-content: space-around;
}

.completion-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 4px 0;
  white-space: nowrap;
  overflow: hidden;
}

.completion-label {
  font-size: 13px;
  color: #7f8c8d;
  font-weight: 500;
  min-width: 70px;
  flex-shrink: 0;
  white-space: nowrap;
}

.completion-progress {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  min-width: 0;
}

.completion-progress .el-progress {
  flex: 1;
  min-width: 0;
}

.completion-progress .progress-text {
  font-size: 13px;
  color: #2c3e50;
  font-weight: normal;
  min-width: 35px;
  flex-shrink: 0;
  white-space: nowrap;
}

.progress-text-blue {
  color: #409eff !important;
}

.progress-text-green {
  color: #67c23a !important;
}

.progress-text-orange {
  color: #e6a23c !important;
}

.progress-text-red {
  color: #f56c6c !important;
}

/* ä¸­éƒ¨å¡ç‰‡ï¼šè®¡åˆ’ç»Ÿè®¡å’ŒæŸ±å½¢å›¾ */
.middle-card {
  width: 100%;
  overflow: hidden;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.middle-card .middle-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  gap: 8px;
  width: 100%;
  padding: 0 0 20px 0;
}

.stats-text {
  display: flex;
  justify-content: space-around;
  gap: 20px;
  white-space: nowrap;
}

.stats-tags {
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  min-height: 32px;
}

.text-center {
  text-align: center;
}

.stat-tag {
  padding: 3px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  color: white;
  white-space: nowrap;
  flex-shrink: 0;
  line-height: 1.4;
  min-height: 20px;
  display: inline-block;
}

.stat-tag-total {
  background-color: #ff6b6b;
}

.stat-tag-completed {
  background-color: #51cf66;
}

.stat-tag-value {
  font-size: 13px;
  color: #2c3e50;
  font-weight: 600;
  white-space: nowrap;
  flex-shrink: 0;
  margin-left: 6px;
}

.stat-text-item {
  text-align: center;
}

.stat-label {
  display: block;
  font-size: 12px;
  color: #7f8c8d;
  font-weight: 500;
  margin-bottom: 4px;
}

.stat-number {
  font-size: 24px;
  font-weight: 700;
  color: #2c3e50;
}

.stat-number.completed { color: #27ae60; }

.bar-chart {
  display: flex;
  flex-direction: column;
  gap: 8px;
  width: 100%;
  overflow: hidden;
}

.echarts-container {
  width: 100%;
  height: 120px;
  min-width: 0;
}

/* å³å¡ç‰‡ï¼šåœ†ç¯å›¾ */
.right-card {
  width: 100%;
  overflow: hidden;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.right-card .pie-charts {
  flex: 1;
  display: flex;
  justify-content: space-around;
  align-items: center;
  gap: 12px;
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  padding: 0 0 20px 0;
}

.pie-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  flex: 1;
  min-width: 0;
}

.pie-center {
  text-align: center;
}

.pie-value {
  font-size: 11px;
  color: #2c3e50;
  font-weight: 600;
  white-space: nowrap;
}

.pie-label {
  font-size: 12px;
  color: #7f8c8d;
  font-weight: 500;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* æ‰€æœ‰åœ†ç¯è¿›åº¦æ¡èƒŒæ™¯è‰²è®¾ç½® */
.pie-charts .pie-item :deep(.el-progress-circle__track) {
  stroke: #EBEEF5;
}



/* ä¸»è¦å†…å®¹åŒºåŸŸ */
.main-content {
  margin-bottom: 30px;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.content-section {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #ecf0f1;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #2c3e50;
}

.todo-badge {
  margin-left: 8px;
}

.view-all-btn {
  color: #667eea;
  font-weight: 500;
}

/* å¾…åŠäº‹é¡¹ */
.todo-container {
  max-height: 400px;
  overflow-y: auto;
}

.todo-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.todo-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  border-left: 4px solid transparent;
}

.todo-item:hover {
  background: #e9ecef;
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.todo-priority {
  width: 4px;
  height: 40px;
  border-radius: 2px;
  flex-shrink: 0;
}

.priority-high { background: #e74c3c; }
.priority-medium { background: #f39c12; }
.priority-low { background: #27ae60; }

.todo-main {
  flex: 1;
  min-width: 0;
}

.todo-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
  gap: 12px;
}

.todo-title {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #2c3e50;
  line-height: 1.4;
}

.urgency-tag {
  flex-shrink: 0;
}

.todo-meta {
  display: flex;
  gap: 16px;
  margin-bottom: 12px;
  font-size: 12px;
  color: #7f8c8d;
}

.todo-type,
.todo-deadline {
  display: flex;
  align-items: center;
  gap: 4px;
}

.todo-progress {
  display: flex;
  align-items: center;
  gap: 8px;
}

.progress-text {
  font-size: 12px;
  color: #7f8c8d;
  font-weight: 500;
  min-width: 35px;
}

/* æ´»åŠ¨æ—¶é—´çº¿ */
.activity-container {
  max-height: 400px;
  overflow-y: auto;
}

.activity-timeline {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.activity-item {
  display: flex;
  gap: 16px;
  padding: 16px;
  background: #f8f9fa;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.activity-item:hover {
  background: #e9ecef;
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.activity-time {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.time-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #bdc3c7;
}

.time-dot.completed { background: #27ae60; }
.time-dot.warning { background: #f39c12; }
.time-dot.normal { background: #3498db; }

.time-text {
  font-size: 10px;
  color: #7f8c8d;
  text-align: center;
  white-space: nowrap;
}

.activity-content {
  flex: 1;
  min-width: 0;
}

.activity-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
  gap: 12px;
}

.activity-title {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #2c3e50;
  line-height: 1.4;
}

.activity-meta {
  flex-shrink: 0;
}

.activity-description {
  margin: 0 0 12px 0;
  font-size: 13px;
  color: #7f8c8d;
  line-height: 1.4;
}

.activity-progress {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ç»Ÿè®¡é¢æ¿ */
.stats-panel {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 12px;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: white;
}

.stat-icon.completed { background: #27ae60; }
.stat-icon.in-progress { background: #3498db; }
.stat-icon.warning { background: #f39c12; }
.stat-icon.total { background: #9b59b6; }

.stat-info {
  flex: 1;
}

.stat-number {
  font-size: 20px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 12px;
  color: #7f8c8d;
  font-weight: 500;
}

/* åŠ è½½å’Œç©ºçŠ¶æ€ */
.loading-state,
.empty-state {
  padding: 40px 20px;
  text-align: center;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1200px) {
  .pie-charts {
    flex-direction: column;
    align-items: center;
  }
}

@media (max-width: 768px) {
  .modern-dashboard {
    padding: 15px;
  }
  
  .header-content {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }
  
  .header-right {
    flex-direction: column;
    gap: 16px;
  }
  
  .content-grid {
    display: flex;
    flex-direction: column;
  }
  
  .bars-container {
    height: 60px;
  }
  
  .pie-charts {
    flex-direction: column;
    gap: 12px;
  }
}

@media (max-width: 480px) {
  .page-title {
    font-size: 24px;
  }
  
  .quick-actions {
    width: 100%;
    justify-content: center;
  }
  
  .stats-text {
    flex-direction: column;
    gap: 12px;
  }
  
  .bars-container {
    height: 50px;
  }
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.todo-container::-webkit-scrollbar,
.activity-container::-webkit-scrollbar {
  width: 6px;
}

.todo-container::-webkit-scrollbar-track,
.activity-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

/* æ—¥å†å¡ç‰‡æ ·å¼ */
.calendar-card {
  height: 100%;
  max-height: 300px;
  display: flex;
  flex-direction: column;
}

.calendar-content {
  flex: 1;
  padding: 4px;
  overflow: hidden;
}

.dashboard-calendar {
  height: 100%;
}

.dashboard-calendar :deep(.el-calendar__header) {
  padding: 8px 0;
  border-bottom: 1px solid #ebeef5;
  text-align: center;
}

.dashboard-calendar :deep(.el-calendar__title) {
  font-size: 14px;
  font-weight: 600;
  color: #2c3e50;
  text-align: center;
  margin: 0 auto;
}

.dashboard-calendar :deep(.el-calendar__button-group) {
  display: none;
}

.dashboard-calendar :deep(.el-calendar__body) {
  padding: 8px 0;
}

.dashboard-calendar :deep(.el-calendar-table) {
  font-size: 12px;
}

.dashboard-calendar :deep(.el-calendar-table thead th) {
  padding: 0;
  font-weight: 600;
  color: white;
  background-color: #409EFF;
  border-bottom: 1px solid #ebeef5;
  width: 24px;
  height: 24px;
  text-align: center;
  vertical-align: middle;
  line-height: 24px;
}

.dashboard-calendar :deep(.el-calendar-table .el-calendar-day) {
  padding: 0;
  max-height: 24px;
  width: 24px;
  height: 24px;
  text-align: center;
  vertical-align: middle;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dashboard-calendar :deep(.el-calendar-table td) {
  width: 24px;
  height: 24px;
  padding: 0;
  text-align: center;
  vertical-align: middle;
  border: none;
}

.calendar-day {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 2px;
  font-size: 11px;
  transition: all 0.2s ease;
  margin: auto;
}

.calendar-day.is-today {
  background: #F56C6C;
  color: white;
  font-weight: 600;
}

/* æ˜ŸæœŸæ—¥çš„æ—¥æœŸå­—ä½“é¢œè‰²ä¸ºçº¢è‰² */
.dashboard-calendar :deep(.el-calendar-table td:first-child .calendar-day) {
  color: #f56c6c;
}

.dashboard-calendar :deep(.el-calendar-table td:first-child .calendar-day.is-today) {
  background: #F56C6C;
  color: white;
}

/* ä¸Šä¸‹éƒ¨åˆ†å¸ƒå±€æ ·å¼ */
.upper-section {
  margin-bottom: 20px;
}

.lower-section {
  margin-top: 20px;
  height: 160px; /* å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢è¶…å‡º */
}

/* é€šçŸ¥å…¬å‘Šæ¨¡å—æ ·å¼ */
.notice-card {
  height: 100%;
  max-height: 280px; /* ä¸æ—¥å†æ¨¡å—é«˜åº¦ä¿æŒä¸€è‡´ï¼Œç•™20pxè¾¹è· */
  display: flex;
  flex-direction: column;
  overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
}

.notice-card .el-row {
  height: 100%;
  margin: 0;
}

.notice-card .el-col {
  height: 100%;
}

.notice-header {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border-right: 1px solid #ebeef5;
  padding: 16px 12px;
  background: #ffffff;
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
  min-height: 120px;
}

.notice-title {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  margin: 0;
  font-size: 15px;
  font-weight: 700;
  color: #1a1a1a;
  text-align: center;
  line-height: 1.3;
}

.notice-title .el-icon {
  color: #409eff;
  font-size: 24px;
}

.notice-title span {
  white-space: nowrap;
  color: #1a1a1a;
}

.notice-content {
  height: 100%;
  overflow: hidden;
  padding: 12px 8px;
  display: flex;
  align-items: center;
}

.notice-scroll {
  height: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  white-space: nowrap;
  display: flex;
  align-items: center;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
}

.notice-item {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  margin-right: 24px;
  background: transparent;
  transition: all 0.2s ease;
  white-space: nowrap;
  flex-shrink: 0;
}

.notice-item:hover {
  background: rgba(64, 158, 255, 0.1);
  border-radius: 6px;
}

.notice-dot {
  width: 8px;
  height: 8px;
  background: #409eff;
  border-radius: 50%;
  flex-shrink: 0;
}

.notice-text {
  flex: 1;
  font-size: 15px;
  color: #2c3e50;
  line-height: 1.5;
  font-weight: 500;
}

.notice-time {
  font-size: 13px;
  color: #909399;
  white-space: nowrap;
  flex-shrink: 0;
}

/* éšè—æ°´å¹³æ»šåŠ¨æ¡ä»¥è·å¾—æ›´å¥½çš„è§†è§‰æ•ˆæœ */
.notice-scroll::-webkit-scrollbar {
  display: none; /* Chrome, Safari and Opera */
}

.dashboard-calendar :deep(.el-calendar-table .el-calendar-day:hover .calendar-day) {
  background: #ecf5ff;
  color: #409eff;
}

.dashboard-calendar :deep(.el-calendar-table .el-calendar-day:hover .calendar-day.is-today) {
  background: #e85a5a;
  color: white;
}

.todo-container::-webkit-scrollbar-thumb,
.activity-container::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.todo-container::-webkit-scrollbar-thumb:hover,
.activity-container::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style>