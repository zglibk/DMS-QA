# å‰ç«¯ç¯å¢ƒè‡ªé€‚åº”é›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨ DMS-QA å‰ç«¯é¡¹ç›®ä¸­é›†æˆç¯å¢ƒè‡ªé€‚åº”åŠŸèƒ½ï¼Œå®ç°å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® API åœ°å€ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹** - æ ¹æ®è®¿é—®åŸŸå/IPè‡ªåŠ¨åˆ¤æ–­å½“å‰ç¯å¢ƒ
- âœ… **æ™ºèƒ½APIåœ°å€é€‰æ‹©** - ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„APIåœ°å€ä¼˜å…ˆçº§
- âœ… **è‡ªåŠ¨æ•…éšœè½¬ç§»** - ä¸»APIä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨åœ°å€
- âœ… **æ‰‹åŠ¨è¦†ç›–æ”¯æŒ** - ä¿ç•™æ‰‹åŠ¨è®¾ç½®åŠŸèƒ½
- âœ… **ç¼“å­˜æœºåˆ¶** - é¿å…é‡å¤æ£€æµ‹ï¼Œæå‡æ€§èƒ½
- âœ… **å®æ—¶ç›‘æ§** - APIè¿æ¥çŠ¶æ€å®æ—¶ç›‘æ§

### ç¯å¢ƒé€‚é…
- ğŸ”§ **å¼€å‘ç¯å¢ƒ** - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°APIï¼Œé™çº§åˆ°è¿œç¨‹API
- ğŸš€ **ç”Ÿäº§ç¯å¢ƒ** - ä¼˜å…ˆä½¿ç”¨è¿œç¨‹APIï¼Œé™çº§åˆ°æœ¬åœ°API
- ğŸ§ª **æµ‹è¯•ç¯å¢ƒ** - æ”¯æŒç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒé…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ–‡ä»¶ç»“æ„

```
frontend/src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ environment.js          # ç¯å¢ƒé…ç½®ç®¡ç†å™¨
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ smartApiDetector.js     # æ™ºèƒ½APIæ£€æµ‹å™¨
â”œâ”€â”€ services/
â”‚   â””â”€â”€ apiService.js           # APIæœåŠ¡å°è£…
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ApiManager.vue          # APIç®¡ç†ç»„ä»¶
â””â”€â”€ examples/
    â””â”€â”€ ApiUsageExample.vue     # ä½¿ç”¨ç¤ºä¾‹
```

### 2. åŸºç¡€é›†æˆ

#### åœ¨ main.js ä¸­åˆå§‹åŒ–

```javascript
import { createApp } from 'vue'
import App from './App.vue'
import apiService from './services/apiService.js'

const app = createApp(App)

// åˆå§‹åŒ–APIæœåŠ¡
apiService.initialize().then(() => {
  console.log('APIæœåŠ¡åˆå§‹åŒ–å®Œæˆ')
}).catch(error => {
  console.error('APIæœåŠ¡åˆå§‹åŒ–å¤±è´¥:', error)
})

app.mount('#app')
```

#### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```javascript
import apiService from '@/services/apiService.js'

export default {
  async mounted() {
    try {
      // è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨æœ€ä½³APIåœ°å€
      const response = await apiService.get('/api/users')
      console.log('ç”¨æˆ·æ•°æ®:', response.data)
    } catch (error) {
      console.error('APIè°ƒç”¨å¤±è´¥:', error)
    }
  }
}
```

### 3. æ·»åŠ APIç®¡ç†ç•Œé¢

```vue
<template>
  <div>
    <!-- å…¶ä»–å†…å®¹ -->
    
    <!-- APIç®¡ç†ç»„ä»¶ -->
    <ApiManager />
  </div>
</template>

<script>
import ApiManager from '@/components/ApiManager.vue'

export default {
  components: {
    ApiManager
  }
}
</script>
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®

åœ¨ `frontend/src/config/environment.js` ä¸­é…ç½®ä¸åŒç¯å¢ƒï¼š

```javascript
// å¼€å‘ç¯å¢ƒé…ç½®
development: {
  name: 'development',
  description: 'å¼€å‘ç¯å¢ƒ',
  detection: {
    hostnames: ['localhost', '127.0.0.1', '192.168.1.100'], // å¼€å‘æœºIP
    ports: ['3000', '5173', '8080', '8081'],
    protocols: ['http:', 'https:']
  },
  // å¼€å‘ç¯å¢ƒAPIåœ°å€ä¼˜å…ˆçº§ï¼ˆæœ¬åœ°ä¼˜å…ˆï¼‰
  apiUrls: [
    'http://localhost:3001',           // æœ¬åœ°åç«¯
    'http://127.0.0.1:3001',          // æœ¬åœ°åç«¯å¤‡ç”¨
    'http://192.168.1.57:3001',       // è¿œç¨‹åç«¯
    'http://192.168.1.57/api',        // è¿œç¨‹åç«¯ï¼ˆNginxä»£ç†ï¼‰
  ]
}
```

### APIåœ°å€ä¼˜å…ˆçº§

#### å¼€å‘ç¯å¢ƒä¼˜å…ˆçº§
1. `http://localhost:3001` - æœ¬åœ°å¼€å‘æœåŠ¡å™¨
2. `http://127.0.0.1:3001` - æœ¬åœ°å¼€å‘æœåŠ¡å™¨å¤‡ç”¨
3. `http://192.168.1.57:3001` - è¿œç¨‹ç”Ÿäº§æœåŠ¡å™¨
4. `http://192.168.1.57/api` - è¿œç¨‹Nginxä»£ç†

#### ç”Ÿäº§ç¯å¢ƒä¼˜å…ˆçº§
1. `http://192.168.1.57/api` - Nginxä»£ç†ï¼ˆæœ€ä¼˜ï¼‰
2. `http://192.168.1.57:3001` - ç›´è¿åç«¯
3. `http://192.168.1.57:8081/api` - å¤‡ç”¨ç«¯å£
4. `http://localhost:3001` - æœ¬åœ°åç«¯ï¼ˆé™çº§ï¼‰

## ğŸ“¡ APIä½¿ç”¨æ–¹æ³•

### åŸºç¡€APIè°ƒç”¨

```javascript
import apiService from '@/services/apiService.js'

// GETè¯·æ±‚
const users = await apiService.get('/users')

// POSTè¯·æ±‚
const newUser = await apiService.post('/users', {
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com'
})

// PUTè¯·æ±‚
const updatedUser = await apiService.put('/users/1', userData)

// DELETEè¯·æ±‚
await apiService.delete('/users/1')
```

### æ–‡ä»¶ä¸Šä¼ 

```javascript
// æ–‡ä»¶ä¸Šä¼ 
const file = document.getElementById('fileInput').files[0]
const response = await apiService.upload('/upload', file, (progress) => {
  console.log(`ä¸Šä¼ è¿›åº¦: ${progress}%`)
})
```

### æ–‡ä»¶ä¸‹è½½

```javascript
// æ–‡ä»¶ä¸‹è½½
await apiService.download('/files/report.pdf', 'report.pdf')
```

### æµ‹è¯•è¿æ¥

```javascript
// æµ‹è¯•APIè¿æ¥
const result = await apiService.testConnection()
if (result.success) {
  console.log('APIè¿æ¥æ­£å¸¸')
} else {
  console.error('APIè¿æ¥å¤±è´¥:', result.error)
}
```

## ğŸ›ï¸ æ‰‹åŠ¨æ§åˆ¶

### æ‰‹åŠ¨è®¾ç½®APIåœ°å€

```javascript
import smartApiDetector from '@/utils/smartApiDetector.js'

// æ‰‹åŠ¨è®¾ç½®APIåœ°å€
smartApiDetector.setApiUrl('http://192.168.1.57:3001')

// æˆ–è€…é€šè¿‡APIæœåŠ¡è®¾ç½®
await apiService.setApiUrl('http://192.168.1.57:3001')
```

### æ‰‹åŠ¨åˆ‡æ¢ç¯å¢ƒ

```javascript
import environmentManager from '@/config/environment.js'

// æ‰‹åŠ¨åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
environmentManager.setEnvironment('production')

// æ¸…é™¤æ‰‹åŠ¨è®¾ç½®ï¼Œæ¢å¤è‡ªåŠ¨æ£€æµ‹
environmentManager.clearManualEnvironment()
```

### å¼ºåˆ¶é‡æ–°æ£€æµ‹

```javascript
// å¼ºåˆ¶é‡æ–°æ£€æµ‹APIåœ°å€
const newApiUrl = await smartApiDetector.getApiUrl({ forceDetect: true })

// é‡æ–°åˆå§‹åŒ–APIæœåŠ¡
await apiService.reinitialize()
```

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### è·å–çŠ¶æ€ä¿¡æ¯

```javascript
// è·å–APIçŠ¶æ€
const status = await apiService.getStatus()
console.log('APIçŠ¶æ€:', status)

// è·å–ç¯å¢ƒä¿¡æ¯
const envInfo = environmentManager.getEnvironmentSummary()
console.log('ç¯å¢ƒä¿¡æ¯:', envInfo)
```

### å¼€å¯è°ƒè¯•æ¨¡å¼

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œè°ƒè¯•ä¿¡æ¯ä¼šè‡ªåŠ¨è¾“å‡ºåˆ°æ§åˆ¶å°ï¼š

```javascript
// æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯
const features = environmentManager.getFeatures()
if (features.debug) {
  console.log('è°ƒè¯•æ¨¡å¼å·²å¼€å¯')
}
```

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰æ£€æµ‹è¶…æ—¶

```javascript
import smartApiDetector from '@/utils/smartApiDetector.js'

// è®¾ç½®æ£€æµ‹è¶…æ—¶æ—¶é—´
smartApiDetector.detectionTimeout = 3000 // 3ç§’
smartApiDetector.fastTimeout = 1000 // 1ç§’
```

### è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥

```javascript
// æ¸…é™¤APIç¼“å­˜
smartApiDetector.clearApiCache()

// è·å–ç¼“å­˜ä¿¡æ¯
const cacheInfo = smartApiDetector.getCacheInfo()
```

### æ·»åŠ è‡ªå®šä¹‰ç¯å¢ƒ

```javascript
// åœ¨ environment.js ä¸­æ·»åŠ æ–°ç¯å¢ƒ
const config = {
  staging: {
    name: 'staging',
    description: 'é¢„å‘å¸ƒç¯å¢ƒ',
    detection: {
      hostnames: ['staging.example.com'],
      ports: ['80', '443'],
      protocols: ['https:']
    },
    apiUrls: [
      'https://staging-api.example.com',
      'https://staging.example.com/api'
    ]
  }
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIæ£€æµ‹å¤±è´¥
```javascript
// æ£€æŸ¥ç½‘ç»œè¿æ¥
const result = await smartApiDetector.testApiConnection('http://192.168.1.57:3001')
console.log('è¿æ¥æµ‹è¯•ç»“æœ:', result)
```

#### 2. ç¯å¢ƒæ£€æµ‹é”™è¯¯
```javascript
// æ‰‹åŠ¨æŒ‡å®šç¯å¢ƒ
environmentManager.setEnvironment('production')
```

#### 3. ç¼“å­˜é—®é¢˜
```javascript
// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
smartApiDetector.clearApiCache()
environmentManager.clearManualEnvironment()
```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—** - æ‰€æœ‰æ£€æµ‹è¿‡ç¨‹éƒ½æœ‰è¯¦ç»†æ—¥å¿—
2. **ä½¿ç”¨APIç®¡ç†ç»„ä»¶** - å¯è§†åŒ–æŸ¥çœ‹å’Œç®¡ç†APIçŠ¶æ€
3. **æ£€æŸ¥ç½‘ç»œé¢æ¿** - æŸ¥çœ‹å®é™…çš„APIè¯·æ±‚
4. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼** - åœ¨å¼€å‘ç¯å¢ƒä¸­è·å–æ›´å¤šä¿¡æ¯

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒ
- [ ] æœ¬åœ°åç«¯æœåŠ¡å·²å¯åŠ¨ (http://localhost:3001)
- [ ] å‰ç«¯å¼€å‘æœåŠ¡å™¨å·²å¯åŠ¨
- [ ] ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹ä¸º 'development'
- [ ] APIè‡ªåŠ¨è¿æ¥åˆ°æœ¬åœ°åç«¯

### ç”Ÿäº§ç¯å¢ƒ
- [ ] è¿œç¨‹åç«¯æœåŠ¡å·²å¯åŠ¨ (http://192.168.1.57:3001)
- [ ] Nginxä»£ç†å·²é…ç½® (http://192.168.1.57/api)
- [ ] å‰ç«¯å·²éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
- [ ] ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹ä¸º 'production'
- [ ] APIè‡ªåŠ¨è¿æ¥åˆ°è¿œç¨‹åç«¯

### æµ‹è¯•éªŒè¯
- [ ] åœ¨å¼€å‘ç¯å¢ƒä¸­è®¿é—®ï¼Œè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°API
- [ ] åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¿é—®ï¼Œè‡ªåŠ¨ä½¿ç”¨è¿œç¨‹API
- [ ] APIæ•…éšœæ—¶èƒ½è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨åœ°å€
- [ ] æ‰‹åŠ¨è®¾ç½®APIåœ°å€åŠŸèƒ½æ­£å¸¸
- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸

## ğŸ‰ æ€»ç»“

é€šè¿‡é›†æˆç¯å¢ƒè‡ªé€‚åº”åŠŸèƒ½ï¼Œæ‚¨çš„å‰ç«¯åº”ç”¨å°†èƒ½å¤Ÿï¼š

1. **è‡ªåŠ¨é€‚é…ç¯å¢ƒ** - æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œè‡ªåŠ¨è¯†åˆ«å¼€å‘/ç”Ÿäº§ç¯å¢ƒ
2. **æ™ºèƒ½APIé€‰æ‹©** - æ ¹æ®ç¯å¢ƒä¼˜å…ˆçº§è‡ªåŠ¨é€‰æ‹©æœ€ä½³APIåœ°å€
3. **æ•…éšœè‡ªåŠ¨æ¢å¤** - APIä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨åœ°å€
4. **å¼€å‘ä½“éªŒä¼˜åŒ–** - å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒæ— ç¼åˆ‡æ¢
5. **è¿ç»´æˆæœ¬é™ä½** - å‡å°‘æ‰‹åŠ¨é…ç½®å’Œç»´æŠ¤å·¥ä½œ

ç°åœ¨æ‚¨å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡å¼€å‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒç¯å¢ƒé…ç½®é—®é¢˜ï¼ğŸš€
