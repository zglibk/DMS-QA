# 来料检验自动化功能设计与评估方案

## 1. 背景与目标

当前系统已具备基本的来料检验报告录入、ERP数据查询引用及抽样数自动计算功能。为了进一步提高效率，减少人工录入成本，需设计一套"自动化生成"机制。该机制旨在根据ERP入库信息，自动匹配检验模板，生成包含预设/随机实测数据的检验报告初稿，供检验员审核或直接提交。

## 2. 核心需求分析

1.  **真实检验录入（现状优化）**：
    *   支持不同物料类别自动加载不同的检验项目（如纸张类加载厚度、含水量；胶水类加载粘度）。
    *   提供便捷的样本数据录入接口（已初步实现）。

2.  **自动化生成（新需求）**：
    *   **批量处理**：支持从ERP批量导入入库单。
    *   **智能匹配**：根据物料名称/编码自动匹配检验模板。
    *   **数据模拟**：对于免检或快速通关物料，系统应能根据合格标准和公差规则，自动生成符合要求的实测数据（类似出货报告的逻辑）。

## 3. 系统架构设计

### 3.1 数据库模型增强

需要对现有数据库进行以下扩展：

*   **`InspectionItems` (检验项目表)**：
    *   新增 `MaterialCategory` (物料类别) 字段，用于区分该项目属于哪类物料（如：`Paper`, `Ink`, `Carton`, `General`）。
    *   新增 `AutoGenerateRule` (自动生成规则) 字段，存储JSON格式的规则，例如：
        ```json
        {
          "type": "random_range",
          "min": 10,
          "max": 12,
          "precision": 2
        }
        ```
        或
        ```json
        {
          "type": "tolerance_random",
          "nominal": "from_spec", // 从规格字段提取标称值
          "tolerance": 0.5
        }
        ```

*   **`MaterialCategoryMapping` (物料类别映射表 - 可选)**：
    *   用于定义关键词与类别的关系。例如：名称包含"纸" -> 类别"Paper"。

### 3.2 业务流程设计

1.  **模板配置阶段**：
    *   管理员在"检验项目管理"中，为每个检验项目指定"适用物料类别"。
    *   配置自动生成规则（如：初粘性总是生成 >=8 的随机整数）。

2.  **报告生成阶段**：
    *   用户进入"新增报告" -> 点击"批量生成"。
    *   系统拉取ERP入库列表。
    *   用户勾选多条记录。
    *   系统遍历记录：
        *   **识别类别**：根据物料名称关键词（如"坑纸"）识别为 `Carton`。
        *   **加载项目**：查询所有 `MaterialCategory = 'Carton'` 的检验项目。
        *   **生成数据**：根据项目的 `AutoGenerateRule` 生成虚拟实测值。
        *   **计算结论**：自动判定为"合格"。
    *   系统批量创建状态为 `Saved` (草稿) 或 `Submitted` (已提交) 的报告。

3.  **人工审核阶段**：
    *   检验员打开草稿，复核数据，必要时修正实测值，确认无误后提交。

## 4. 详细功能模块设计

### 4.1 检验项目管理升级
*   **功能**：在新增/编辑检验项目时，增加"适用类别"下拉框（支持多选或标签输入）。
*   **UI**：`InspectionItemConfig.vue` 增加类别筛选和编辑列。

### 4.2 自动生成引擎 (Backend Service)
*   **服务**：`InspectionAutoService`
*   **逻辑**：
    *   `matchCategory(materialName)`: 简单关键词匹配。
    *   `generateValue(rule, spec)`: 核心算法，支持范围随机、公差随机、枚举选择。

### 4.3 前端批量操作
*   **UI**：在 `IncomingInspection.vue` 列表页或 `IncomingInspectionForm.vue` 中增加"自动化模式"入口。
*   **交互**：类似出货报告的"批量查询 -> 预览 -> 生成"。

## 5. 实施路线图

### 第一阶段：基础架构（当前重点）
1.  **数据库变更**：给 `InspectionItems` 添加 `MaterialCategory` 字段。
2.  **配置管理**：更新前端页面，允许用户为检验项目打标签（分类）。

### 第二阶段：规则引擎
1.  **规则定义**：在检验项目表中添加自动生成规则字段。
2.  **后端逻辑**：实现根据规则生成模拟数据的函数。

### 第三阶段：批量生成UI
1.  **界面开发**：开发批量选择ERP单据并一键生成的向导页面。
2.  **联调测试**：验证从ERP到报告生成的全流程。

## 6. 结论

该方案在保留现有手动严谨检验的基础上，增加了一条"自动化快车道"。通过**模板绑定**和**规则模拟**，可以极大减少重复录入工作。建议先完成**第一阶段**（添加分类字段），这是后续自动化的基石。
