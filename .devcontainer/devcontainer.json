{
  "name": "DMS-QA 质量管理系统开发环境",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:18",
  
  // 功能扩展
  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "18",
      "nodeGypDependencies": true
    },
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },
  
  // 端口转发配置
  "forwardPorts": [3001, 5173, 8080],
  "portsAttributes": {
    "5173": {
      "label": "前端开发服务器 (Vue + Vite)",
      "onAutoForward": "openPreview"
    },
    "3001": {
      "label": "后端API服务器 (Node.js + Express)",
      "onAutoForward": "notify"
    }
  },
  
  // 容器创建后执行的命令
  "postCreateCommand": "npm install && cd frontend && npm install && cd ../server && npm install && echo '\n🎉 DMS-QA开发环境配置完成！\n前端服务: npm run dev (在frontend目录)\n后端服务: node app.js (在server目录)\n'",
  
  // VS Code 自定义配置
  "customizations": {
    "vscode": {
      "extensions": [
        "Vue.vscode-vue",
        "ms-vscode.vscode-json",
        "bradlc.vscode-tailwindcss",
        "esbenp.prettier-vscode",
        "ms-vscode.vscode-eslint",
        "formulahendry.auto-rename-tag",
        "christian-kohler.path-intellisense",
        "ms-vscode.vscode-typescript-next",
        "ms-vscode.vscode-mysql",
        "humao.rest-client"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "emmet.includeLanguages": {
          "vue": "html"
        },
        "terminal.integrated.defaultProfile.linux": "bash",
        "files.associations": {
          "*.vue": "vue"
        },
        "editor.tabSize": 2,
        "editor.insertSpaces": true
      }
    }
  },
  
  // 挂载点配置 - 保持Git历史
  "mounts": [
    "source=${localWorkspaceFolder}/.git,target=/workspaces/DMS-QA/.git,type=bind,consistency=cached",
    "source=dms-qa-node-modules,target=${containerWorkspaceFolder}/node_modules,type=volume",
    "source=dms-qa-frontend-node-modules,target=${containerWorkspaceFolder}/frontend/node_modules,type=volume",
    "source=dms-qa-server-node-modules,target=${containerWorkspaceFolder}/server/node_modules,type=volume"
  ],
  
  // 容器用户配置
  "remoteUser": "node",
  
  // 环境变量
  "containerEnv": {
    "NODE_ENV": "development",
    "TZ": "Asia/Shanghai"
  },
  
  // 生命周期脚本
  "postStartCommand": "echo '\n📋 DMS-QA 质量管理系统开发环境\n🌐 前端: http://localhost:5173\n🔧 后端: http://localhost:3001\n📁 工作目录: /workspaces/DMS-QA\n\n快速启动命令:\n  前端: cd frontend && npm run dev\n  后端: cd server && node app.js\n'",
  
  // 自动停止配置（节省资源）
  "shutdownAction": "stopCodespace"
}